class Drawer{constructor(g,type){_defineProperty(this,"findFreeSlot",card=>{for(var i=0;i<this.level*DRAWER_CARDS_PER_LEVEL;i++)if(null==this.slots[i].card){this.game.selectedSpot=this.slots[i];break}}),_defineProperty(this,"emptyDrawer",()=>{for(var j=0;j<this.slots.length;j++)this.slots[j].card&&(this.slots[j].card.destroy(!1),this.slots[j].card=null)}),_defineProperty(this,"update",()=>{this.title.text=getString(this.game.language,"gui","drawer_name_"+this.type,"header"),0==this.level?this.buttonOpen.setVisible(!1):this.buttonOpen.setVisible(!0),this.drawerBackground.y=0-(3-this.level)*(CARD_SMALL_HEIGHT+DRAWER_CARDS_MARGIN),this.buttonOpen.setPosition(this.drawerBackground.width/2-this.buttonOpen.button.width/2-DRAWER_CARDS_MARGIN_LEFT-this.buttonOpen.button.width*this.shift+0,this.drawerBackground.height+DRAWER_CARDS_MARGIN_TOP/2-4+this.drawerBackground.y),this.drawerCounter.x=this.buttonOpen.button.x+7,this.drawerCounter.y=this.buttonOpen.button.y+5,this.buttonDelete.setPosition(588,322);for(var counter=0,lines=1+Math.floor((this.level*DRAWER_CARDS_PER_LEVEL-1)/DRAWER_CARDS_PER_ROW),i=0;i<this.slots.length;i++)this.slots[i].hide();for(var i=0;i<lines;i++){var rowsBeginsAt=i*DRAWER_CARDS_PER_ROW;if(rowsBeginsAt>=this.slots.length)break;var rows=this.slots.length-rowsBeginsAt;if(rows>DRAWER_CARDS_PER_ROW&&(rows=DRAWER_CARDS_PER_ROW),rows<=0)break;for(var j=0;j<rows;j++){var index=rowsBeginsAt+j;null!=this.slots[index].card&&counter++,this.slots[index].show(),this.slots[index].position(DRAWER_CARDS_MARGIN_LEFT+(j*(CARD_WIDTH+DRAWER_CARDS_MARGIN)+(CARD_WIDTH+DRAWER_CARDS_MARGIN)*(DRAWER_CARDS_PER_ROW-rows)/2),DRAWER_CARDS_MARGIN_TOP+this.buttonClose.button.height/2+(CARD_SMALL_HEIGHT+DRAWER_CARDS_MARGIN)*i)}}this.updateCounter()}),_defineProperty(this,"sortDrawer",()=>{if(!(null!=this.selectedItem||null!=this.selectedItem||this.isInOptions||this.isUpdatingHand||this.isDrawingCards||this.isDraggingCard||this.isDroppingCard||this.isDraggingWalker||this.isDroppingWalker||this.isTargetingBlocks||this.isTargetingStreets||this.isTargetingNodes||this.isTargetingGlobal||1==this.game.clickMode&&null!=this.game.selectedItem&&this.game.selectedItem instanceof Card)){this.game.switchSellMode(!1,null);for(var sortArray_specials=[],sortArray_buildable=[],sortArray_gifts=[],sortArray_others=[],sortArray_empty=[],unsortedArray=[],i=0;i<this.slots.length;i++)unsortedArray.push(this.slots[i]);for(var i=0;i<this.slots.length;i++)null!=this.slots[i].card?this.slots[i].card.playTarget==CARD_TARGET_STREET||this.slots[i].card.playTarget==CARD_TARGET_BLOCK||this.slots[i].card.playTarget==CARD_TARGET_NODE||null!=this.slots[i].card.constructionStarter?sortArray_buildable.push(i):this.slots[i].card.playTarget==CARD_TARGET_GLOBAL?sortArray_gifts.push(i):"true"==this.slots[i].card.consume?sortArray_specials.push(i):sortArray_others.push(i):sortArray_empty.push(i);sortArray_specials.sort(this.compare),sortArray_buildable.sort(this.compare),sortArray_gifts.sort(this.compare),sortArray_others.sort(this.compare),this.slots=[];for(var i=0;i<sortArray_specials.length;i++)this.slots.push(unsortedArray[sortArray_specials[i]]);for(var i=0;i<sortArray_buildable.length;i++)this.slots.push(unsortedArray[sortArray_buildable[i]]);for(var i=0;i<sortArray_gifts.length;i++)this.slots.push(unsortedArray[sortArray_gifts[i]]);for(var i=0;i<sortArray_others.length;i++)this.slots.push(unsortedArray[sortArray_others[i]]);for(var i=0;i<sortArray_empty.length;i++)this.slots.push(unsortedArray[sortArray_empty[i]]);this.update(),this.updateCards()}}),_defineProperty(this,"compare",(a,b)=>"small_gift"!=this.slots[a].card.id||"medium_gift"!=this.slots[b].card.id&&"big_gift"!=this.slots[b].card.id?"medium_gift"==this.slots[a].card.id&&"big_gift"==this.slots[b].card.id?-1:"big_gift"!=this.slots[a].card.id||"medium_gift"!=this.slots[b].card.id&&"small_gift"!=this.slots[b].card.id?"medium_gift"==this.slots[a].card.id&&"small_gift"==this.slots[b].card.id?1:"small_donation"!=this.slots[a].card.id||"medium_donation"!=this.slots[b].card.id&&"big_donation"!=this.slots[b].card.id?"medium_donation"==this.slots[a].card.id&&"big_donation"==this.slots[b].card.id?-1:"big_donation"!=this.slots[a].card.id||"medium_donation"!=this.slots[b].card.id&&"small_donation"!=this.slots[b].card.id?"medium_donation"==this.slots[a].card.id&&"small_donation"==this.slots[b].card.id?1:this.slots[a].card.name_bmp.text<this.slots[b].card.name_bmp.text?-1:this.slots[a].card.name_bmp.text>this.slots[b].card.name_bmp.text?1:0:1:-1:1:-1),_defineProperty(this,"openClose1",()=>{this.game.switchSellMode(!1,null),1==this.game.clickMode&&null!=this.game.selectedItem&&this.game.selectedItem instanceof Card||this.openClose()}),_defineProperty(this,"openCloseQuiet",()=>{this.openClose2()}),_defineProperty(this,"openClose",()=>{this.open?this.soundClose.play({mute:!1,volume:1,rate:1,detune:300*Math.random()-150,seek:0,loop:!1,delay:0}):this.soundOpen.play({mute:!1,volume:1,rate:1,detune:300*Math.random()-150,seek:0,loop:!1,delay:0}),this.openClose2()}),_defineProperty(this,"openClose2",()=>{this.open?(this.container.each(disableChildren),this.container.setDepth(LAYER_DRAWER_CLOSED),this.phaser.tweens.add({targets:[this.container],y:-this.drawerBackground.height-this.drawerBackground.y,ease:"Cubic.InOut",duration:500,onComplete:function(){this.buttonOpen.hover.input.enabled=!0,this.game.unlockDrawers()},onCompleteScope:this})):(this.updateCards(),this.game.lockDrawers(this.type),this.container.setDepth(LAYER_DRAWER_OPEN),this.buttonOpen.hover.input.enabled=!1,this.phaser.tweens.add({targets:[this.container],y:0,ease:"Cubic.InOut",duration:500,onComplete:function(){this.container.each(enableChildren),this.buttonOpen.hover.input.enabled=!0},onCompleteScope:this})),this.open=!this.open}),_defineProperty(this,"updatePriceAvailability",()=>{for(var i=0;i<this.slots.length;i++)null!=this.slots[i]&&null!=this.slots[i].card&&this.slots[i].card.updatePriceAvailability()}),_defineProperty(this,"updateCards",()=>{for(var i=0;i<this.slots.length;i++)null!=this.slots[i]&&null!=this.slots[i].card&&(this.slots[i].card.updateLanguage(),this.slots[i].card.positionCard(1,0,!1));this.title.text=getString(this.game.language,"gui","drawer_name_"+this.type,"header"),this.updatePriceAvailability()}),_defineProperty(this,"updateCounter",()=>{if(0!=this.level){for(var counter=0,i=0;i<this.slots.length;i++)null!=this.slots[i]&&null!=this.slots[i].card&&counter++;this.drawerCounter.text=counter+"/"+this.level*DRAWER_CARDS_PER_LEVEL,this.drawerCounter.x=this.buttonOpen.button.x+20-this.drawerCounter.width}else this.drawerCounter.text=""}),_defineProperty(this,"pointerDown",(pointer,right)=>{for(var i=0;i<this.slots.length;i++)null!=this.slots[i]&&null!=this.slots[i].card&&(right&&(this.game.selectedSpot=null,this.slots[i].card.selected=!1,this.slots[i].card.clicked=!1),this.slots[i].card.collapseAndShrink(),this.slots[i].card.clicked=!1)}),_defineProperty(this,"deleteThis",pointer=>{this.game.selectedItem instanceof Card&&0==this.game.hand.cardIsInHand(this.game.selectedItem)&&(1==pointer.rightButtonDown()||1==pointer.middleButtonDown()||1==pointer.backButtonDown()||1==pointer.forwardButtonDown()?(this.findFreeSlot(this.game.selectedItem),this.game.selectedItem.selectedSpot=this.game.selectedSpot,this.game.selectedItem.easing="Back.Out",this.game.selectedItem.onComplete=this.game.selectedItem.defaultOnComplete):(this.temp=this.game.selectedItem.selectedSpot,this.game.selectedSpot=null,this.game.selectedItem.selectedSpot=null,this.game.selectedItem.sourceX=this.buttonDelete.hover.x,this.game.selectedItem.sourceY=this.buttonDelete.hover.y+70,this.game.selectedItem.easing="Back.In",this.game.selectedItem.onComplete=function(){this.game.deck.discarded.push(this.id),this.destroy(!1)}))}),_defineProperty(this,"handThis",pointer=>{this.game.selectedItem instanceof Card&&0==this.game.hand.cardIsInHand(this.game.selectedItem)&&(1==pointer.rightButtonDown()||1==pointer.middleButtonDown()||1==pointer.backButtonDown()||1==pointer.forwardButtonDown()?(this.findFreeSlot(this.game.selectedItem),this.game.selectedItem.selectedSpot=this.game.selectedSpot,this.game.selectedItem.easing="Back.Out",this.game.selectedItem.onComplete=this.game.selectedItem.defaultOnComplete):(this.game.selectedSpot=null,this.game.selectedItem.selectedSpot=null,this.game.selectedItem.sourceX=this.buttonDelete.hover.x,this.game.selectedItem.sourceY=this.buttonDelete.hover.y+70,this.game.selectedItem.easing="Back.In",this.game.selectedItem.onComplete=function(){this.game.deck.discarded.push(this.id),this.destroy(!1)}))}),_defineProperty(this,"hideDeleteButton",()=>{this.phaser.tweens.add({targets:this.buttonDelete.getContent(),alpha:0,ease:"Cubic.InOut",duration:200,onComplete:function(){this.buttonDelete.button.alpha=0,this.buttonDelete.button.visible=!1,this.buttonDelete.hover.alpha=0,this.buttonDelete.hover.visible=!1,this.game.sellButton.button.setTexture("gui","moneybag2"),this.game.sellButton.hover.setTexture("gui","moneybag2_down"),this.game.sellButton.tooltip="sell",this.game.sellButton.resetListeners()},onCompleteScope:this})}),_defineProperty(this,"showDeleteButton",()=>{this.buttonDelete.button.alpha=0,this.buttonDelete.button.visible=!0,this.buttonDelete.hover.alpha=0,this.buttonDelete.hover.visible=!0,this.phaser.tweens.add({targets:this.buttonDelete.button,alpha:1,visible:!0,ease:"Cubic.InOut",duration:200}),this.phaser.tweens.add({targets:this.buttonDelete.hover,alpha:.01,visible:!0,ease:"Cubic.InOut",duration:200}),this.game.sellButton.button.setTexture("gui","recycle_active"),this.game.sellButton.hover.setTexture("gui","recycle_active_down"),this.game.sellButton.hover.removeListener("pointerdown"),this.game.sellButton.hover.on("pointerdown",this.deleteThis),this.game.sellButton.hover.on("pointerover",this.deleteThis),this.game.sellButton.tooltip="drawer_recycle",this.game.sellButton.hover.on("pointerout",this.deleteButtonAction)}),_defineProperty(this,"deleteButtonAction",pointer=>{this.game.selectedItem instanceof Card&&0==this.game.hand.cardIsInHand(this.game.selectedItem)&&(this.game.selectedItem.selectedSpot=this.temp,this.game.selectedItem.easing="Back.Out",this.game.selectedItem.onComplete=this.game.selectedItem.defaultOnComplete)}),this.game=g,this.phaser=this.game.phaser;var self=this;this.open=!1,this.type=type,this.level=0,this.soundOpen=this.phaser.sound.add("drawer_open"),this.soundClose=this.phaser.sound.add("drawer_close"),this.drawerBackground=this.phaser.add.image(0,0,"gui","drawer"),this.drawerBackground.setOrigin(0),this.drawerBackground.setInteractive(),this.drawerLabel=this.phaser.add.image(0,0,"gui","drawer_label"),this.drawerLabel.setOrigin(0),this.drawerLabel.x=DRAWER_CARDS_MARGIN_LEFT,this.drawerLabel.y=-5,this.temp=null,this.shift=0,this.slots=[],this.cards=[],this.buttonClose=new Button(this.game,"x","x_glow","gui",this.openClose),this.buttonClose.setPosition(this.drawerBackground.width-this.buttonClose.button.width/2-DRAWER_CARDS_MARGIN_LEFT,DRAWER_CARDS_MARGIN_TOP),this.buttonClose.tooltip="close",this.buttonSort=new Button(this.game,"sort","sort_glow","gui",this.sortDrawer),this.buttonSort.setPosition(this.drawerBackground.width-this.buttonClose.button.width/2-DRAWER_CARDS_MARGIN_LEFT-50,DRAWER_CARDS_MARGIN_TOP),this.buttonSort.tooltip="sort",this.typeicon="",this.type==CARD_TYPE_DOCUMENT&&(this.typeicon="drawer_scroll",this.shift=0),this.type==CARD_TYPE_COMPONENT&&(this.typeicon="drawer_res",this.shift=1),this.type==CARD_TYPE_WORKER&&(this.typeicon="drawer_humans",this.shift=2),this.buttonOpen=new Button(this.game,this.typeicon,this.typeicon+"_down","gui",this.openClose1),this.buttonOpen.tooltip=this.typeicon,this.buttonDelete=new Button(this.game,"discard_button","discard_button","gui",(function(){})),this.buttonDelete.tooltip="drawer_recycle",this.deleteSafety=null,this.buttonDelete.button.alpha=0,this.buttonDelete.button.visible=!1,this.buttonDelete.hover.alpha=0,this.buttonDelete.hover.visible=!1,this.buttonDelete.hover.setDepth(LAYER_GUI_ACTIVE+1),this.buttonDelete.button.setDepth(LAYER_GUI_ACTIVE),this.buttonDelete.hover.on("pointerdown",this.deleteThis),this.buttonDelete.hover.on("pointerover",this.deleteThis),this.buttonDelete.hover.on("pointerout",this.deleteButtonAction),this.buttonOpen.hover.on("pointerover",(function(){null!=self.game.selectedItem&&self.game.selectedItem instanceof Card&&self.game.selectedItem.playType==self.type&&(self.game.selectedSpot=null,self.findFreeSlot(self.game.selectedItem))})),this.buttonOpen.hover.on("pointerout",(function(){self.game.selectedSpot=null})),this.phaser.input.on("pointerdown",(function(pointer){1!=pointer.rightButtonDown()&&1!=pointer.middleButtonDown()&&1!=pointer.backButtonDown()&&1!=pointer.forwardButtonDown()||(self.buttonOpen.button.setTexture("gui",self.typeicon),self.buttonOpen.hover.setTexture("gui",self.typeicon+"_down"),self.hideDeleteButton())})),this.phaser.input.on("dragstart",(function(pointer,gameObject){1!=pointer.rightButtonDown()&&1!=pointer.middleButtonDown()&&1!=pointer.backButtonDown()&&1!=pointer.forwardButtonDown()&&null!=self.game.selectedItem&&self.game.selectedItem instanceof Card&&self.game.selectedItem.playType==self.type&&(self.buttonOpen.button.setTexture("gui",self.typeicon+"_invite"),self.buttonOpen.hover.setTexture("gui",self.typeicon+"_invite_down"),0==self.game.hand.cardIsInHand(self.game.selectedItem)&&self.showDeleteButton())})),this.phaser.input.on("dragend",(function(pointer,gameObject){1!=pointer.leftButtonDown()&&0==self.game.clickMode&&(self.buttonOpen.button.setTexture("gui",self.typeicon),self.buttonOpen.hover.setTexture("gui",self.typeicon+"_down"),self.hideDeleteButton())})),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.slots.push(new CardSlot(this,type,"")),this.drawerCounter=this.phaser.add.bitmapText(0,0,"text_white","6"),this.title=this.phaser.add.bitmapText(2*DRAWER_CARDS_MARGIN_LEFT,10,"text_black",""),this.title.setMaxWidth(140),this.container=this.phaser.add.container(0,0,this.buttonOpen.getContent()),this.container.add([this.drawerBackground,this.drawerLabel,this.title,this.drawerCounter]),this.container.add(this.buttonClose.getContent()),this.container.add(this.buttonSort.getContent()),this.container.depth=LAYER_DRAWER_CLOSED,this.container.setInteractive(),this.container.on("pointerout",(function(){self.openClose()})),this.container.x=80,this.container.y=0;for(var i=0;i<this.slots.length;i++)this.container.add(this.slots[i].getContent()),this.slots[i].actionAfterPull=this.openClose,this.slots[i].reclaimable=!0;this.update(),this.container.y=-this.drawerBackground.height-this.drawerBackground.y,this.open=!1}}