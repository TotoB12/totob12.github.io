class Walker{constructor(game,id,parentBlock,jump){_defineProperty(this,"pointerover",pointer=>{if(0==this.dragging)if(this.parentBlock.routeBmp.alpha=1,this.game.isBulldozer){var xmlData=this.phaser.cache.xml.get("cards").getElementsByTagName("card"),xmlData=getFirstElementByAttributeValue(xmlData,"id",this.id),costMoney=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("money"));costMoney=Math.floor(costMoney/2),this.game.showTooltip2(getString(this.game.language,"tooltip","sell_what","string")+" "+getString(this.game.language,"card",this.id,"name")+" "+getString(this.game.language,"tooltip","sell_for","string")+costMoney),this.sprite.setTint(16711680),this.sprite2&&this.sprite2.setTint(16711680)}else{this.game.showTooltip2(getString(this.game.language,"card",this.id,"name")),this.sprite.setTint(65280),this.sprite2&&this.sprite2.setTint(65280),this.parentBlock.targeterBmp.alpha=.25,this.parentBlock.floatieTxt.text="$ +"+this.gainWater1,this.parentBlock.floatieTxt.visible=!0;for(var i=0;i<this.parentBlock.blocks.length;i++)this.game.town.blocks[this.parentBlock.blocks[i]].floatieTxt.text="$ +"+this.gainWater2,this.game.town.blocks[this.parentBlock.blocks[i]].floatieTxt.visible=!0,this.game.town.blocks[this.parentBlock.blocks[i]].targeterBmp.alpha=.15}}),_defineProperty(this,"pointerout",pointer=>{this.game.hideTooltip(),this.parentBlock.routeBmp.alpha=0,this.parentBlock.targeterBmp.alpha=0,this.sprite.clearTint(),this.sprite2&&this.sprite2.clearTint(),this.parentBlock.floatieTxt.visible=!1;for(var i=0;i<this.parentBlock.blocks.length;i++)this.game.town.blocks[this.parentBlock.blocks[i]].floatieTxt.visible=!1,this.game.town.blocks[this.parentBlock.blocks[i]].targeterBmp.alpha=.01}),_defineProperty(this,"kill",()=>{this.id="",this.nodes=[],this.parentBlock=null,this.currentOriginNode=-1,this.currentTargetNode=-1,this.direction=0,this.soundPop.destroy(),this.sprite.input.enabled=!1,this.sprite2&&(this.sprite2.input.enabled=!1),this.phaser.tweens.killTweensOf(this.sprite),this.sprite2&&this.phaser.tweens.killTweensOf(this.sprite2),this.sprite.destroy(),this.sprite2&&this.sprite2.destroy()}),_defineProperty(this,"endDrag",pointer=>{if(this.phaser.input.setDragState(pointer,0),!this.game.isBulldozer&&!this.game.isDroppingWalker&&0!=this.dragging){this.game.selectedItem=null,this.parentBlock.routeBmp.alpha=0,this.game.town.hideSupplyDemand(),this.game.isDraggingWalker=!1,this.game.isTargetingBlocks=!1,this.game.isDroppingWalker=!0,this.game.updateLocks();var zoomtime=ZOOM_TWEEN_1;if(null!=this.game.selectedSpot&&this.game.selectedSpot instanceof TownBlock&&this.game.selectedSpot.fire>0){this.game.selectedSpot.startFire(-1),this.game.isDroppingWalker=!1,this.game.updateLocks(),this.returnWalker(pointer,!1);for(var ok=!0,i=0;i<this.game.town.blocks.length;i++)this.game.town.blocks[i].fire>0&&(ok=!1);1==ok&&this.game.fireloopsound.stop()}else{null==this.game.selectedSpot&&(this.game.selectedSpot=this.parentBlock,zoomtime=0),this.parentBlock=this.game.selectedSpot,this.currentOriginNode=-1,this.currentTargetNode=-1,this.game.town.updateSupply(),this.game.alwaysShowSupplyDemand&&this.game.town.showSupplyDemand(),this.parentBlock.showSupplyDemand(zoomtime);for(var i=0;i<this.parentBlock.blocks.length;i++){var time=150;0==zoomtime&&(time=0),setTimeout((function(t,i,zoomtime){t.game.town.blocks[t.parentBlock.blocks[i]].showSupplyDemand(zoomtime)}),time*(i+1),this,i,zoomtime)}this.game.selectedSpot=null,this.wagonInert=0,this.wagonSpeedX=[],this.wagonSpeedY=[],this.wagonX=[],this.wagonY=[],this.x=0,this.y=0,this.targetX=0,this.targetY=0,this.speedX=0,this.speedY=0,this.getNewHeading();var dist=Math.sqrt(Math.pow(this.x-pointer.x,2)+Math.pow(this.y-pointer.y,2));(dist*=2)>800&&(dist=800),dist<200&&(dist=200),12==this.game.tutorial&&(this.game.tutorial=13),this.spawn(dist)}}}),_defineProperty(this,"spawn",dist=>{this.sprite2&&(this.phaser.tweens.add({targets:[this.sprite2],x:this.parentBlock.x+this.wagonInertMax*this.direction,y:this.parentBlock.y,ease:"Cubic.Out",duration:0}),this.sprite2.visible=!1),this.phaser.tweens.add({targets:[this.sprite],x:this.parentBlock.x,y:this.parentBlock.y,ease:"Cubic.Out",duration:dist,onComplete:function(){this.sprite2&&this.sprite.anims.currentAnim.key!=this.animDrag&&(this.sprite2.visible=!0),this.phaser.tweens.add({targets:[this.sprite],alpha:1,ease:"Cubic.Out",duration:300,onComplete:function(){this.setSails(),13==this.game.tutorial&&(this.game.tutorial=14),this.sprite2&&(this.sprite2.visible=!0),this.sprite.depth=this.y-this.sprite.height/2,this.sprite.depth<1&&(this.sprite.depth=1),this.sprite2&&(this.sprite2.depth=this.y-this.sprite2.height/2,this.sprite2.depth<1&&(this.sprite2.depth=1),this.sprite2.visible=!0,this.sprite2.flipX=this.sprite.flipX,this.sprite2.play(this.animRight2,!0,this.sprite.anims.currentFrame.index)),this.game.isDroppingWalker=!1,this.game.updateLocks(),this.soundPop.play({detune:200*Math.random()-100})},onCompleteScope:this}),this.sprite2&&this.phaser.tweens.add({targets:[this.sprite2],x:this.x+this.wagonInertMax*this.direction,y:this.y,ease:"Bounce.Out",duration:1e3}),this.phaser.tweens.add({targets:[this.sprite],x:this.x,y:this.y,ease:"Bounce.Out",duration:1e3,onComplete:function(){this.dragging=!1,this.setSails(),this.cooldown=0,null==this.game.selectedItem&&this.game.town.hideSupplyDemand()},onCompleteScope:this})},onCompleteScope:this})}),_defineProperty(this,"setEnabled",value=>{this.sprite.input.enabled=value,this.sprite2&&(this.sprite2.input.enabled=value)}),_defineProperty(this,"pointerDown",pointer=>{this.parentBlock.floatieTxt.visible=!1;for(var i=0;i<this.parentBlock.blocks.length;i++)this.game.town.blocks[this.parentBlock.blocks[i]].floatieTxt.visible=!1,this.game.town.blocks[this.parentBlock.blocks[i]].targeterBmp.alpha=.01;1==this.game.isBulldozer&&1==pointer.leftButtonDown()&&(this.endDrag(pointer),this.setEnabled(!1),this.parentBlock.routeBmp.alpha=0,this.game.hand.cards.length>=5?this.game.popup.show(getString(this.game.language,"popup","sell_6th","header"),getString(this.game.language,"popup","sell_6th","string"),this.sellToDiscard,this.nothing):this.returnWalkerToHand(pointer,!0))}),_defineProperty(this,"sellToDiscard",()=>{this.returnWalker(null,!0)}),_defineProperty(this,"nothing",()=>{this.setEnabled(!0)}),_defineProperty(this,"returnWalkerToHand",(pointer,refund)=>{this.game.hand.addCard2(this.id,this.x,this.y),this.game.hand.positionCards(),this.returnWalker2(pointer,refund)}),_defineProperty(this,"returnWalker",(pointer,refund)=>{this.game.hand.flyFakeCard(this.x,this.y,.1,this.game.deck.discarded_bmp.x-CARD_WIDTH/2,this.game.deck.discarded_bmp.y-CARD_BIG_HEIGHT/2,1,500,500,0,50,"Sine.InOut",1,100),this.game.deck.discarded.push(this.id),this.returnWalker2(pointer,refund)}),_defineProperty(this,"returnWalker2",(pointer,refund)=>{var xmlData=this.phaser.cache.xml.get("cards").getElementsByTagName("card"),xmlData=getFirstElementByAttributeValue(xmlData,"id",this.id),costMoney=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("money")),costInfluence=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("infl"));refund&&this.game.pay(-Math.floor(costMoney/2),-Math.floor(costInfluence/2),this,!0,!1);for(var i=0;i<this.game.town.walkers.length;i++)if(this.game.town.walkers[i]==this){this.game.town.walkers.splice(i,1);break}this.game.town.updateSupply(),this.parentBlock.showSupplyDemand(ZOOM_TWEEN_1);for(var i=0;i<this.parentBlock.blocks.length;i++)this.game.town.blocks[this.parentBlock.blocks[i]].showSupplyDemand(ZOOM_TWEEN_1);setTimeout(this.game.town.hideSupplyDemandSoft,1e3),this.kill(),setTimeout(this.game.deck.updateDiscarded,550)}),_defineProperty(this,"startDrag",pointer=>{this.game.isBulldozer||(this.game.hideTooltip(),this.soundPop.play({detune:200*Math.random()-100}),pointer.rightButtonDown()||1==pointer.middleButtonDown()||1==pointer.backButtonDown()||1==pointer.forwardButtonDown()||this.game.isDroppingWalker||this.dragging||(this.game.selectedItem=this,this.game.drawer1.open&&this.game.drawer1.openClose(),this.game.drawer2.open&&this.game.drawer2.openClose(),this.game.drawer3.open&&this.game.drawer3.openClose(),this.game.town.showSupplyDemand(0),this.game.town.resetSimulation(),this.game.isDraggingWalker=!0,this.game.isDroppingWalker=!1,this.game.isTargetingBlocks=!0,this.game.updateLocks(),this.dragging=!0,this.sprite2&&(this.sprite2.visible=!1),this.sprite.clearTint(),this.sprite2&&this.sprite2.clearTint(),this.sprite2&&(this.sprite2.visible=!1),this.sprite.blendMode=Phaser.BlendModes.NORMAL,this.sprite2&&(this.sprite2.blendMode=Phaser.BlendModes.NORMAL),this.sprite.play(this.animDrag),this.sprite.depth=LAYER_CARD,this.phaser.tweens.killTweensOf(this.sprite),this.sprite2&&this.phaser.tweens.killTweensOf(this.sprite2),this.phaser.tweens.add({targets:[this.sprite],x:pointer.x,y:pointer.y+16,ease:"Cubic.InOut",duration:100}),this.dragMe(pointer,pointer.x,pointer.y)))}),_defineProperty(this,"dragMe",(pointer,dragX,dragY)=>{if(!this.game.isBulldozer&&0!=this.dragging&&!this.game.isDroppingWalker){if(this.parentBlock.routeBmp.alpha=.5,this.parentBlock.routeBmp.clearTint(),1==pointer.rightButtonDown()||1==pointer.middleButtonDown()||1==pointer.backButtonDown()||1==pointer.forwardButtonDown())return self.game.selectedSpot=null,void this.endDrag(pointer);this.sprite.x=dragX,this.sprite.y=pointer.y+16}}),_defineProperty(this,"setSails",()=>{var xDist=this.targetX-this.x,yDist=this.targetY-this.y,angle=Math.atan2(yDist,xDist);this.speedX=Math.cos(angle)*this.speed,this.speedY=Math.sin(angle)*this.speed,Math.abs(this.speedY)>2*Math.abs(this.speedX)?this.speedY>0?this.sprite.play(this.animDown):this.sprite.play(this.animUp):this.sprite.play(this.animRight),this.speedX>0?this.sprite.flipX=!1:this.sprite.flipX=!0}),_defineProperty(this,"getNewHeading",()=>{if(-1==this.currentOriginNode){var node1=this.parentBlock.nodes.length-1,node2=this.parentBlock.nodes.length-2;Math.random()>.5?(this.currentOriginNode=node1,this.direction=-1):(this.currentOriginNode=node2,this.direction=1),this.x=(this.game.town.nodes[this.parentBlock.nodes[node1]].x+this.game.town.nodes[this.parentBlock.nodes[node2]].x)/2+3,this.y=(this.game.town.nodes[this.parentBlock.nodes[node1]].y+this.game.town.nodes[this.parentBlock.nodes[node2]].y)/2+3,this.hasWagon&&(this.sprite2.x=this.x,this.sprite2.y=this.y),1==this.roaming&&(this.currentOriginNode=this.parentBlock.nodes[this.currentOriginNode],this.currentTargetNode=this.currentOriginNode,this.parentBlock=null)}else 0==this.roaming&&(this.currentOriginNode=this.currentTargetNode);if(this.roaming){var previousNode=this.currentOriginNode;this.currentOriginNode=this.currentTargetNode;for(var nodes=this.game.town.nodes[this.currentOriginNode].nodes,candidates=[],i=0;i<nodes.length;i++)nodes[i]!=previousNode&&candidates.push(nodes[i]);this.currentTargetNode=candidates[Math.floor(Math.random()*candidates.length)],this.targetX=this.game.town.nodes[this.currentTargetNode].x+3,this.targetY=this.game.town.nodes[this.currentTargetNode].y+3}else this.currentTargetNode=this.currentOriginNode+this.direction,this.currentTargetNode>=this.parentBlock.nodes.length&&(this.currentTargetNode=0),this.currentTargetNode<0&&(this.currentTargetNode=this.parentBlock.nodes.length-1),this.targetX=this.game.town.nodes[this.parentBlock.nodes[this.currentTargetNode]].x+3,this.targetY=this.game.town.nodes[this.parentBlock.nodes[this.currentTargetNode]].y+3}),_defineProperty(this,"update",(time,delta)=>{if(1!=this.dragging)if(this.cooldown>0)this.cooldown-=delta;else{if(this.x+=this.speedX*delta*.001,this.y+=this.speedY*delta*.001,this.hasWagon)if(this.wagonSpeedX.push(this.speedX),this.wagonSpeedY.push(this.speedY),this.wagonX.push(this.x),this.wagonY.push(this.y),Math.abs(this.wagonSpeedY[Math.floor(0*this.wagonSpeedY.length)])>2*Math.abs(this.wagonSpeedX[Math.floor(0*this.wagonSpeedY.length)])?this.wagonSpeedY[Math.floor(0*this.wagonSpeedY.length)]>0?this.sprite2.play(this.animDown2,!0,this.sprite.anims.currentFrame.index):this.sprite2.play(this.animUp2,!0,this.sprite.anims.currentFrame.index):this.sprite2.play(this.animRight2,!0,this.sprite.anims.currentFrame.index),this.wagonSpeedX[Math.floor(0*this.wagonSpeedY.length)]>0?this.sprite2.flipX=!1:this.sprite2.flipX=!0,this.wagonInert<this.wagonInertMax)this.wagonInert+=this.speed*delta*.001,this.sprite2.x=this.x+this.wagonInertMax*this.direction,this.sprite2.y=this.y,this.wagonEased=!1;else{if(0==this.wagonEased){var xxx=this.wagonX[0],yyy=this.wagonY[0];this.phaser.tweens.add({targets:[this.sprite2],x:this.wagonX[0],y:this.wagonY[0],ease:"Cubic.Out",duration:300,onComplete:function(){this.wagonEased=!0}})}else this.sprite2.x=this.wagonX[0],this.sprite2.y=this.wagonY[0];this.sprite2.depth=this.sprite2.y-this.sprite2.height/2,this.sprite2.depth<1&&(this.sprite2.depth=1),this.wagonSpeedX.shift(),this.wagonSpeedY.shift(),this.wagonX.shift(),this.wagonY.shift()}this.sprite.x=this.x,this.sprite.y=this.y,this.game.isBulldozer?(this.sprite.setDepth(LAYER_SUPPLY_DEMAND+10),null!=this.sprite2&&this.sprite2.setDepth(LAYER_SUPPLY_DEMAND+10)):(this.sprite.depth=this.sprite.y-this.sprite.height/2,this.sprite.depth<1&&(this.sprite.depth=1),null!=this.sprite2&&(this.sprite2.depth=this.sprite2.y-this.sprite2.height/2,this.sprite2.depth<1&&(this.sprite2.depth=1)));var reachedX=!1,reachedY=!1;(Math.round(this.x)>=this.targetX&&this.speedX>0||Math.round(this.x)<=this.targetX&&this.speedX<0||0==this.speedX)&&(reachedX=!0),(Math.round(this.y)>=this.targetY&&this.speedY>0||Math.round(this.y)<=this.targetY&&this.speedY<0||0==this.speedY)&&(reachedY=!0),1==reachedX&&1==reachedY&&(this.speedX=0,this.speedY=0,this.getNewHeading(),this.setSails())}});var phaser=game.phaser;this.phaser=game.phaser,this.game=game;var self=this;this.id=id,this.nodes=[],this.parentBlock=parentBlock,this.currentOriginNode=-1,this.currentTargetNode=-1,this.direction=0,this.cooldown=0,this.soundPop=this.phaser.sound.add("pop"),this.xmlDataCard=this.phaser.cache.xml.get("cards").getElementsByTagName("card"),this.xmlDataCard=getFirstElementByAttributeValue(this.xmlDataCard,"id",this.id),this.gainWater1=Number(this.xmlDataCard.getElementsByTagName("gain")[0].getAttribute("water_1")),this.gainWater2=Number(this.xmlDataCard.getElementsByTagName("gain")[0].getAttribute("water_2")),this.sprite=null,this.sprite2=null,this.draggable=!1,this.dragging=!1,this.xmlData=this.phaser.cache.xml.get("walkers").getElementsByTagName("walker"),this.xmlData=getFirstElementByAttributeValue(this.xmlData,"id",this.id),this.spriteName=this.xmlData.getElementsByTagName("sprite")[0].getAttribute("spriteName"),this.animRight=this.spriteName+"_walk_right",this.animDown=this.spriteName+"_walk_down",this.animUp=this.spriteName+"_walk_up",this.animDrag=this.spriteName+"_hanging",this.spriteBase=Number(this.xmlData.getElementsByTagName("sprite")[0].getAttribute("spriteBase")),this.hasWagon=!1,this.wagonInert=0,this.wagonInertMax=0,this.wagonSpeedLenMax=0,this.wagonEased=!1,this.wagonSpeedX=[],this.wagonSpeedY=[],this.wagonX=[],this.wagonY=[],0!=this.xmlData.getElementsByTagName("sprite2").length&&(this.hasWagon=!0,this.spriteName2=this.xmlData.getElementsByTagName("sprite2")[0].getAttribute("spriteName"),this.animRight2=this.spriteName2+"_walk_right",this.animDown2=this.spriteName2+"_walk_down",this.animUp2=this.spriteName2+"_walk_up",this.animDrag2=this.spriteName2+"_hanging",this.spriteBase2=this.xmlData.getElementsByTagName("sprite2")[0].getAttribute("spriteBase")),this.x=0,this.y=0,this.targetX=0,this.targetY=0;var s=1*Number(this.xmlData.getElementsByTagName("behavior")[0].getAttribute("speed"));this.speed=s+Math.random()*s*.5,this.speedX=0,this.speedY=0,this.roaming="true"==this.xmlData.getElementsByTagName("behavior")[0].getAttribute("roaming"),this.sprite=this.phaser.add.sprite(0,0,this.spriteName),this.sprite.play(this.animRight),this.sprite.depth=LAYER_CARD,this.sprite.originY=this.spriteBase,1==this.hasWagon&&(this.sprite2=this.phaser.add.sprite(0,0,this.spriteName2),this.sprite2.play(this.animRight2),this.sprite2.depth=LAYER_CARD,this.sprite2.originY=this.spriteBase2,this.wagonInertMax=20),this.draggable="true"==this.xmlData.getElementsByTagName("behavior")[0].getAttribute("draggable"),this.draggable&&(this.sprite.setSize(this.sprite.width,this.sprite.height),this.sprite.setInteractive({cursor:"pointer"}),this.sprite.input.useHandCursor=!0,phaser.input.setDraggable(this.sprite),this.sprite2&&(this.sprite2.setSize(this.sprite2.width,this.sprite2.height),this.sprite2.setInteractive({cursor:"pointer"}),this.sprite2.input.useHandCursor=!0,phaser.input.setDraggable(this.sprite2))),1==jump?(this.game.isDroppingWalker=!0,this.game.updateLocks(),this.dragging=!0,this.sprite.x=this.parentBlock.x,this.sprite.y=this.parentBlock.y,this.sprite2&&(this.sprite2.x=this.sprite.x+this.wagonInertMax*this.direction,this.sprite2.y=this.sprite.y),this.getNewHeading(),this.spawn(100)):(this.getNewHeading(),this.setSails()),this.sprite.on("pointerover",this.pointerover),this.sprite.on("pointerout",this.pointerout),this.sprite2&&this.sprite2.on("pointerover",this.pointerover),this.sprite2&&this.sprite2.on("pointerout",this.pointerout),this.sprite.on("dragstart",this.startDrag),this.sprite2&&this.sprite2.on("dragstart",this.startDrag),this.sprite.on("dragend",(function(pointer){0==self.game.clickMode&&self.endDrag(pointer)})),this.sprite2&&this.sprite2.on("dragend",(function(pointer){0==self.game.clickMode&&self.endDrag(pointer)})),this.sprite.on("drag",this.dragMe),this.sprite2&&this.sprite2.on("drag",this.dragMe),this.sprite.on("pointerdown",this.pointerDown),this.sprite2&&this.sprite2.on("pointerdown",this.pointerDown)}}