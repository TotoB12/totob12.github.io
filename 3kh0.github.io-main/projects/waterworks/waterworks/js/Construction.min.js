class Construction{constructor(g,id){_defineProperty(this,"deleteConstruction",()=>{this.constructionId="",this.costMoney=0,this.costInfl=0;for(var i=0;i<this.allSlots.length;i++)this.allSlots[i].hide();this.slots=[]}),_defineProperty(this,"cancelConstructionQuestion",()=>{if(!(this.game.tutorial<10)){var message=getString(this.game.language,"popup","construction_cancel","string"),refund=this.calculateRefund();message+="\n\n"+capitalize(getString(this.game.language,"gui","refund","string"))+":",message+="\n@ "+refund[0]+"\n\n# "+refund[1],this.game.popup.show(getString(this.game.language,"popup","construction_cancel","header"),message,this.cancelConstruction,(function(){}))}}),_defineProperty(this,"cancelConstruction",value=>{null==value&&(value=!0),this.discardAll(value),this.game.hand.flyFakeCard(this.buttonDelete.button.x,this.buttonDelete.button.y,1,this.game.deck.discarded_bmp.x-CARD_WIDTH/2,this.game.deck.discarded_bmp.y-CARD_BIG_HEIGHT/2,1,500,500,500,500,"Sine.InOut",1),this.game.deck.discarded.push(this.constructionId),this.deleteConstruction(),this.open&&this.openCloseConstruction(),this.update()}),_defineProperty(this,"failRequest",()=>{var fakePointer=new Object;fakePointer.x=36,fakePointer.y=244,gameanalytics.GameAnalytics.addDesignEvent("request_failed:"+this.constructionId,this.game.turn),this.game.pay(-this.loseMoney,-this.loseInfl,fakePointer,!0,!0),this.discardAll(!1),this.deleteConstruction(),this.open&&this.openCloseConstruction(),this.update()}),_defineProperty(this,"calculateRefund",()=>{for(var result=[0,0],i=0;i<this.slots.length;i++)this.slots[i].gotCard&&(result[0]+=Math.floor(this.slots[i].fakeCard.costMoney/2),result[1]+=Math.floor(this.slots[i].fakeCard.costInfluence/2));return result}),_defineProperty(this,"discardAll",refund=>{for(var i=0;i<this.slots.length;i++)this.slots[i].gotCard&&("false"!=this.slots[i].fakeCard.consume&&1!=refund||(this.game.deck.discarded.push(this.slots[i].fakeCard.id),this.game.hand.flyFakeCard(this.slots[i].fakeCard.card.x,this.slots[i].fakeCard.card.y,1,this.game.deck.discarded_bmp.x-CARD_WIDTH/2,this.game.deck.discarded_bmp.y-CARD_BIG_HEIGHT/2,1,250,250,0,100*i,"Sine.InOut",1)));if(refund){var ref=this.calculateRefund(),fakePointer=new Object;fakePointer.x=GAME_WIDTH/2,fakePointer.y=GAME_HEIGHT/2,this.game.pay(-ref[0],-ref[1],fakePointer,!0,!1)}}),_defineProperty(this,"finishConstruction",()=>{this.update();var fakePointer=new Object;fakePointer.x=this.buttonFinish.button.x,fakePointer.y=this.buttonFinish.button.y+50;var counter=0;if(this.readyToBuildCards){if(this.game.pay(this.costMoney,this.costInfl,fakePointer,!1,!1)){if(this.game.pay(this.costMoney,this.costInfl,fakePointer,!0,!1),this.discardAll(!1),"hermans_ditch"==this.constructionId?(this.game.unlockAchievement("hermans"),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),gameanalytics.GameAnalytics.addProgressionEvent(gameanalytics.EGAProgressionStatus.Complete,"age1"),gameanalytics.GameAnalytics.addDesignEvent("age1_complete:turns",this.game.turn),gameanalytics.GameAnalytics.addDesignEvent("age1_complete:coins",this.game.money),gameanalytics.GameAnalytics.addDesignEvent("age1_complete:influence",this.game.infl),gameanalytics.GameAnalytics.addDesignEvent("age1_complete:difficulty",this.game.difficulty)):"trynka_channel"==this.constructionId&&(this.game.unlockAchievement("trynka"),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),this.game.town.population.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19),gameanalytics.GameAnalytics.addProgressionEvent(gameanalytics.EGAProgressionStatus.Complete,"age2"),gameanalytics.GameAnalytics.addDesignEvent("age2_complete:turns",this.game.turn),gameanalytics.GameAnalytics.addDesignEvent("age2_complete:coins",this.game.money),gameanalytics.GameAnalytics.addDesignEvent("age2_complete:influence",this.game.infl),gameanalytics.GameAnalytics.addDesignEvent("age2_complete:difficulty",this.game.difficulty)),0==this.gainMoney&&0==this.gainInfl||(fakePointer.y=this.buttonFinish.button.y+80,this.game.pay(-this.gainMoney,-this.gainInfl,fakePointer,!0,!0)),0==this.id&&this.game.town.constructions.push(this.constructionId),this.xmlData=this.phaser.cache.xml.get("constructions").getElementsByTagName("construction"),this.xmlData=getFirstElementByAttributeValue(this.xmlData,"id",this.constructionId),this.xmlData.getElementsByTagName("unlock").length>0){var unlock=this.xmlData.getElementsByTagName("unlock")[0].id;"quarters"==unlock&&(this.game.drawer3.level++,this.game.drawer3.update(),this.game.drawer3.open=!1,this.game.drawer3.openClose()),"warehouse"==unlock&&(this.game.drawer2.level++,this.game.drawer2.update(),this.game.drawer2.open=!1,this.game.drawer2.openClose()),"archive"==unlock&&(this.game.drawer1.level++,this.game.drawer1.update(),this.game.drawer1.open=!1,this.game.drawer1.openClose())}for(var cards=this.xmlData.getElementsByTagName("add_cards"),i=0;i<cards.length;i++)for(var j=0;j<Number(cards[i].getAttribute("amount"));j++)this.game.deck.stack.push(cards[i].getAttribute("id")),this.game.hand.flyFakeCard(fakePointer.x+2*counter,fakePointer.y+5*counter,1,this.game.deck.stack_bmp.x-CARD_WIDTH/2,this.game.deck.stack_bmp.y-CARD_BIG_HEIGHT/2,1,250,250,0,50*counter,"Sine.InOut",1),counter++;this.game.deck.updateDeckNumber(),cards=this.xmlData.getElementsByTagName("remove_cards");for(var i=0;i<cards.length;i++){for(var id=cards[i].getAttribute("id"),j=0;j<this.game.deck.stack.length;j++)this.game.deck.stack[j]==id&&(this.game.deck.stack.splice(j,1),j--);for(var j=0;j<this.game.deck.discarded.length;j++)this.game.deck.discarded[j]==id&&(this.game.deck.discarded.splice(j,1),j--);for(var j=0;j<this.game.drawer1.slots.length;j++)this.game.drawer1.slots[j].card&&this.game.drawer1.slots[j].card.id==id&&(this.game.drawer1.slots[j].card.destroy(!1),this.game.drawer1.slots[j].card=null);for(var j=0;j<this.game.drawer2.slots.length;j++)this.game.drawer2.slots[j].card&&this.game.drawer2.slots[j].card.id==id&&(this.game.drawer2.slots[j].card.destroy(!1),this.game.drawer2.slots[j].card=null);for(var j=0;j<this.game.drawer3.slots.length;j++)this.game.drawer3.slots[j].card&&this.game.drawer3.slots[j].card.id==id&&(this.game.drawer3.slots[j].card.destroy(!1),this.game.drawer3.slots[j].card=null);this.game.hand.removeCardsFromHandById(id,!0)}cards=this.xmlData.getElementsByTagName("replace_cards");for(var i=0;i<cards.length;i++){for(var old_id=cards[i].getAttribute("old_id"),new_id=cards[i].getAttribute("new_id"),j=0;j<this.game.deck.stack.length;j++)this.game.deck.stack[j]==old_id&&(this.game.deck.stack.splice(j,1),this.game.deck.stack.push(new_id),j--);for(var j=0;j<this.game.deck.discarded.length;j++)this.game.deck.discarded[j]==old_id&&(this.game.deck.discarded.splice(j,1),this.game.deck.discarded.push(new_id),j--);for(var j=0;j<this.game.drawer1.slots.length;j++){var card;if(this.game.drawer1.slots[j].card&&this.game.drawer1.slots[j].card.id==old_id)this.game.drawer1.slots[j].card.destroy(!1),this.game.drawer1.slots[j].card=null,(card=new Card(this.game.hand,new_id)).selectedSpot=this.game.drawer1.slots[j],this.game.drawer1.slots[j].grabACard(card)}for(var j=0;j<this.game.drawer2.slots.length;j++){var card;if(this.game.drawer2.slots[j].card&&this.game.drawer2.slots[j].card.id==old_id)this.game.drawer2.slots[j].card.destroy(!1),this.game.drawer2.slots[j].card=null,(card=new Card(this.game.hand,new_id)).selectedSpot=this.game.drawer2.slots[j],this.game.drawer2.slots[j].grabACard(card)}for(var j=0;j<this.game.drawer3.slots.length;j++){var card;if(this.game.drawer3.slots[j].card&&this.game.drawer3.slots[j].card.id==old_id)this.game.drawer3.slots[j].card.destroy(!1),this.game.drawer3.slots[j].card=null,(card=new Card(this.game.hand,new_id)).selectedSpot=this.game.drawer3.slots[j],this.game.drawer3.slots[j].grabACard(card)}if("true"==cards[i].getAttribute("include_played"))for(var j=0;j<this.game.town.walkers.length;j++)if(this.game.town.walkers[j].id==old_id){var parentBlock=this.game.town.walkers[j].parentBlock,walker;this.game.town.walkers.splice(j,1)[0].kill(),j--,this.game.town.walkers.push(new Walker(this.game,new_id,parentBlock,!0))}for(var count=this.game.hand.removeCardsFromHandById(old_id,!0),j=0;j<count;j++)this.game.hand.addCard(new_id);this.game.hand.positionCards()}if("water_source"==this.constructionId&&(this.game.fireChance=-999),"waterworks"==this.constructionId&&17==this.game.tutorial&&(this.game.tutorial=18),this.open&&this.openCloseConstruction(),this.constructionComplete.play(),0==this.id)if(gameanalytics.GameAnalytics.addDesignEvent("construction_complete:"+this.constructionId,this.game.turn),"wass"==this.constructionId)this.game.fanfaresound.play(),this.game.popup.show(getString(this.game.language,"popup","victory","header"),getString(this.game.language,"popup","victory","string"),this.game.victory,null),gameanalytics.GameAnalytics.addProgressionEvent(gameanalytics.EGAProgressionStatus.Complete,"age3"),gameanalytics.GameAnalytics.addDesignEvent("age3_complete:turns",this.game.turn),gameanalytics.GameAnalytics.addDesignEvent("age3_complete:coins",this.game.money),gameanalytics.GameAnalytics.addDesignEvent("age3_complete:influence",this.game.infl),gameanalytics.GameAnalytics.addDesignEvent("age3_complete:difficulty",this.game.difficulty);else{"trynka_channel"!=this.constructionId&&"hermans_ditch"!=this.constructionId&&"wass"!=this.constructionId||this.game.fanfaresound.play();var picture=this.xmlData.getAttribute("image"),finish_txt=getString(this.game.language,"construction",this.constructionId,"complete"),finish_header=getString(this.game.language,"construction",this.constructionId,"name")+" "+getString(this.game.language,"gui","construction_complete","string");this.game.popup.showBig(picture,finish_header,finish_txt,null,null)}else{gameanalytics.GameAnalytics.addDesignEvent("request_complete:"+this.constructionId,this.game.turn);var temp0="",temp1="",temp2="";1!=this.game.difficulty&&this.game.ach_requests_count++,this.game.ach_requests_count>=ACH_REQUESTS_TO_MAKE&&this.game.unlockAchievement("requests"),0==this.gainMoney&&0==this.gainInfl||(temp0=getString(this.game.language,"gui","completion reward","string")+":\n\n"),0!=this.gainMoney&&(temp1="@ "+this.gainMoney+" "),0!=this.gainInfl&&(temp2="# "+this.gainInfl+" "),this.game.popup.show(getString(this.game.language,"construction",this.constructionId,"name")+" - "+getString(this.game.language,"popup","request_complete","header"),getString(this.game.language,"construction",this.constructionId,"complete")+"\n\n"+temp0+temp1+temp2,null,null)}if(this.game.deck.updateDeckNumber(),this.deleteConstruction(),this.update(),null!=this.sparks){this.game.phaser.children.bringToTop(this.game.particles);for(var i=0;i<10;i++)this.game.particles.explode(900,this.sparks.x-30+60*Math.random(),this.sparks.y-10+20*Math.random())}this.game.update(0,0),this.game.town.updateSupply(),this.game.updateInflGain(),this.game.calculatePerTurn()}}else this.game.floatText(getString(this.game.language,"gui","conditions_not_met","string"),fakePointer,25,5),this.game.deny.play()}),_defineProperty(this,"startConstruction",id=>{0==this.game.menu.container.visible&&0==this.game.options.container.visible&&this.constructionStart.play(),this.buttonDelete.tooltip="cancel_construction",this.game.tutorial<10&&(this.buttonDelete.tooltip="cancel_construction_tutorial"),this.deleteConstruction(),this.constructionId=id,this.xmlData=this.phaser.cache.xml.get("constructions").getElementsByTagName("construction"),this.xmlData=getFirstElementByAttributeValue(this.xmlData,"id",this.constructionId),this.costMoney=Number(this.xmlData.getElementsByTagName("cost")[0].getAttribute("money")),this.costInfl=Number(this.xmlData.getElementsByTagName("cost")[0].getAttribute("infl")),this.costMoney=Math.round(this.costMoney*this.game.difficultyPriceMod),this.costInfluence=Math.round(this.costInfluence*this.game.difficultyPriceMod),this.gainMoney=Number(this.xmlData.getElementsByTagName("gain")[0].getAttribute("money")),this.gainInfl=Number(this.xmlData.getElementsByTagName("gain")[0].getAttribute("infl")),this.sparks=null,this.sparks=new Phaser.Math.Vector2,this.sparks.x=Number(this.xmlData.getElementsByTagName("sparks")[0].getAttribute("x")),this.sparks.y=Number(this.xmlData.getElementsByTagName("sparks")[0].getAttribute("y")),1==this.id&&(this.timer=Number(this.xmlData.getAttribute("time"))+Math.floor(Math.random()*Number(this.xmlData.getAttribute("timespan"))),this.loseMoney=Number(this.xmlData.getElementsByTagName("lose")[0].getAttribute("money")),this.loseInfl=Number(this.xmlData.getElementsByTagName("lose")[0].getAttribute("infl")));for(var cards=this.xmlData.getElementsByTagName("card"),i=0;i<cards.length;i++)this.slots.push(this.allSlots[i]),this.slots[i].init(cards[i].getAttribute("type"),cards[i].getAttribute("id"));for(var lines=1+Math.floor((this.slots.length-1)/CONSTRUCTION_CARDS_PER_ROW),i=0;i<lines;i++){var rowsBeginsAt=i*CONSTRUCTION_CARDS_PER_ROW;if(rowsBeginsAt>=this.slots.length)break;var rows=this.slots.length-rowsBeginsAt;if(rows>CONSTRUCTION_CARDS_PER_ROW&&(rows=CONSTRUCTION_CARDS_PER_ROW),rows<=0)break;for(var j=0;j<rows;j++){var index=rowsBeginsAt+j;this.container.add(this.slots[index].getContent()),this.slots[index].position(CONSTRUCTION_CARDS_MARGIN_LEFT+(j*(CARD_WIDTH+CONSTRUCTION_CARDS_MARGIN)+(CARD_WIDTH+CONSTRUCTION_CARDS_MARGIN)*(CONSTRUCTION_CARDS_PER_ROW-rows)/2),CONSTRUCTION_CARDS_MARGIN_TOP+(CARD_SMALL_HEIGHT+CONSTRUCTION_CARDS_MARGIN)*i+(CARD_SMALL_HEIGHT+CONSTRUCTION_CARDS_MARGIN)*(3-lines)/2)}}this.update(),this.openCloseConstruction()}),_defineProperty(this,"update",()=>{if(this.rays1.visible=!1,this.rays2.visible=!1,this.rays3.visible=!1,this.rays4.visible=!1,""==this.constructionId)return"0"==this.id?this.buttonOpen.button.setTexture("gui","construction_open_grayed"):this.container.visible=!1,this.buttonOpen.hover.input.enabled=!1,this.buttonOpen.previouslyEnabled=!1,this.readyToBuild=!1,void(this.readyToBuildCards=!1);this.container.visible=!0,"0"==this.id?this.buttonOpen.button.setTexture("gui","construction_open"):this.buttonOpen.button.setTexture("gui","request_open"),this.buttonOpen.hover.input.enabled=!0,this.priceCaption.text=getString(this.game.language,"gui","finalisation cost","string")+":\n\n@\n\n#",this.price1.text=""+this.costMoney,this.price2.text=""+this.costInfl,this.price1.setTint(0),this.price2.setTint(0),this.readyToBuild=!0,this.readyToBuildCards=!0;for(var i=0;i<this.slots.length;i++)if(0==this.slots[i].gotCard){this.readyToBuild=!1,this.readyToBuildCards=!1;break}0==this.id?this.timeLimitCaption.visible=!1:(this.timer<3?(this.timeLimitCaption.setTint(16711680),this.timeLimitSmall.setTint(16711680)):(this.timeLimitCaption.clearTint(),this.timeLimitSmall.clearTint()),this.timeLimitCaption.text=getString(this.game.language,"gui","time limit","string")+"\n\n"+this.timer+"\n\n"+getString(this.game.language,"gui","turns","string"),this.timeLimitCaption.setCenterAlign(),this.timeLimitSmall.text="^"+this.timer,this.timeLimitSmall.x=this.buttonOpen.button.x+28-this.timeLimitSmall.width),this.costMoney>0&&this.game.money<this.costMoney&&(this.readyToBuild=!1,this.price1.setTint(16711680)),this.costInfl>0&&this.game.infl<this.costInfl&&(this.readyToBuild=!1,this.price2.setTint(16711680)),1==this.readyToBuild?(this.open?(this.rays1.visible=!0,this.rays2.visible=!0,this.rays3.visible=!1,this.rays4.visible=!1):(this.rays1.visible=!1,this.rays2.visible=!1,this.rays3.visible=!0,this.rays4.visible=!0),this.buttonFinish.button.setTexture("gui","construction_complete"),this.buttonFinish.hover.setTexture("gui","construction_complete_down")):(this.buttonFinish.button.setTexture("gui","construction_complete_bw"),this.buttonFinish.hover.setTexture("gui","construction_complete_bw_down")),this.updateLanguage(),this.game.updateLocks()}),_defineProperty(this,"openCloseConstruction",()=>{if(!(0==this.id&&this.game.request.open||1==this.id&&this.game.construction.open)){var dur=500;1==this.autoOpened&&(dur=250),this.rays1.visible=!1,this.rays2.visible=!1,this.rays3.visible=!1,this.rays4.visible=!1,this.open?(this.game.menu.container.alpha>0||this.paper2.play({detune:100*Math.random()-50}),this.container.each(disableChildren),this.phaser.tweens.add({targets:[this.container],x:-this.constructionBackground.width,ease:"Cubic.InOut",duration:dur,onComplete:function(){""!=this.constructionId&&(this.buttonOpen.hover.input.enabled=!0),this.container.setDepth(LAYER_CONSTRUCTION)},onCompleteScope:this}),this.game.hideCurtain(),this.autoOpened=!1,1==this.readyToBuild&&(this.rays3.visible=!0,this.rays4.visible=!0)):(this.game.menu.container.alpha>0||this.paper1.play({detune:100*Math.random()-50}),this.game.switchSellMode(!1,null),this.container.setDepth(LAYER_CONSTRUCTION_ACTIVE),this.game.showCurtain(.5,LAYER_CURTAIN),this.buttonOpen.hover.input.enabled=!1,this.phaser.tweens.add({targets:[this.container],x:-5,ease:"Cubic.InOut",duration:dur,onComplete:function(){this.container.each(enableChildren);for(var i=0;i<this.slots.length;i++)this.slots[i].show()},onCompleteScope:this}),this.container.each(enableChildren),1==this.readyToBuild&&(this.rays1.visible=!0,this.rays2.visible=!0)),this.open=!this.open,this.game.updateLocks()}}),_defineProperty(this,"updateLanguage",()=>{this.title.text=getString(this.game.language,"construction",this.constructionId,"name"),this.description.text=getString(this.game.language,"construction",this.constructionId,"desc");for(var j=0;j<this.game.populationIncreaseConstructions.length;j++)this.constructionId==this.game.populationIncreaseConstructions[j]&&(this.description.text+="\n\n"+getString(this.game.language,"gui","population_increase_warning","string"));this.description2.text=" ",this.description2.setMaxWidth(225);var cards=this.xmlData.getElementsByTagName("add_cards");0==this.gainMoney&&0==this.gainInfl||(this.description2.text+=getString(this.game.language,"gui","completion reward","string")+":\n\n",0!=this.gainMoney&&(this.description2.text+="@ "+this.gainMoney+" "),0!=this.gainInfl&&(this.description2.text+="# "+this.gainInfl+" "),0==this.gainMoney&&0==this.gainInfl||(this.description2.text+="\n\n")),cards.length>0&&(this.description2.text+=getString(this.game.language,"gui","new cards","string")+":\n");for(var i=0;i<cards.length;i++)this.description2.text+=" "+getString(this.game.language,"card",cards[i].getAttribute("id"),"name").replace(/ /g,"*")+"}x"+Number(cards[i].getAttribute("amount")),i+1<cards.length?this.description2.text+=",":this.description2.text+=";";cards.length>0&&(this.description2.text+="\n"),1==this.id&&(0==this.loseMoney&&0==this.loseInfl||(this.description2.text+=getString(this.game.language,"gui","failure penalty","string")+":\n\n",0!=this.loseMoney&&(this.description2.text+="@ "+this.loseMoney+" "),0!=this.loseInfl&&(this.description2.text+="# "+this.loseInfl+" "),this.description2.text+="\n\n")),this.description2.setRightAlign(),this.description2.y=220-this.description2.height,this.description2.x=256-this.description2.width-10}),this.game=g,this.id=id,this.constructionId="",this.phaser=this.game.phaser;var self=this;this.open=!1,this.autoOpened=!1,this.readyToBuild=!1,this.readyToBuildCards=!1,this.constructionStart=this.phaser.sound.add("construction"),this.constructionComplete=this.phaser.sound.add("complete"),this.paper1=this.phaser.sound.add("paper1"),this.paper2=this.phaser.sound.add("paper2"),this.sparks=null,this.constructionBackground=this.phaser.add.image(0,0,"gui","construction_background"),this.constructionBackground.setOrigin(0),this.slots=[],this.allSlots=[],this.xmlData,this.costMoney=0,this.costInfl=0,this.gainMoney=0,this.gainInfl=0,this.timer=-1,this.loseMoney=0,this.loseInfl=0,this.buttonClose=new Button(this.game,"x","x_glow","gui",this.openCloseConstruction),this.buttonClose.tooltip="close",this.buttonClose.setPosition(4*CONSTRUCTION_CARDS_MARGIN+2,CONSTRUCTION_CARDS_MARGIN_TOP+this.buttonClose.hover.height/2),this.buttonDelete=new Button(this.game,"construction_del","construction_del_down","gui",this.cancelConstructionQuestion),this.buttonDelete.setPosition(this.buttonClose.button.x+this.buttonClose.button.width,this.buttonClose.button.y),this.buttonDelete.tooltip="cancel_construction",this.buttonFinish=new Button(this.game,"construction_complete","construction_complete_down","gui",this.finishConstruction),this.buttonFinish.setPosition(this.buttonDelete.button.x+this.buttonDelete.button.width/2+this.buttonFinish.button.width/2,this.buttonClose.button.y),this.buttonFinish.tooltip="finish_construction",this.requestBar=this.phaser.add.image(0,0,"gui","paper_bar"),this.requestBar.setOrigin(0),this.requestBar.x=48,0==this.id?(this.requestBar.visible=!1,this.buttonOpen=new Button(this.game,"construction_open","construction_open_down","gui",this.openCloseConstruction),this.buttonOpen.tooltip="open_close_construction",this.buttonOpen.setPosition(this.constructionBackground.width+2*CONSTRUCTION_CARDS_MARGIN,CONSTRUCTION_CARDS_MARGIN_TOP+3*CONSTRUCTION_CARDS_MARGIN-2)):1==this.id&&(this.buttonDelete.setVisible(!1),this.buttonFinish.tooltip="finish_request",this.buttonOpen=new Button(this.game,"request_open","request_open_down","gui",this.openCloseConstruction),this.buttonOpen.tooltip="open_close_request",this.buttonOpen.setPosition(this.constructionBackground.width+2*CONSTRUCTION_CARDS_MARGIN,CONSTRUCTION_CARDS_MARGIN_TOP+3*CONSTRUCTION_CARDS_MARGIN+50-3)),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,"")),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,"")),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,"")),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,"")),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,"")),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,"")),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,"")),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,"")),this.allSlots.push(new CardSlot(this,CARD_TYPE_WORKER,""));for(var i=0;i<this.allSlots.length;i++)this.allSlots[i].previouslyEnabled=!1,this.allSlots[i].hide();this.rays1=this.phaser.add.image(0,0,"gui","rays1"),this.rays2=this.phaser.add.image(0,0,"gui","rays2"),this.rays1.x=this.buttonFinish.button.x,this.rays1.y=this.buttonFinish.button.y,this.rays2.x=this.buttonFinish.button.x,this.rays2.y=this.buttonFinish.button.y,this.rays3=this.phaser.add.image(0,0,"gui","rays1"),this.rays4=this.phaser.add.image(0,0,"gui","rays2"),this.rays3.scale=.75,this.rays4.scale=.75,this.phaser.tweens.add({targets:[this.rays1,this.rays3],rotation:2*Math.PI,duration:5e3,repeat:-1}),this.phaser.tweens.add({targets:[this.rays2,this.rays4],rotation:-2*Math.PI,duration:5e3,repeat:-1}),this.rays3.x=this.buttonOpen.button.x+10,this.rays3.y=this.buttonOpen.button.y,this.rays4.x=this.buttonOpen.button.x+10,this.rays4.y=this.buttonOpen.button.y,this.title=this.phaser.add.bitmapText(2*CONSTRUCTION_CARDS_MARGIN,this.buttonClose.button.y+this.buttonClose.button.height/2+CONSTRUCTION_CARDS_MARGIN,"text_black","NAME"),this.description=this.phaser.add.bitmapText(2*CONSTRUCTION_CARDS_MARGIN,this.buttonClose.button.y+this.buttonClose.button.height/2+4*CONSTRUCTION_CARDS_MARGIN,"text_brown","desc..."),this.description2=this.phaser.add.bitmapText(2*CONSTRUCTION_CARDS_MARGIN,this.buttonClose.button.y+this.buttonClose.button.height/2+4*CONSTRUCTION_CARDS_MARGIN,"text_black","desc..."),this.priceCaption=this.phaser.add.bitmapText(this.buttonFinish.button.x+this.buttonFinish.button.width/2+10,this.buttonFinish.button.y-26,"text_brown","aaa "),this.priceCaption.setMaxWidth(50),this.timeLimitCaption=this.phaser.add.bitmapText(this.requestBar.x+3,this.buttonFinish.button.y-26,"text_gray","aaa "),this.timeLimitSmall=this.phaser.add.bitmapText(this.buttonOpen.button.x+23,this.buttonOpen.button.y+10,"text_white","0"),this.timeLimitCaption.setMaxWidth(50),this.price1=this.phaser.add.bitmapText(this.buttonFinish.button.x+this.buttonFinish.button.width/2+23,this.buttonFinish.button.y+1,"text_brown","@ "+this.costMoney),this.price2=this.phaser.add.bitmapText(this.buttonFinish.button.x+this.buttonFinish.button.width/2+23,this.buttonFinish.button.y+19,"text_brown","# "+this.costInfl),this.title.setMaxWidth(CONSTRUCTION_CARDS_MARGIN_LEFT-4*CONSTRUCTION_CARDS_MARGIN),this.description.setMaxWidth(CONSTRUCTION_CARDS_MARGIN_LEFT-4*CONSTRUCTION_CARDS_MARGIN),this.container=this.phaser.add.container(0,0,[this.rays3,this.rays4]),this.container.add(this.buttonOpen.getContent()),this.container.add(this.timeLimitSmall),this.container.add([this.constructionBackground,this.title,this.description,this.description2,this.priceCaption,this.price1,this.price2]),this.container.add(this.requestBar),this.container.add(this.timeLimitCaption),this.container.add(this.buttonClose.getContent()),this.container.add(this.buttonDelete.getContent()),this.container.add([this.rays1,this.rays2]),this.container.add(this.buttonFinish.getContent()),this.container.depth=LAYER_CONSTRUCTION,this.container.x=(GAME_WIDTH-this.constructionBackground.width)/2,this.container.y=50,this.container.x=-this.constructionBackground.width,this.container.each(disableChildren),this.buttonOpen.hover.input.enabled=!0,0==this.id&&(this.timeLimitSmall.visible=!1),this.container.setDepth(LAYER_CONSTRUCTION),this.update()}}