class TownPipe{constructor(game,id){_defineProperty(this,"sellBasic",()=>{var xmlData=this.phaser.cache.xml.get("cards").getElementsByTagName("card"),xmlData=getFirstElementByAttributeValue(xmlData,"id",this.builtId),costMoney=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("money")),costInfluence=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("infl"));this.game.pay(-Math.floor(costMoney/2),-Math.floor(costInfluence/2),this,!0,!1),this.builtId="",this.game.town.refreshPipes(),this.setEnabled(!1),this.game.town.setStreetsEnabled(!0,!0),this.game.town.updateSupply();for(var i=0;i<this.blocks.length;i++)this.game.town.blocks[this.blocks[i]].showSupplyDemand(ZOOM_TWEEN_1);setTimeout(this.game.town.hideSupplyDemandSoft,1e3),setTimeout(this.game.deck.updateDiscarded,550)}),_defineProperty(this,"sellToHand",()=>{this.game.hand.addCard2(this.builtId,this.x,this.y),this.game.hand.positionCards(),this.sellBasic()}),_defineProperty(this,"sellToDiscard",()=>{this.game.hand.flyFakeCard(this.x,this.y,.1,this.game.deck.discarded_bmp.x-CARD_WIDTH/2,this.game.deck.discarded_bmp.y-CARD_BIG_HEIGHT/2,1,500,500,0,50,"Sine.InOut",1,100),this.game.deck.discarded.push(this.builtId),this.sellBasic()}),_defineProperty(this,"nothing",()=>{this.setEnabled(!0),this.game.updateLocks()}),_defineProperty(this,"hasPipeWater",()=>{for(var i=0;i<this.nodes.length;i++)if(1==this.game.town.nodes[this.nodes[i]].hasPipeWater)return!0;return!1}),_defineProperty(this,"setEnabled",(value,del)=>{if(this.targeterBmp.input.enabled=value,value?""!=this.builtId?(this.pipeBmp.alpha=1,this.targeterBmp.alpha=.35,del?(this.targeterBmp.setTint(16724016),this.targeterBmp.blendMode=Phaser.BlendModes.MULTIPLY):(this.targeterBmp.setTint(65280),this.targeterBmp.blendMode=Phaser.BlendModes.ADD,0==this.hasPipeWater()&&(this.targeterBmp.input.enabled=!1,this.targeterBmp.alpha=0,this.pipeBmp.alpha=1))):(this.pipeBmp.alpha=.25,this.targeterBmp.alpha=.5,this.targeterBmp.setTint(7848180),this.targeterBmp.blendMode=Phaser.BlendModes.ADD,0==this.hasPipeWater()&&(this.targeterBmp.input.enabled=!1,this.targeterBmp.alpha=0,this.pipeBmp.alpha=0)):(this.targeterBmp.alpha=0,this.pipeBmp.alpha=0,""!=this.builtId&&(this.pipeBmp.alpha=this.game.showPipes,1==this.game.isTargetingNodes&&(this.pipeBmp.alpha+=.5))),""!=this.builtId)for(var i=0;i<this.nodes.length;i++){var showornot=this.game.showPipes;value&&(showornot=1),this.game.town.nodes[this.nodes[i]].nodeBmp.alpha=showornot,1==this.game.isTargetingNodes&&(this.game.town.nodes[this.nodes[i]].nodeBmp.alpha+=.5),16==this.nodes[i]&&(this.game.town.nodes[this.nodes[i]].nodeBmp.alpha=0)}});var phaser=game.phaser;this.game=game,this.phaser=game.phaser;var self=this;this.id=id,this.buildable=!0,this.builtId="",this.detail=-1,this.x=0,this.y=0,this.pipeBmp=phaser.add.image(0,0,"town_pipes_atlas","pipe("+id+").png"),this.targeterBmp,this.nodes=[],this.pipes=[],this.blocks=[],this.targeterBmp=phaser.add.image(0,0,"town_pipes_atlas","marker("+id+").png");var tex=phaser.textures.get("town_pipes_atlas");this.targeterBmp.displayOriginX=0,this.targeterBmp.displayOriginY=0,this.targeterBmp.x=tex.frames["marker("+id+").png"].customData.spriteSourceSize.x,this.targeterBmp.y=tex.frames["marker("+id+").png"].customData.spriteSourceSize.y,this.targeterBmp.setDepth(LAYER_SUPPLY_DEMAND-1),this.pipeBmp.displayOriginX=0,this.pipeBmp.displayOriginY=0,this.pipeBmp.x=tex.frames["pipe("+id+").png"].customData.spriteSourceSize.x,this.pipeBmp.y=tex.frames["pipe("+id+").png"].customData.spriteSourceSize.y,this.pipeBmp.setDepth(LAYER_SUPPLY_DEMAND-2),this.pipeBmp.setDepth(this.pipeBmp.y-20),this.x=this.pipeBmp.x+this.pipeBmp.width/2,this.y=this.pipeBmp.y+this.pipeBmp.height/2,this.pipeBmp.alpha=1,this.targeterBmp.blendMode=Phaser.BlendModes.ADD,this.targeterBmp.alpha=.15,this.targeterBmp.alpha=0,this.pipeBmp.alpha=0,this.targeterBmp.setInteractive({cursor:"pointer",pixelPerfect:"true"}),this.targeterBmp.on("pointerover",(function(){if((!self.game.isDraggingCard||""==self.builtId)&&(self.targeterBmp.alpha=1,self.game.isDraggingCard?(self.targeterBmp.blendMode=Phaser.BlendModes.ADD,self.targeterBmp.setTint(7848180),self.game.selectedSpot=self):(self.pipeBmp.blendMode=Phaser.BlendModes.ADD,self.targeterBmp.blendMode=Phaser.BlendModes.MULTIPLY),""!=self.builtId))if(self.game.isBulldozer){var xmlData=self.phaser.cache.xml.get("cards").getElementsByTagName("card"),xmlData=getFirstElementByAttributeValue(xmlData,"id",self.builtId),costMoney=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("money"));costMoney=Math.floor(costMoney/2),self.game.showTooltip2(getString(self.game.language,"tooltip","sell_what","string")+" "+getString(self.game.language,"card",self.builtId,"name")+" "+getString(self.game.language,"tooltip","sell_for","string")+costMoney)}else self.game.showTooltip2(getString(self.game.language,"card",self.builtId,"name"))})),this.targeterBmp.on("pointerout",(function(){self.game.selectedSpot=null,self.pipeBmp.blendMode=Phaser.BlendModes.NORMAL,self.targeterBmp.input.enabled&&(self.targeterBmp.alpha=.4),self.game.hideTooltip()})),this.targeterBmp.on("pointerdown",(function(pointer){1==self.game.isBulldozer&&1==pointer.leftButtonDown()&&(self.game.hand.cards.length>=5?self.game.popup.show(getString(self.game.language,"popup","sell_6th","header"),getString(self.game.language,"popup","sell_6th","string"),self.sellToDiscard,self.nothing):self.sellToHand())}))}}