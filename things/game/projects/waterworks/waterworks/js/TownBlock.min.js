class TownBlock{constructor(game,id){_defineProperty(this,"positionSupplyDemandTxt",position=>{this.supplyBaseX=this.targeterBmp.x+this.targeterBmp.width/2,this.supplyBaseY=this.targeterBmp.y+this.targeterBmp.height/2-(this.supplyTxt.height+0+this.demandTxt.height+0+this.happinessTxt.height)/2,this.demandBaseY=this.supplyBaseY+this.supplyTxt.height+0,this.demandHappinessY=this.demandBaseY+this.demandTxt.height+0,this.shadeBaseX=this.targeterBmp.x+this.targeterBmp.width/2,this.shadeBaseY=this.targeterBmp.y+this.targeterBmp.height/2-4,10==this.id&&(this.supplyBaseX-=7),11==this.id&&(this.supplyBaseX+=7),6==this.id&&(this.supplyBaseX-=16),0==this.id&&(this.supplyBaseX+=10),7==this.id&&(this.supplyBaseX+=15),this.demandBaseX=this.demandHappinessX=this.shadeBaseX=this.supplyBaseX,position&&(this.supplyTxt.alpha=1,this.demandTxt.alpha=1,this.happinessTxt.alpha=1,this.supplyTxt.x=this.supplyBaseX,this.supplyTxt.y=this.supplyBaseY,this.supplyTxt.setOrigin(.5,0),this.demandTxt.x=this.demandBaseX,this.demandTxt.y=this.demandBaseY,this.demandTxt.setOrigin(.5,0),this.demandTxt.setCenterAlign(),this.happinessTxt.x=this.demandHappinessX,this.happinessTxt.y=this.demandHappinessY,this.happinessTxt.setOrigin(.5,0),this.happinessTxt.setCenterAlign()),this.shade&&(this.supplyTxt.width>this.demandTxt.width?this.shade.displayWidth=this.supplyTxt.width+6:this.shade.displayWidth=this.demandTxt.width+6,this.shade.displayHeight=this.supplyTxt.height+this.demandTxt.height+this.happinessTxt.height-8,this.shade.setOrigin(.5),this.shade.x=this.shadeBaseX,this.shade.y=this.shadeBaseY)}),_defineProperty(this,"showUpdatedSupply",(supply,time)=>{0==time?this.updateSupply(supply):(0==this.game.menu.container.visible&&0==this.game.options.container.visible&&setTimeout((function(t){t.soundDrip[Math.floor(Math.random()*t.soundDrip.length)].play()}),50*Math.random(),this),this.phaser.tweens.add({targets:[this.supplyTxt],scale:1.25,x:this.supplyBaseX+4,y:this.supplyBaseY+4,ease:"Back.Out",duration:time,onComplete:function(){this.updateSupply(supply),this.phaser.tweens.add({targets:[this.supplyTxt],scale:1,x:this.supplyBaseX,y:this.supplyBaseY,ease:"Back.Out",duration:time,onComplete:function(){},onCompleteScope:this})},onCompleteScope:this}))}),_defineProperty(this,"showUpdatedSupply2",(supply,time)=>{0==time?this.updateSupply(supply):this.phaser.tweens.add({targets:[this.demandTxt],scale:1.25,x:this.demandBaseX+4,y:this.demandBaseX+4,ease:"Back.Out",duration:time,onComplete:function(){this.updateSupply(supply),this.phaser.tweens.add({targets:[this.demandTxt],scale:1,x:this.demandBaseX,y:this.demandBaseY,ease:"Back.Out",duration:time,onComplete:function(){},onCompleteScope:this})},onCompleteScope:this})}),_defineProperty(this,"updateSupply",supply=>{this.simulatedSupply=this.supply+supply,supply>0?(this.supplyTxt.setFont("numbers_font_green",21),this.supplyTxt.text="$"+this.supply+"+"+supply):supply<0?(this.supplyTxt.setFont("numbers_font_red",21),this.supplyTxt.text="$"+this.supply+supply):(this.supplyTxt.setFont("numbers_font",21),this.supplyTxt.text="$"+this.supply),this.demandTxt.setFont("numbers_font",21),this.demandTxt.text="`"+this.demand,this.supply+supply>=this.demand?(this.shade.setTexture("shadeGreen"),this.happinessTxt.text=")"):this.supply+supply>=this.demand-1?(this.shade.setTexture("shadeYellow"),this.happinessTxt.text="|"):this.supply+supply<this.demand&&(this.shade.setTexture("shadeRed"),this.happinessTxt.text="("),this.positionSupplyDemandTxt(!1),this.game.updateInflGain()}),_defineProperty(this,"updateSupplyDetailed",(who,what)=>{this.supplyTxt.setFont("text_white2",12),this.supplyTxt.text="$  "+this.supply+"\n",this.supplyTxt.setCenterAlign(),"water_carrier"==who&&(who="รยง"),this.supplyTxt.text+="("+who+what+")",this.demandTxt.setFont("text_white2",12),this.demandTxt.text="` "+this.demand,this.supply>=this.demand+1?(this.shade.setTexture("shadeGreen"),this.happinessTxt.text=")"):this.supply>=this.demand-1?(this.shade.setTexture("shadeYellow"),this.happinessTxt.text="|"):this.supply<this.demand&&(this.shade.setTexture("shadeRed"),this.happinessTxt.text="("),this.positionSupplyDemandTxt(this.game.alwaysShowSupplyDemand)}),_defineProperty(this,"showSupplyDemand",time=>{this.showUpdatedSupply(0,time),this.showSupplyDemand3()}),_defineProperty(this,"showSupplyDemand2",time=>{this.showUpdatedSupply2(0,time),this.showSupplyDemand3()}),_defineProperty(this,"showSupplyDemandCurrentThing",(who,what)=>{this.updateSupplyDetailed(who,what),this.showSupplyDemand3()}),_defineProperty(this,"showSupplyDemand3",()=>{this.fire>0||(this.phaser.tweens.add({targets:[this.shade],alpha:.75,y:this.shadeBaseY,ease:"Cubic.Out",duration:250,onComplete:function(){},onCompleteScope:this}),this.phaser.tweens.add({targets:[this.supplyTxt],alpha:1,y:this.supplyBaseY,ease:"Cubic.Out",duration:250,onComplete:function(){},onCompleteScope:this}),this.phaser.tweens.add({targets:[this.demandTxt],alpha:1,y:this.demandBaseY,ease:"Cubic.Out",duration:250,onComplete:function(){},onCompleteScope:this}),this.phaser.tweens.add({targets:[this.happinessTxt],alpha:1,y:this.demandHappinessY,ease:"Cubic.Out",duration:250,onComplete:function(){},onCompleteScope:this}))}),_defineProperty(this,"hideSupplyDemand",()=>{1==this.game.alwaysShowSupplyDemand&&0==this.fire||(this.phaser.tweens.add({targets:[this.shade],alpha:0,y:this.shadeBaseY+10,ease:"Cubic.Out",duration:250,onComplete:function(){},onCompleteScope:this}),this.phaser.tweens.add({targets:[this.supplyTxt],alpha:0,y:this.supplyBaseY+10,ease:"Cubic.Out",duration:250,onComplete:function(){},onCompleteScope:this}),this.phaser.tweens.add({targets:[this.demandTxt],alpha:0,y:this.demandBaseY+10,ease:"Cubic.Out",duration:250,onComplete:function(){},onCompleteScope:this}),this.phaser.tweens.add({targets:[this.happinessTxt],alpha:0,y:this.demandHappinessY+10,ease:"Cubic.Out",duration:250,onComplete:function(){},onCompleteScope:this}))}),_defineProperty(this,"updateSkin",()=>{var buildingvariant="Age_",roadvariant="Age_",depth=0;this.demand>=22?(buildingvariant+="3_C",roadvariant="Age_3",this.age=3):this.demand>=19?(buildingvariant+="3_A",roadvariant="Age_3",this.age=3):this.demand>=16?(buildingvariant+="3_A",roadvariant="Age_3",this.age=3):this.demand>=12?(buildingvariant+="2_C",roadvariant="Age_2",this.age=2):this.demand>=9?(buildingvariant+="2_B",roadvariant="Age_2",this.age=2):this.demand>=6?(buildingvariant+="2_A",roadvariant="Age_2",this.age=2):this.demand>=5?(buildingvariant+="1_C",roadvariant="Age_1",this.age=1):this.demand>=2?(buildingvariant+="1_B",roadvariant="Age_1",this.age=1):(buildingvariant+="1_A",roadvariant="Age_1",this.age=1),this.buildingBmp.destroy(),this.roadBmp.destroy(),this.shadowBmp.destroy();var tex=this.phaser.textures.get("town_buildings_atlas");this.buildingBmp=this.phaser.add.image(0,0,"town_buildings_atlas",buildingvariant+"("+this.id+").png"),this.buildingBmp.x=tex.frames[buildingvariant+"("+this.id+").png"].customData.spriteSourceSize.x,this.buildingBmp.y=tex.frames[buildingvariant+"("+this.id+").png"].customData.spriteSourceSize.y,this.buildingBmp.displayOriginX=0,this.buildingBmp.displayOriginY=0,this.buildingBmp.originY=.5,this.buildingBmp.depth=this.buildingBmp.y+.6*this.targeterBmp.height;var tex=this.phaser.textures.get("town_shadows_atlas");this.shadowBmp=this.phaser.add.image(0,0,"town_shadows_atlas",buildingvariant+"("+this.id+").png"),this.shadowBmp.x=tex.frames[buildingvariant+"("+this.id+").png"].customData.spriteSourceSize.x,this.shadowBmp.y=tex.frames[buildingvariant+"("+this.id+").png"].customData.spriteSourceSize.y,this.shadowBmp.displayOriginX=0,this.shadowBmp.displayOriginY=0,this.shadowBmp.originY=.5;var tex=this.phaser.textures.get("town_roads_atlas");this.roadBmp=this.phaser.add.image(0,0,"town_roads_atlas",roadvariant+"("+this.id+").png"),this.roadBmp.x=tex.frames[roadvariant+"("+this.id+").png"].customData.spriteSourceSize.x,this.roadBmp.y=tex.frames[roadvariant+"("+this.id+").png"].customData.spriteSourceSize.y,this.roadBmp.displayOriginX=0,this.roadBmp.displayOriginY=0,this.shadowBmp.depth=3+this.age-1,this.roadBmp.depth=0+this.age-1}),_defineProperty(this,"init",()=>{}),_defineProperty(this,"setEnabled",value=>{this.routeBmp.input.enabled=value,value?(this.targeterBmp.alpha=.15,this.routeBmp.alpha=.01):(this.targeterBmp.alpha=0,this.routeBmp.alpha=0),this.game.isTargetingStreets||this.game.isTargetingNodes||this.game.showPipes>.5?(this.buildingBmp.alpha=.25,this.shadowBmp.alpha=.25):(this.buildingBmp.alpha=1,this.shadowBmp.alpha=1)}),_defineProperty(this,"spreadFire",()=>{if(!(Math.random()>.5)){var random=Math.floor(Math.random()*this.blocks.length);this.game.town.blocks[this.blocks[random]].startFire(1),this.game.town.blocks[this.blocks[random]].fireStarted=!0}}),_defineProperty(this,"startFire",power=>{this.fire=this.fire+power,this.fire>4&&(this.fire=4),this.fire<0&&(this.fire=0),this.fire<4&&1==this.fire4.visible&&this.fires.push(this.fire4.anims.currentAnim.key.charAt(4)),this.fire<3&&1==this.fire3.visible&&this.fires.push(this.fire3.anims.currentAnim.key.charAt(4)),this.fire<2&&1==this.fire2.visible&&this.fires.push(this.fire2.anims.currentAnim.key.charAt(4)),this.fire<1&&1==this.fire1.visible&&this.fires.push(this.fire1.anims.currentAnim.key.charAt(4)),this.fire>=4&&0==this.fire4.visible&&this.randoFire(this.fire4),this.fire>=3&&0==this.fire3.visible&&this.randoFire(this.fire3),this.fire>=2&&0==this.fire2.visible&&this.randoFire(this.fire2),this.fire>=1&&0==this.fire1.visible&&this.randoFire(this.fire1),this.fire>=4?this.fire4.visible=!0:this.fire4.visible=!1,this.fire>=3?this.fire3.visible=!0:this.fire3.visible=!1,this.fire>=2?this.fire2.visible=!0:this.fire2.visible=!1,this.fire>=1?this.fire1.visible=!0:this.fire1.visible=!1,this.fire>=1&&this.hideSupplyDemand()}),_defineProperty(this,"randoFire",fire=>{var blob=this.fires.splice(Math.floor(this.fires.length*Math.random()),1);fire.play("fire"+blob),fire.setOrigin(.5,1),fire.x=this.targeterBmp.x+this.targeterBmp.width/4+this.targeterBmp.width*Math.random()/2,fire.y=this.targeterBmp.y+this.targeterBmp.height/2+this.targeterBmp.height*Math.random()/2,fire.setDepth(LAYER_FIRE),fire.blendMode="ADD",fire.alpha=.9,fire.visible=!0});var phaser=game.phaser;this.phaser=game.phaser,this.game=game;var self=this;this.id=id,this.builtId="",this.detail=-1,this.nodes=[],this.pipes=[],this.blocks=[],this.demand=1,this.supply=0,this.simulatedGain=0,this.simulatedSupply=0,this.demandTxt,this.supplyTxt,this.happinessTxt,this.floatieTxt,this.floatieShade,this.soundDrip=[this.phaser.sound.add("drip1"),this.phaser.sound.add("drip2"),this.phaser.sound.add("drip3"),this.phaser.sound.add("bigdrip1"),this.phaser.sound.add("bigdrip2"),this.phaser.sound.add("bigdrip3"),this.phaser.sound.add("bigdrip4"),this.phaser.sound.add("bigdrip5")],this.x=0,this.y=0,this.age=1,this.fire=0,this.fires=["1","2","3","4"];var buildingvariant="Age_1_A";this.routeBmp=phaser.add.image(0,0,"town_blocks_atlas","route("+id+").png"),this.roadBmp=phaser.add.image(0,0,"town_roads_atlas","Age_3("+id+").png"),this.shadowBmp=phaser.add.image(0,0,"town_shadows_atlas","Age_1_A("+id+").png"),this.buildingBmp=phaser.add.image(0,0,"town_buildings_atlas","Age_1_A("+id+").png"),this.targeterBmp=phaser.add.image(0,0,"town_blocks_atlas","block("+id+").png");var tex=phaser.textures.get("town_buildings_atlas");this.frameHeight=tex.frames["Age_1_A("+id+").png"].customData.frame.h,this.frameY=tex.frames["Age_1_A("+id+").png"].customData.frame.y,this.buildingBmp.x=tex.frames["Age_1_A("+id+").png"].customData.spriteSourceSize.x,this.buildingBmp.y=tex.frames["Age_1_A("+id+").png"].customData.spriteSourceSize.y,this.buildingBmp.displayOriginX=0,this.buildingBmp.displayOriginY=0,this.buildingBmp.originY=.5,this.buildingBmp.depth=this.buildingBmp.y+.6*this.frameHeight,this.shadowBmp.depth=1,this.roadBmp.depth=0;var tex=phaser.textures.get("town_shadows_atlas");this.shadowBmp.x=tex.frames["Age_1_A("+id+").png"].customData.spriteSourceSize.x,this.shadowBmp.y=tex.frames["Age_1_A("+id+").png"].customData.spriteSourceSize.y,this.shadowBmp.displayOriginX=0,this.shadowBmp.displayOriginY=0;var tex=phaser.textures.get("town_roads_atlas");this.roadBmp.x=tex.frames["Age_3("+id+").png"].customData.spriteSourceSize.x,this.roadBmp.y=tex.frames["Age_3("+id+").png"].customData.spriteSourceSize.y,this.roadBmp.displayOriginX=0,this.roadBmp.displayOriginY=0;var tex=phaser.textures.get("town_blocks_atlas");this.targeterBmp.displayOriginX=0,this.targeterBmp.displayOriginY=0,this.targeterBmp.x=tex.frames["block("+id+").png"].customData.spriteSourceSize.x,this.targeterBmp.y=tex.frames["block("+id+").png"].customData.spriteSourceSize.y,this.routeBmp.displayOriginX=0,this.routeBmp.displayOriginY=0,this.routeBmp.x=tex.frames["route("+id+").png"].customData.spriteSourceSize.x,this.routeBmp.y=tex.frames["route("+id+").png"].customData.spriteSourceSize.y,this.fire1=this.phaser.add.sprite(0,0,"fire"),this.fire1.visible=!1,this.fire2=this.phaser.add.sprite(0,0,"fire"),this.fire2.visible=!1,this.fire3=this.phaser.add.sprite(0,0,"fire"),this.fire3.visible=!1,this.fire4=this.phaser.add.sprite(0,0,"fire"),this.fire4.visible=!1,this.startFire(0),this.routeBmp.alpha=.01,this.targeterBmp.blendMode=Phaser.BlendModes.ADD,this.targeterBmp.alpha=.15,this.targeterBmp.depth=3,this.routeBmp.depth=3,this.supplyTxt=phaser.add.bitmapText(0,0,"numbers_font",""+this.supply),this.demandTxt=phaser.add.bitmapText(0,0,"numbers_font",""+this.demand),this.happinessTxt=phaser.add.bitmapText(0,0,"numbers_font","|"),this.floatieTxt=phaser.add.bitmapText(0,0,"text_white","$  +1"),this.floatieTxt.setDepth(LAYER_SUPPLY_DEMAND+1),this.positionSupplyDemandTxt(!0),this.floatieTxt.setOrigin(0),this.floatieTxt.x=this.targeterBmp.x+this.targeterBmp.width-20,this.floatieTxt.y=this.targeterBmp.y+this.targeterBmp.height-20,this.phaser.tweens.add({targets:[this.floatieTxt],y:this.targeterBmp.y+this.targeterBmp.height-30,ease:"Sine.InOut",duration:500,yoyo:!0,repeat:-1}),this.floatieTxt.visible=!1,this.shade=phaser.add.image(0,0,"shade"),this.shade.depth=LAYER_SUPPLY_DEMAND,this.shade.alpha=0,this.shade.displayHeight=this.demandTxt.height+this.supplyTxt.height-8,this.supplyTxt.depth=LAYER_SUPPLY_DEMAND+1,this.demandTxt.depth=LAYER_SUPPLY_DEMAND+1,this.happinessTxt.depth=LAYER_SUPPLY_DEMAND+1,this.hideSupplyDemand(),this.updateSupply(0),this.positionSupplyDemandTxt(!0),this.x=this.buildingBmp.x+this.buildingBmp.width/2,this.y=this.buildingBmp.y+this.buildingBmp.height/2,this.tweencounter=this.phaser.tweens.addCounter({from:0,to:128,duration:500,yoyo:!0,delay:0,repeat:-1,onUpdate:function(tween){var value=Math.floor(tween.getValue()),c1=Phaser.Display.Color.GetColor(255-value,255,255),c2=Phaser.Display.Color.GetColor(155-value,255,255);this.routeBmp.setTint(c1,c2,c2,c1)},onUpdateScope:this}),this.routeBmp.setInteractive({cursor:"pointer",pixelPerfect:"true"}),this.routeBmp.on("pointerover",(function(){if(self.game.selectedSpot=self,self.routeBmp.alpha=1,self.targeterBmp.alpha=.75,self.targeterBmp.setTint(37111),self.buildingBmp.setTint(37111),null!=game.selectedItem&&null!=game.selectedItem.gainWater1&&(self.fire>0?self.showUpdatedSupply(self.simulatedGain,0):self.showUpdatedSupply(self.simulatedGain+game.selectedItem.gainWater1,0)),0==self.fire)for(var i=0;i<self.blocks.length;i++){var rb=game.town.blocks[self.blocks[i]].routeBmp,tb=game.town.blocks[self.blocks[i]].targeterBmp,tb2=game.town.blocks[self.blocks[i]].buildingBmp;tb.alpha=.5,rb.alpha=.01,tb.setTint(37111),tb2.setTint(7848180),null!=game.selectedItem&&null!=game.selectedItem.gainWater2&&0==self.fire&&game.town.blocks[self.blocks[i]].showUpdatedSupply(game.town.blocks[self.blocks[i]].simulatedGain+game.selectedItem.gainWater2,0)}})),this.routeBmp.on("pointerout",(function(){self.game.selectedSpot=null,0==self.routeBmp.input.enabled?(self.routeBmp.alpha=0,self.targeterBmp.alpha=0):(self.routeBmp.alpha=.01,self.targeterBmp.alpha=.15),self.buildingBmp.clearTint(),self.targeterBmp.clearTint(),null!=game.selectedItem&&self.showUpdatedSupply(self.simulatedGain,0);for(var i=0;i<self.blocks.length;i++){var rb=game.town.blocks[self.blocks[i]].routeBmp,tb=game.town.blocks[self.blocks[i]].targeterBmp,tb2=game.town.blocks[self.blocks[i]].buildingBmp;null!=game.selectedItem&&game.town.blocks[self.blocks[i]].showUpdatedSupply(game.town.blocks[self.blocks[i]].simulatedGain,0),0==self.routeBmp.input.enabled?(tb.alpha=0,rb.alpha=0):(tb.alpha=.15,rb.alpha=.01),tb.clearTint(),tb2.clearTint(),rb.clearTint()}})),this.routeBmp.on("pointerup",(function(){})),this.routeBmp.on("pointerdown",(function(){})),this.updateSkin()}}