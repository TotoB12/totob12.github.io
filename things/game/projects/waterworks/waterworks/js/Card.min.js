class Card{constructor(hand,id){_defineProperty(this,"drag",(pointer,dragX,dragY)=>{if(1==pointer.rightButtonDown()||1==pointer.middleButtonDown()||1==pointer.backButtonDown()||1==pointer.forwardButtonDown())return this.game.selectedSpot=null,void this.endDrag(pointer);this.card.x=pointer.x,this.card.y=pointer.y+CARD_SMALL_HEIGHT+15+20,this.card.x<CARD_WIDTH/2-this.raisedShift-this.dragDeltaCenterX&&(this.card.x=CARD_WIDTH/2-this.raisedShift-this.dragDeltaCenterX),this.card.x>GAME_WIDTH-CARD_WIDTH/2-this.raisedShift-this.dragDeltaCenterX&&(this.card.x=GAME_WIDTH-CARD_WIDTH/2-this.raisedShift-this.dragDeltaCenterX),this.card.y<CARD_SMALL_HEIGHT/2-this.cardSmall_bmp.y-this.raisedShift-this.dragDeltaCenterY&&(this.card.y=CARD_SMALL_HEIGHT/2-this.cardSmall_bmp.y-this.raisedShift-this.dragDeltaCenterY),this.card.y>GAME_HEIGHT-2*this.raisedShift-this.expandedShift-this.dragDeltaCenterY&&(this.card.y=GAME_HEIGHT-2*this.raisedShift-this.expandedShift-this.dragDeltaCenterY),(this.selectedSpot instanceof CardSlot||Math.abs(this.card.x-this.sourceX)>CARD_DRAG_DIST_BEFORE_COLLAPSE||Math.abs(this.card.y-this.sourceY)>CARD_DRAG_DIST_BEFORE_COLLAPSE)&&1==this.cardBig_bmp.visible&&(this.shrink(),this.phaser.tweens.add({targets:this.card,alpha:.75,ease:"Cubic.Out",duration:100}))}),_defineProperty(this,"endDrag",pointer=>{var returnedToHand=!1;if(this.phaser.input.setDragState(pointer,0),this.soundDrop.play(),1==this.game.request.open&&null==this.game.selectedSpot&&1==this.game.request.autoOpened&&this.game.request.openCloseConstruction(),1==this.game.construction.open&&null==this.game.selectedSpot&&1==this.game.construction.autoOpened&&this.game.construction.openCloseConstruction(),0==this.cardBig_bmp.visible&&(this.selected=!1,this.hand.setSelectedCard()),this.game.town.hideWellPower(!1),null!=this.hand.game.selectedSpot&&this.hand.game.selectedSpot instanceof CardSlot==0){var ok=!1;this.hand.game.selectedSpot instanceof TownBlock&&this.playType==CARD_TYPE_WORKER&&(ok=!0),this.hand.game.selectedSpot instanceof Town&&this.playTarget==CARD_TARGET_GLOBAL&&(ok=!0),this.hand.game.selectedSpot instanceof TownPipe&&this.playTarget==CARD_TARGET_STREET&&(ok=!0),this.hand.game.selectedSpot instanceof TownNode&&this.playTarget==CARD_TARGET_NODE&&(ok=!0),null!=this.constructionStarter&&(""!=this.game.construction.constructionId&&(ok=!1,this.game.deny.play(),this.game.popup.show(getString(this.game.language,"popup","construction_already_open","header"),getString(this.game.language,"popup","construction_already_open","string"),null,null)),-1!=this.desc2_bmp.text.indexOf("{")&&(ok=!1,this.game.deny.play(),this.game.popup.show(getString(this.game.language,"popup","construction_build_block","header"),getString(this.game.language,"popup","construction_build_block","string"),null,null))),ok?0==this.game.pay(this.costMoney,this.costInfluence,pointer,!0,!1)&&(this.hand.game.selectedSpot=null):this.hand.game.selectedSpot=null}this.hand.game.town.hideSupplyDemand(),this.hand.game.selectedItem=null,this.hand.game.isDraggingCard=!1,this.hand.game.isTargetingBlocks=!1,this.hand.game.isTargetingGlobal=!1,this.hand.game.isTargetingStreets=!1,this.hand.game.isTargetingNodes=!1,this.hand.game.isDroppingCard=!0,this.hand.game.updateLocks(),this.cardDisabled_bmp.alpha=0;var rotation=0;this.selectedSpot&&this.selectedSpot instanceof CardSlot&&(this.sourceX=this.selectedSpot.slotButton.x+CARD_WIDTH/2+this.selectedSpot.parent.container.x,this.sourceY=this.selectedSpot.slotButton.y+CARD_BIG_HEIGHT/2+this.selectedSpot.parent.container.y);var dist=Math.sqrt(Math.pow(this.card.x-this.sourceX,2)+Math.pow(this.card.y-this.sourceY,2));if((dist=dist)>1e3&&(dist=1e3),dist<200&&(dist=200),this.easing="Back.Out",null!=this.hand.game.selectedSpot){if(this.hand.game.selectedSpot instanceof TownBlock){if(this.selectedSpot=this.hand.game.selectedSpot,this.sourceX=this.hand.game.selectedSpot.x,this.sourceY=this.hand.game.selectedSpot.y,this.destroyThis=!0,this.targetScale=0,this.easing="Cubic.In",rotation=5*Math.PI,dist=1e3,11==this.game.tutorial&&(this.game.tutorial=12),0==this.selectedSpot.fire){this.selectedSpot.showSupplyDemand(0);for(var i=0;i<this.selectedSpot.blocks.length;i++)this.hand.game.town.blocks[this.selectedSpot.blocks[i]].showSupplyDemand(0)}}else if(this.hand.game.selectedSpot instanceof TownPipe)this.selectedSpot=this.hand.game.selectedSpot,this.sourceX=this.hand.game.selectedSpot.x,this.sourceY=this.hand.game.selectedSpot.y,this.destroyThis=!0,this.targetScale=0,this.easing="Cubic.In",rotation=5*Math.PI,dist=1e3,0==this.game.showPipes&&(this.game.showPipes=.5),this.hand.game.selectedSpot.builtId=this.id,this.game.town.setStreetsEnabled(!1,!1);else if(this.hand.game.selectedSpot instanceof TownNode){if(this.selectedSpot=this.hand.game.selectedSpot,this.sourceX=this.hand.game.selectedSpot.x,this.sourceY=this.hand.game.selectedSpot.y,this.destroyThis=!0,this.targetScale=0,this.easing="Cubic.In",rotation=5*Math.PI,dist=1e3,0==this.game.showPipes&&(this.game.showPipes=.49),this.hand.game.selectedSpot.builtId=this.id,this.game.town.setStreetsEnabled(!1,!1),this.hand.game.selectedSpot.hasPipeWater||"well"==this.id)for(var i=0;i<this.selectedSpot.blocks.length;i++)this.hand.game.town.blocks[this.selectedSpot.blocks[i]].showSupplyDemand(0)}else if(this.hand.game.selectedSpot instanceof Town)this.selectedSpot=this.hand.game.selectedSpot,this.sourceX=GAME_WIDTH/2,this.sourceY=GAME_HEIGHT/2,this.destroyThis=!0,this.targetScale=0,this.easing="Cubic.In",rotation=5*Math.PI,dist=1e3;else if(this.hand.game.selectedSpot instanceof CardSlot)if(0==this.game.drawer1.open&&0==this.game.drawer2.open&&0==this.game.drawer3.open&&this.hand.game.selectedSpot.reclaimable&&(dist=500,this.easing="Cubic.In"),0==this.hand.game.selectedSpot.reclaimable&&""==this.hand.game.selectedSpot.wantId&&"true"==this.consume)this.hand.game.popup.show(getString(this.hand.game.language,"popup","consumable_card_blocked","header"),getString(this.hand.game.language,"popup","consumable_card_blocked","string"),null,null),this.hand.game.isDroppingCard=!1,this.hand.game.updateLocks();else if(""!=this.hand.game.selectedSpot.wantId&&this.hand.game.selectedSpot.wantId==this.id||""==this.hand.game.selectedSpot.wantId&&this.hand.game.selectedSpot.wantType==this.playType){var ok=!0;0==this.hand.game.selectedSpot.reclaimable&&0==this.game.pay(this.costMoney,this.costInfluence,pointer,!0,!1)&&(this.hand.game.isDroppingCard=!1,this.hand.game.updateLocks(),ok=!1),ok&&(this.game.flyingCard=this,this.onComplete=this.defaultOnCompleteSlot,this.selectedSpot=this.hand.game.selectedSpot,this.hand.removeCardFromHand(this),this.sourceX=this.selectedSpot.slotButton.x+CARD_WIDTH/2+this.selectedSpot.parent.container.x,this.sourceY=this.selectedSpot.slotButton.y+CARD_BIG_HEIGHT/2+this.selectedSpot.parent.container.y,0==this.hand.game.selectedSpot.reclaimable&&(this.sparkles2(),this.cost_infl_bmp.clearTint(),this.cardSmall_bmp.clearTint(),this.cardBig_bmp.clearTint()))}else this.hand.game.isDroppingCard=!1,this.hand.game.updateLocks()}else this.selectedSpot instanceof CardSlot&&(pointer.y>260&&this.hand.cards.length<5?(this.selectedSpot=null,this.hand.cards.push(this),this.sourceY=CARD_HAND_ENABLED_Y,this.hand.positionCards(),returnedToHand=!0):pointer.y>260?this.hand.game.deny.play():((dist*=1)>500&&(dist=500),dist<200&&(dist=200),this.easing="Circ.In"),this.game.isUpdatingHand=!0),this.game.isDroppingCard=!1,this.game.updateLocks();this.hand.game.selectedSpot=null,returnedToHand||this.positionCard(dist,rotation,!0),this.dragDeltaCenterX=0,this.dragDeltaCenterY=0,this.raisedShift=0,this.phaser.tweens.add({targets:[this.cardShadowBig_bmp,this.cardShadowSmall_bmp],alpha:0,ease:"Cubic.Out",duration:100,onComplete:function(){},onCompleteScope:this}),this.phaser.tweens.add({targets:this.card,alpha:1,ease:"Cubic.Out",duration:100}),this.raiseAndShift()}),_defineProperty(this,"updatePriceAvailability",()=>{var result=!0;return this.destroyThis||(this.game.money<this.costMoney&&this.costMoney>0&&(this.cost_money_bmp.setTint(16711680),this.cardSmall_bmp.setTint(10066329),this.cardBig_bmp.setTint(10066329),this.cardPicture_bmp.setTint(10066329),this.desc1_bmp.setTint(10066329),this.desc2_bmp.setTint(10066329),this.type_bmp.setTint(10066329),this.desc1_bmp.alpha=.5,this.desc2_bmp.alpha=.25,this.type_bmp.alpha=.5,result=!1),this.game.infl<this.costInfluence&&this.costInfluence>0&&(this.cost_infl_bmp.setTint(16711680),this.cardSmall_bmp.setTint(10066329),this.cardBig_bmp.setTint(10066329),this.cardPicture_bmp.setTint(10066329),this.desc1_bmp.setTint(10066329),this.desc2_bmp.setTint(10066329),this.type_bmp.setTint(10066329),this.desc1_bmp.alpha=.5,this.desc2_bmp.alpha=.25,result=!1),(this.game.money>=this.costMoney||0==this.costMoney)&&(this.game.infl>=this.costInfluence||0==this.costInfluence)&&(this.cost_money_bmp.clearTint(),this.cost_infl_bmp.clearTint(),this.cardSmall_bmp.clearTint(),this.cardBig_bmp.clearTint(),this.cardPicture_bmp.clearTint(),this.desc1_bmp.clearTint(),this.desc2_bmp.clearTint(),this.type_bmp.clearTint(),this.desc1_bmp.alpha=1,this.desc2_bmp.alpha=.75,this.type_bmp.alpha=1)),result}),_defineProperty(this,"positionCard",(duration,rotation,unlock)=>{this.destroyThis&&this.hand.removeCardFromHand(this),1==this.game.isDrawingCards&&(duration*=1.5),this.unlock=unlock,this.phaser.tweens.add({targets:this.card,x:this.sourceX,y:this.sourceY,scaleX:this.targetScale,scaleY:this.targetScale,rotation:rotation,ease:this.easing,duration:duration,delay:this.delay,repeat:0,yoyo:!1,onComplete:this.onComplete,onCompleteScope:this})}),_defineProperty(this,"defaultOnCompleteSlot",()=>{this.selectedSpot instanceof CardSlot&&(this.game.isDroppingCard=!1,this.game.updateLocks(),this.onComplete=this.defaultOnComplete,this.defaultOnComplete(),this.game.flyingCard=null,this.hand.positionCards())}),_defineProperty(this,"defaultOnComplete",()=>{if(this.delay=0,1==this.rightClickedCardFly&&(this.rightClickedCardFly=!1,this.game.rightClickedCardFly=null),this.selectedSpot instanceof CardSlot&&(this.selectedSpot.grabACard(this),0==this.selectedSpot.reclaimable&&this.destroy(!1)),1==this.game.isDrawingCards&&null==this.selectedSpot&&this.shrink(),this.destroyThis){if(this.execute(),this.sparkles(),this.hand.game.isDroppingCard=!1,this.hand.game.updateLocks(),this.hand.game.town.updateSupply(),this.playTarget==CARD_TARGET_BLOCK)if(this.selectedSpot.fire>0){this.selectedSpot.startFire(-1);for(var ok=!0,i=0;i<this.hand.game.town.blocks.length;i++)this.hand.game.town.blocks[i].fire>0&&(ok=!1);1==ok&&this.hand.game.fireloopsound.stop(),this.game.town.updateSupply(),this.game.updateInflGain()}else{this.selectedSpot.showSupplyDemand(ZOOM_TWEEN_1);for(var i=0;i<this.selectedSpot.blocks.length;i++){var time=150;setTimeout((function(t,i,selectedSpot){t.hand.game.town.blocks[selectedSpot.blocks[i]].showSupplyDemand(ZOOM_TWEEN_1)}),time*(i+1),this,i,this.selectedSpot)}}if(this.playTarget==CARD_TARGET_NODE&&(this.selectedSpot.hasPipeWater||"well"==this.id)){for(var i=0;i<this.selectedSpot.blocks.length;i++){var time=150;setTimeout((function(t,i,selectedSpot){t.hand.game.town.blocks[selectedSpot.blocks[i]].showSupplyDemand(ZOOM_TWEEN_1)}),time*(i+1),this,i,this.selectedSpot)}setTimeout(this.game.town.hideSupplyDemandSoft,1e3)}this.destroy(!1)}else this.unlock&&(this.game.isDrawingCards=!1,this.hand.game.isUpdatingHand=!1,this.hand.game.updateLocks())}),_defineProperty(this,"collapseAndShrink",()=>{this.selected=!1,this.phaser.tweens.killTweensOf([this.cardSelectionBig_bmp,,this.cardSelectionSmall_bmp]),this.phaser.tweens.add({targets:[this.cardSelectionBig_bmp,this.cardSelectionSmall_bmp],alpha:0,ease:"Cubic.Out",duration:100}),this.phaser.tweens.add({targets:[this.cardShadowBig_bmp,this.cardShadowSmall_bmp],alpha:0,ease:"Cubic.Out",duration:100,onComplete:function(){},onCompleteScope:this}),this.phaser.tweens.add({targets:this.card,alpha:1,ease:"Cubic.Out",duration:100}),this.dragDeltaCenterX=0,this.dragDeltaCenterY=0,this.raisedShift=0,this.shrink()}),_defineProperty(this,"shrink",()=>{this.cardBig_bmp.visible&&this.soundShrink.play({mute:!1,volume:1,rate:1,detune:400*Math.random()-200,seek:0,loop:!1,delay:0}),this.cardBig_bmp.visible=!1,this.cardSmall_bmp.visible=!0,this.desc1_bmp.visible=!1,this.desc2_bmp.visible=!1,this.name_bmp.visible=!0,this.type_bmp.visible=!0,this.cardShadowBig_bmp.visible=!1,this.cardShadowSmall_bmp.visible=!0,this.cardFrameBig_bmp.visible=!1,this.cardFrameSmall_bmp.visible=!0,this.cardSelectionBig_bmp.visible=!1,this.cardSelectionSmall_bmp.visible=!0,this.expandedShift=0,this.card.input.hitArea.height=CARD_SMALL_HEIGHT,this.card.input.hitArea.y=0,this.cost_money_bmp.y=10-Math.floor(CARD_SMALL_HEIGHT/2),this.cost_infl_bmp.y=10-Math.floor(CARD_SMALL_HEIGHT/2),this.raiseAndShift()}),_defineProperty(this,"expand",()=>{this.updateLanguage(),this.firstExpanse||this.soundExpand.play({mute:!1,volume:1,rate:1,detune:600*Math.random()-300,seek:0,loop:!1,delay:0}),this.firstExpanse=!1,this.cardBig_bmp.visible=!0,this.name_bmp.visible=!0,this.type_bmp.visible=!0,this.cardShadowBig_bmp.visible=!0,this.cardFrameBig_bmp.visible=!0,this.cardSelectionBig_bmp.visible=!0,this.cardShadowSmall_bmp.visible=!1,this.cardSmall_bmp.visible=!1,this.desc1_bmp.visible=!0,this.desc2_bmp.visible=!0,this.cardFrameSmall_bmp.visible=!1,this.cardSelectionSmall_bmp.visible=!1,this.cost_money_bmp.y=10-Math.floor(CARD_SMALL_HEIGHT/2),this.cost_infl_bmp.y=10-Math.floor(CARD_SMALL_HEIGHT/2),null!=this.selectedSpot&&this.selectedSpot instanceof CardSlot?(this.expandedShift=0,this.phaser.tweens.add({targets:this.cardShadowBig_bmp,alpha:1,ease:"Cubic.Out",duration:200}),this.phaser.tweens.add({targets:this.cardInner,y:{from:-CARD_SMALL_HEIGHT/2,to:0},scaleY:{from:.5,to:1},ease:"Cubic.Out",duration:200})):(this.expandedShift=-CARD_BIG_HEIGHT/2,this.card.input.hitArea.height=CARD_BIG_HEIGHT,this.card.input.hitArea.y=this.expandedShift,this.raiseAndShift())}),_defineProperty(this,"raiseAndShift",()=>{var targetY=this.expandedShift+this.raisedShift+this.dragDeltaCenterY;this.phaser.tweens.add({targets:this.cardInner,x:this.raisedShift+this.dragDeltaCenterX,y:targetY,ease:"Back.Out",duration:200})}),_defineProperty(this,"destroy",removeFromHand=>{try{this.phaser.tweens.killTweensOf([this.card,this.name_bmp,this.desc1_bmp,this.desc2_bmp,this.cardBig_bmp,this.cardSmall_bmp,this.cardShadowBig_bmp,this.cardShadowSmall_bmp,this.cardFrameBig_bmp,this.cardFrameSmall_bmp,this.cardSelectionBig_bmp,this.cardSelectionSmall_bmp]),this.selectedSpot=null,this.card.destroy(),this.name_bmp.destroy(),this.type_bmp.destroy(),this.desc1_bmp.destroy(),this.desc2_bmp.destroy(),this.cardBig_bmp.destroy(),this.cardSmall_bmp.destroy(),this.cardShadowBig_bmp.destroy(),this.cardShadowSmall_bmp.destroy(),this.cardFrameBig_bmp.destroy(),this.cardFrameSmall_bmp.destroy(),this.cardSelectionBig_bmp.destroy(),this.cardSelectionSmall_bmp.destroy(),this.soundShrink&&(this.soundShrink.destroy(),this.soundExpand.destroy(),this.soundGrab.destroy(),this.soundDrop.destroy(),this.soundDraw.destroy(),this.soundShrink=null,this.soundExpand=null,this.soundGrab=null,this.soundDrop=null,this.soundDraw=null)}catch(e){console.log(e)}1==removeFromHand&&this.hand.removeCardFromHand(this)}),_defineProperty(this,"setEnabled",value=>{1==value&&this.hand.game.selectedItem==this||(this.card.input.enabled=value,this.cardDisabled_bmp.alpha=!value,this.game.isDrawingCards&&(this.cardDisabled_bmp.alpha=0),this.game.selectedItem==this&&(this.cardDisabled_bmp.alpha=0))}),_defineProperty(this,"execute",()=>{if(this.playType==CARD_TYPE_WORKER&&(this.selectedSpot.fire>0?(this.game.hand.flyFakeCard(this.selectedSpot.x,this.selectedSpot.y,.1,this.game.deck.discarded_bmp.x-CARD_WIDTH/2,this.game.deck.discarded_bmp.y-CARD_BIG_HEIGHT/2,1,250,250,0,100,"Sine.InOut",1,100),this.game.deck.discarded.push(this.id)):this.hand.game.town.addWorker(this.id,this.selectedSpot,!0)),this.playType==CARD_TYPE_COMPONENT&&(this.playTarget==CARD_TARGET_STREET&&(this.selectedSpot.builtId=this.id,this.game.showPipes>0&&this.game.showPipes<=.5&&this.phaser.tweens.add({targets:this.game,showPipes:0,ease:"Cubic.InOut",duration:500,onUpdate:this.game.town.refreshPipesView,onUpdateScope:this})),this.playTarget==CARD_TARGET_NODE&&(this.selectedSpot.builtId=this.id,"well"==this.id&&(this.game.wellBuilt=!0),this.selectedSpot.gainWater1=this.gainWater1,this.game.showPipes>0&&this.game.showPipes<=.5&&this.phaser.tweens.add({targets:this.game,showPipes:0,ease:"Cubic.InOut",duration:500,onUpdate:this.game.town.refreshPipesView,onUpdateScope:this}))),(this.playType==CARD_TYPE_DOCUMENT||this.playType==CARD_TYPE_COMPONENT&&this.playTarget==CARD_TARGET_GLOBAL)&&(null!=this.constructionStarter?(this.sourceX=GAME_WIDTH/2,this.sourceY=GAME_HEIGHT/2,this.sparkles2(),this.game.construction.startConstruction(this.constructionStarter)):"false"==this.consume&&(this.game.hand.flyFakeCard(GAME_WIDTH/2,GAME_HEIGHT/2,.1,this.game.deck.discarded_bmp.x-CARD_WIDTH/2,this.game.deck.discarded_bmp.y-CARD_BIG_HEIGHT/2,1,250,250,0,100,"Sine.InOut",0,100),this.game.deck.discarded.push(this.id)),null!=this.moneyGain&&(this.game.gainSound.play(),this.game.moneyGain+=Number(this.moneyGain),this.sourceX=15,this.sourceY=55,this.sparkles2()),0!=this.gainMoney||0!=this.gainInfluence)){var pointer=new Object;pointer.x=GAME_WIDTH/2,pointer.y=GAME_HEIGHT/2,this.game.pay(-this.gainMoney,-this.gainInfluence,pointer,!0,!0)}}),_defineProperty(this,"sparkles",()=>{this.phaser.children.bringToTop(this.hand.game.particles),this.hand.game.particles.explode(300,this.selectedSpot.x,this.selectedSpot.y)}),_defineProperty(this,"sparkles2",()=>{this.phaser.children.bringToTop(this.hand.game.particles);for(var i=0;i<10;i++)this.hand.game.particles.explode(300,this.sourceX-CARD_WIDTH/2+Math.random()*CARD_WIDTH,this.sourceY-Math.random()*CARD_SMALL_HEIGHT)}),_defineProperty(this,"updateLanguage",()=>{if(this.name_bmp.text=getString(this.game.language,"card",this.id,"name"),this.desc1_bmp.text=getString(this.game.language,"card",this.id,"desc"),this.desc2_bmp.text=getString(this.game.language,"card",this.id,"desc2"),null!=this.constructionStarter){this.desc2_bmp.text=getString(this.game.language,"gui","construction_card_reqs","desc2")+" ";for(var xmlData=this.phaser.cache.xml.get("constructions").getElementsByTagName("construction"),cards=(xmlData=getFirstElementByAttributeValue(xmlData,"id",this.id)).getElementsByTagName("card"),items=[],amounts=[],i=0;i<cards.length;i++){for(var this_item=cards[i].getAttribute("id"),found=!1,j=0;j<items.length;j++)items[j]+""!=getString(this.game.language,"card",this_item,"name")+""&&items[j]+""!="{"+getString(this.game.language,"card",this_item,"name")||(amounts[j]++,found=!0);if(0==found){var possesed=!1;if(null!=this.game.rightClickedCardFly&&this.game.rightClickedCardFly.id==this_item&&(possesed=!0),null!=this.game.flyingCard&&this.game.flyingCard.id==this_item&&(possesed=!0),0==possesed)for(var j=0;j<this.game.hand.cards.length;j++)this.game.hand.cards[j].id==this_item&&(possesed=!0);if(0==possesed)for(var j=0;j<this.game.deck.stack.length;j++)this.game.deck.stack[j]==this_item&&(possesed=!0);if(0==possesed)for(var j=0;j<this.game.deck.discarded.length;j++)this.game.deck.discarded[j]==this_item&&(possesed=!0);if(0==possesed)for(var j=0;j<this.game.drawer1.slots.length;j++)null!=this.game.drawer1.slots[j]&&null!=this.game.drawer1.slots[j].card&&this.game.drawer1.slots[j].card.id==this_item&&(possesed=!0);if(0==possesed)for(var j=0;j<this.game.drawer2.slots.length;j++)null!=this.game.drawer2.slots[j]&&null!=this.game.drawer2.slots[j].card&&this.game.drawer2.slots[j].card.id==this_item&&(possesed=!0);if(0==possesed)for(var j=0;j<this.game.drawer3.slots.length;j++)null!=this.game.drawer3.slots[j]&&null!=this.game.drawer3.slots[j].card&&this.game.drawer3.slots[j].card.id==this_item&&(possesed=!0);if(0==possesed&&""!=this.game.construction.constructionId)for(var j=0;j<this.game.construction.slots.length;j++)null!=this.game.construction.slots[j]&&null!=this.game.construction.slots[j].fakeCard&&this.game.construction.slots[j].fakeCard.id==this_item&&(possesed=!0);if(0==possesed&&""!=this.game.request.constructionId)for(var j=0;j<this.game.request.slots.length;j++)null!=this.game.request.slots[j]&&null!=this.game.request.slots[j].fakeCard&&this.game.request.slots[j].fakeCard.id==this_item&&(possesed=!0);var string="";0==possesed&&(string+="{",this.name_bmp.text="{"+getString(this.game.language,"card",this.id,"name")),string+=getString(this.game.language,"card",this_item,"name"),items.push(string),amounts.push(1)}}for(var i=0;i<items.length;i++)amounts[i]>1?this.desc2_bmp.text+=items[i].replace(/ /g,"}").replace(/budowlane/g,"budowl.")+"}x"+amounts[i]:this.desc2_bmp.text+=items[i].replace(/ /g,"}"),i+1<items.length&&(this.desc2_bmp.text+=", ")}this.desc2_bmp.setCenterAlign(),this.desc2_bmp.y=Math.floor(CARD_BIG_HEIGHT/2)-this.desc2_bmp.height-8,this.desc2_bmp.x=-Math.floor(this.desc2_bmp.width/2)});var phaser=hand.phaser,self=this;this.hand=hand,this.game=this.hand.game,this.phaser=phaser,this.soundShrink=this.phaser.sound.add("deal6"),this.soundExpand=this.phaser.sound.add("deal4"),this.soundGrab=this.phaser.sound.add("deal1"),this.soundDrop=this.phaser.sound.add("deal5"),this.soundDraw=this.phaser.sound.add("deal3"),this.firstExpanse=!0,this.rightClickedCardFly=!1,this.id=id,this.xmlData=this.phaser.cache.xml.get("cards").getElementsByTagName("card"),this.xmlData=getFirstElementByAttributeValue(this.xmlData,"id",this.id),this.costMoney=Number(this.xmlData.getElementsByTagName("cost")[0].getAttribute("money")),this.costInfluence=Number(this.xmlData.getElementsByTagName("cost")[0].getAttribute("infl")),this.costMoney=Math.round(this.costMoney*this.game.difficultyPriceMod),this.costInfluence=Math.round(this.costInfluence*this.game.difficultyPriceMod),this.gainMoney=Number(this.xmlData.getElementsByTagName("gain")[0].getAttribute("money")),this.gainInfluence=Number(this.xmlData.getElementsByTagName("gain")[0].getAttribute("infl")),this.constructionStarter=this.xmlData.getElementsByTagName("gain")[0].getAttribute("construction"),this.moneyGain=this.xmlData.getElementsByTagName("gain")[0].getAttribute("money_gain"),this.playTarget=this.xmlData.getElementsByTagName("play")[0].getAttribute("target"),this.playType=this.xmlData.getElementsByTagName("play")[0].getAttribute("type"),this.consume=this.xmlData.getElementsByTagName("play")[0].getAttribute("consume"),this.picture=this.xmlData.getAttribute("picture"),null==this.picture&&(this.picture=this.id),this.gainWater1=Number(this.xmlData.getElementsByTagName("gain")[0].getAttribute("water_1")),this.gainWater2=Number(this.xmlData.getElementsByTagName("gain")[0].getAttribute("water_2")),this.sourceX=0,this.sourceY=CARD_HAND_ENABLED_Y,this.raiseOnHover=!0,this.clicked=!1,this.selected=!1,this.phaser=phaser,this.raisedShift=0,this.expandedShift=0,this.dragDeltaCenterX=0,this.dragDeltaCenterY=0,this.selectedSpot=null,this.destroyThis=!1,this.targetScale=1,this.easing="Back.Out",this.onComplete=this.defaultOnComplete,this.unlock=!1,this.delay=0,this.name_bmp=phaser.add.bitmapText(-CARD_WIDTH/2+6,-CARD_BIG_HEIGHT/2+1,"text_gray",this.id),this.desc1_bmp=phaser.add.bitmapText(-CARD_WIDTH/2+6,-CARD_BIG_HEIGHT/2-4+CARD_SMALL_HEIGHT,"text_gray","descriptionShort"),this.desc2_bmp=phaser.add.bitmapText(-CARD_WIDTH/2+6,-CARD_BIG_HEIGHT/2+CARD_SMALL_HEIGHT+4,"text_gray","descriptionLong"),this.cost_money_bmp=phaser.add.bitmapText(-CARD_WIDTH/2+18,0,"text_gray",this.costMoney),this.type_bmp=phaser.add.bitmapText(CARD_WIDTH/2-17,-22,"text_gray","..."),this.cost_infl_bmp=phaser.add.bitmapText(8,0,"text_gray",this.costInfluence),this.cardBig_bmp=phaser.add.image(0,0,"card_atlas","card_big"),this.cardSmall_bmp=phaser.add.image(0,-CARD_BIG_HEIGHT/2+CARD_SMALL_HEIGHT/2,"card_atlas","card_small"),this.cardShadowBig_bmp=phaser.add.image(5,5,"card_atlas","card_shadow_big"),this.cardShadowSmall_bmp=phaser.add.image(5,4-CARD_BIG_HEIGHT/2+CARD_SMALL_HEIGHT/2,"card_atlas","card_shadow_small"),this.cardFrameBig_bmp=phaser.add.image(0,0,"card_atlas","card_frame_big"),this.cardFrameSmall_bmp=phaser.add.image(0,-CARD_BIG_HEIGHT/2+CARD_SMALL_HEIGHT/2,"card_atlas","card_frame_small"),this.cardSelectionBig_bmp=phaser.add.image(0,0,"card_atlas","card_selection_big"),this.cardSelectionSmall_bmp=phaser.add.image(0,-CARD_BIG_HEIGHT/2+CARD_SMALL_HEIGHT/2,"card_atlas","card_selection_small"),this.cardPicture_bmp=phaser.add.image(0,-CARD_BIG_HEIGHT/2+CARD_SMALL_HEIGHT/2-2,"pictures",this.picture),this.cardDisabled_bmp=phaser.add.image(0,-CARD_BIG_HEIGHT/2+CARD_SMALL_HEIGHT/2,"card_atlas","card_disabled"),this.name_bmp.setMaxWidth(83),this.desc1_bmp.setMaxWidth(79),this.desc2_bmp.setMaxWidth(79),this.desc2_bmp.alpha=.75,this.cardInner=phaser.add.container(0,0,[this.cardShadowBig_bmp,this.cardShadowSmall_bmp,this.cardBig_bmp,this.cardSmall_bmp,this.name_bmp,this.type_bmp,this.desc1_bmp,this.desc2_bmp,this.cost_money_bmp,this.cost_infl_bmp,this.cardFrameBig_bmp,this.cardFrameSmall_bmp,this.cardSelectionBig_bmp,this.cardSelectionSmall_bmp,this.cardPicture_bmp,this.cardDisabled_bmp]),this.card=phaser.add.container(this.sourceX,GAME_HEIGHT-.5*CARD_BIG_HEIGHT,[this.cardInner]),this.cardShadowBig_bmp.alpha=0,this.cardShadowSmall_bmp.alpha=0,this.cardSelectionSmall_bmp.alpha=0,this.cardSelectionBig_bmp.alpha=0,this.cardDisabled_bmp.alpha=0,this.playType==CARD_TYPE_COMPONENT&&(this.cardFrameBig_bmp.setTint(425942),this.cardFrameSmall_bmp.setTint(425942),this.type_bmp.text="~"),this.playType==CARD_TYPE_WORKER&&(this.cardFrameBig_bmp.setTint(16758297),this.cardFrameSmall_bmp.setTint(16758297),this.type_bmp.text="_"),this.playType==CARD_TYPE_DOCUMENT&&(this.cardFrameBig_bmp.setTint(13849659),this.cardFrameSmall_bmp.setTint(13849659),this.type_bmp.text="\\"),this.card.depth=LAYER_CARD,this.card.setSize(CARD_WIDTH,CARD_BIG_HEIGHT),this.card.setInteractive({cursor:"pointer"}),this.card.input.useHandCursor=!0,phaser.input.setDraggable(this.card),this.expand(),this.card.on("drag",this.drag),this.card.on("dragstart",(function(pointer){if(1!=pointer.rightButtonDown()&&1!=pointer.middleButtonDown()&&1!=pointer.backButtonDown()&&1!=pointer.forwardButtonDown()){if(self.updateLanguage(),self.card.input.enabled=!1,self.hand.game.selectedItem=self,self.game.isBulldozer=!1,self.soundGrab.play(),self.phaser.tweens.add({targets:self.card,x:pointer.x,y:pointer.y+CARD_SMALL_HEIGHT+25,ease:"Cubic.InOut",duration:100}),self.selectedSpot instanceof CardSlot&&(self.selectedSpot.actionAfterPull=self.selectedSpot.parent.openClose,self.selectedSpot.parent.container.remove(self.card),self.phaser.children.add(self.card),self.card.setDepth(LAYER_CARD_DRAG),self.selectedSpot.takeMyCardAway(),self.shrink()),0!=self.game.request.open||0!=self.game.construction.open||self.playTarget!=CARD_TARGET_NODE&&self.playTarget!=CARD_TARGET_BLOCK||(self.hand.game.town.showSupplyDemand(0),self.hand.game.town.resetSimulation()),0==self.game.request.open&&0==self.game.construction.open&&0==self.game.drawer1.open&&0==self.game.drawer2.open&&0==self.game.drawer3.open&&""!=self.game.request.constructionId)for(var i=0;i<self.game.request.slots.length;i++)if(null!=self.game.request.slots[i]&&0==self.game.request.slots[i].gotCard&&self.game.request.slots[i].wantId==self.id){self.game.request.autoOpened=!0,self.game.request.openCloseConstruction();break}if(0==self.game.construction.open&&0==self.game.request.open&&0==self.game.drawer1.open&&0==self.game.drawer2.open&&0==self.game.drawer3.open&&""!=self.game.construction.constructionId)for(var i=0;i<self.game.construction.slots.length;i++)if(null!=self.game.construction.slots[i]&&0==self.game.construction.slots[i].gotCard&&self.game.construction.slots[i].wantId==self.id){self.game.construction.autoOpened=!0,self.game.construction.openCloseConstruction();break}self.playTarget==CARD_TARGET_CONSTRUCTION&&(self.hand.game.isDraggingCard=!0,self.hand.game.updateLocks()),self.playTarget==CARD_TARGET_GLOBAL&&(self.hand.game.isTargetingGlobal=!0,self.hand.game.isDraggingCard=!0,self.hand.game.updateLocks()),self.playTarget==CARD_TARGET_BLOCK&&(self.hand.game.isDraggingCard=!0,self.hand.game.isTargetingBlocks=!0,self.hand.game.updateLocks()),self.playTarget==CARD_TARGET_STREET&&(self.game.town.showWellPower(),self.hand.game.isDraggingCard=!0,self.hand.game.isTargetingStreets=!0,self.hand.game.updateLocks()),self.playTarget==CARD_TARGET_NODE&&("well"!=self.id&&self.game.town.showWellPower(),self.hand.game.isDraggingCard=!0,self.hand.game.isTargetingNodes=!0,self.hand.game.updateLocks()),self.cardDisabled_bmp.alpha=0,self.card.setDepth(LAYER_CARD_DRAG)}})),this.card.on("pointerover",(function(){self.expand(),null!=self.selectedSpot&&self.selectedSpot instanceof CardSlot?(self.selectedSpot.parent.container.bringToTop(self.card),self.card.setDepth(LAYER_CARD_DRAG)):self.card.setDepth(LAYER_CARD_DRAG)})),this.card.on("pointerout",(function(){0==self.selected&&0==self.game.isDrawingCards&&self.collapseAndShrink(),self.hand.sortCards()})),this.card.on("pointerdown",(function(pointer){if(1!=self.game.isDrawingCards&&null==self.game.rightClickedCardFly){if(1==pointer.rightButtonDown()||1==pointer.middleButtonDown()||1==pointer.backButtonDown()||1==pointer.forwardButtonDown())return self.game.selectedSpot=null,null==self.selectedSpot?(self.playType==CARD_TYPE_WORKER&&self.game.drawer3.level>0&&(self.game.drawer3.findFreeSlot(self),null!=self.game.selectedSpot?(self.selectedSpot=self.game.selectedSpot,self.rightClickedCardFly=!0,self.game.rightClickedCardFly=self,self.easing="Circ.In",self.endDrag(pointer),self.hand.game.isDroppingCard=!0,self.hand.game.updateLocks()):self.hand.game.deny.play()),self.playType==CARD_TYPE_DOCUMENT&&self.game.drawer1.level>0&&(self.game.drawer1.findFreeSlot(self),null!=self.game.selectedSpot?(self.selectedSpot=self.game.selectedSpot,self.rightClickedCardFly=!0,self.game.rightClickedCardFly=self,self.easing="Circ.In",self.endDrag(pointer),self.hand.game.isDroppingCard=!0,self.hand.game.updateLocks()):self.hand.game.deny.play()),self.playType==CARD_TYPE_COMPONENT&&self.game.drawer2.level>0&&(self.game.drawer2.findFreeSlot(self),null!=self.game.selectedSpot?(self.selectedSpot=self.game.selectedSpot,self.rightClickedCardFly=!0,self.game.rightClickedCardFly=self,self.easing="Circ.In",self.endDrag(pointer),self.hand.game.isDroppingCard=!0,self.hand.game.updateLocks()):self.hand.game.deny.play())):self.selectedSpot instanceof CardSlot&&self.game.hand.cards.length<5?(self.selectedSpot.actionAfterPull=null,self.selectedSpot.parent.container.remove(self.card),self.phaser.children.add(self.card),self.card.x+=80,self.card.setDepth(LAYER_CARD_DRAG),self.selectedSpot.takeMyCardAway(),self.shrink(),self.selectedSpot.actionAfterPull=self.selectedSpot.parent.openClose,self.selectedSpot=null,self.game.selectedSpot=null,self.easing="Cubic.Out",self.hand.cards.push(self),self.sourceY=CARD_HAND_ENABLED_Y,self.hand.positionCards(),self.card.setDepth(LAYER_CARD_DRAG)):self.selectedSpot instanceof CardSlot&&self.hand.game.deny.play(),self.clicked=!1,void(self.selected=!1);self.phaser.tweens.killTweensOf(self.game),phaser.tweens.addCounter({from:255,to:128,duration:500,yoyo:!0,delay:0,repeat:-1,onUpdate:function(tween){var value=Math.floor(tween.getValue()),c1=Phaser.Display.Color.GetColor(value,value,value),c2=Phaser.Display.Color.GetColor(382-value,382-value,382-value);self.cardSelectionBig_bmp.setTint(c1,c2,c2,c1),self.cardSelectionSmall_bmp.setTint(c1,c2,c2,c1)}}),self.selectedSpot&&self.selectedSpot instanceof CardSlot?(self.selectedSpot.actionAfterPull=null,phaser.input.dragDistanceThreshold=8,self.expand()):(self.clicked=!0,self.selected=!0,phaser.input.dragDistanceThreshold=6,self.raisedShift=-5,phaser.tweens.add({targets:[self.cardShadowBig_bmp,self.cardShadowSmall_bmp,self.cardSelectionBig_bmp,self.cardSelectionSmall_bmp],alpha:1,ease:"Cubic.Out",duration:100}),self.raiseAndShift())}})),this.card.on("pointerup",(function(){self.dragDeltaCenterX=0,self.dragDeltaCenterY=0})),this.card.on("dragend",(function(pointer,dragX,dragY,dropped){1!=self.game.isDrawingCards&&1!=pointer.leftButtonDown()&&0==self.game.clickMode&&self.endDrag(pointer)})),this.updateLanguage()}}