class Deck{constructor(g){_defineProperty(this,"showDeck",()=>{this.deck_list_bmp.text="\n\n"+getString(this.game.language,"gui","deck","string")+": "+this.stack.length+" "+getString(this.game.language,"gui","cards","string")+"\n\n";for(var items=[],amounts=[],i=0;i<this.stack.length;i++){for(var this_item=this.stack[i],found=!1,j=0;j<items.length;j++)items[j]+""==getString(this.game.language,"card",this_item,"name")+""&&(amounts[j]++,found=!0);0==found&&(items.push(getString(this.game.language,"card",this_item,"name")),amounts.push(1))}for(var i=0;i<items.length;i++)this.deck_list_bmp.text+=items[i]+" x"+amounts[i]+"\n";this.deck_list_bck.setOrigin(0),this.deck_list_bck.displayHeight=this.deck_list_bmp.height+1+4-20,this.deck_list_bck.displayWidth=this.deck_list_bmp.width+3+4+3,this.deck_list_bck.x=2,this.deck_list_bck.y=GAME_HEIGHT+20,this.phaser.tweens.add({targets:[this.deck_list_bmp],alpha:1,y:GAME_HEIGHT-8-this.deck_list_bmp.height-147+DECK_Y_SHIFT,ease:"Cubic.Out",duration:200}),this.phaser.tweens.add({targets:[this.deck_list_bck],alpha:.75,y:GAME_HEIGHT-8-this.deck_list_bmp.height-147+DECK_Y_SHIFT+20,ease:"Cubic.Out",duration:200})}),_defineProperty(this,"hideDeck",()=>{this.phaser.tweens.add({targets:[this.deck_list_bmp],alpha:0,y:GAME_HEIGHT,ease:"Cubic.Out",duration:200}),this.phaser.tweens.add({targets:[this.deck_list_bck],alpha:0,y:GAME_HEIGHT+20,ease:"Cubic.Out",duration:200})}),_defineProperty(this,"showDiscard",()=>{this.discard_list_bmp.text="\n\n"+getString(this.game.language,"gui","discarded","string")+": "+this.discarded.length+" "+getString(this.game.language,"gui","cards","string")+"\n\n";for(var items=[],amounts=[],i=0;i<this.discarded.length;i++){for(var this_item=this.discarded[i],found=!1,j=0;j<items.length;j++)items[j]+""==getString(this.game.language,"card",this_item,"name")+""&&(amounts[j]++,found=!0);0==found&&(items.push(getString(this.game.language,"card",this_item,"name")),amounts.push(1))}for(var i=0;i<items.length;i++)this.discard_list_bmp.text+=items[i]+" x"+amounts[i]+"\n";this.discard_list_bck.setOrigin(0),this.discard_list_bck.displayHeight=this.discard_list_bmp.height+1+4-20,this.discard_list_bck.displayWidth=this.discard_list_bmp.width+3+4+3,this.discard_list_bck.x=GAME_WIDTH-104-2,this.discard_list_bck.y=GAME_HEIGHT,this.phaser.tweens.add({targets:[this.discard_list_bck],alpha:.75,y:GAME_HEIGHT-8-this.discard_list_bmp.height-147+DECK_Y_SHIFT+20,ease:"Cubic.Out",duration:200}),this.phaser.tweens.add({targets:[this.discard_list_bmp],alpha:1,y:GAME_HEIGHT-8-this.discard_list_bmp.height-147+DECK_Y_SHIFT,ease:"Cubic.Out",duration:200,onComplete:function(){this.discard_list_bmp.setDepth(LAYER_GUI+2),this.discard_list_bck.setDepth(LAYER_GUI+2)},onCompleteScope:this})}),_defineProperty(this,"hideDiscard",()=>{this.discard_list_bmp.setDepth(LAYER_GUI-1),this.discard_list_bck.setDepth(LAYER_GUI-2),this.phaser.tweens.add({targets:[this.discard_list_bck],alpha:0,y:GAME_HEIGHT,ease:"Cubic.Out",duration:200}),this.phaser.tweens.add({targets:[this.discard_list_bmp],alpha:0,y:GAME_HEIGHT,ease:"Cubic.Out",duration:200,onComplete:function(){},onCompleteScope:this})}),_defineProperty(this,"drawCards",()=>{if(this.game.isDrawingCards=!0,this.game.isUpdatingHand=!0,this.game.updateLocks(),this.game.endedTurn>2)return this.game.isUpdatingHand=!1,this.game.isDrawingCards=!1,this.game.updateLocks(),this.game.updatePriceAvailability(),this.phaser.input.enabled=!0,this.game.endTurnButton.hover.visible=!0,this.game.saveGame(),!0;this.game.hand.discardHand(!0);var durationy=500;this.game.turn>1&&(0==this.discarded.length||0==this.stack.length)&&(durationy=0),this.phaser.tweens.add({targets:[this.stack_bmp],y:GAME_HEIGHT-2,ease:"Back.InOut",duration:durationy,onComplete:function(){1==this.game.hand.drawCard(this.game.difficultyCardsPerTurn)&&(this.phaser.input.enabled=!1,this.phaser.tweens.add({targets:[this.stack_bmp],y:GAME_HEIGHT-2+DECK_Y_SHIFT,ease:"Back.InOut",duration:500,delay:1e3,onComplete:function(){-1==this.game.tutorial&&(this.game.tutorial=0,this.game.saveGame())},onCompleteScope:this}),this.phaser.input.enabled=!0,this.game.endTurnButton.hover.visible=!0,this.game.saveGame())},onCompleteScope:this})}),_defineProperty(this,"updateStack",()=>{this.stack_bmp.alpha=1,this.discarded_bmp.alpha=1,this.updateDeckNumber();var number=Math.ceil(this.stack.length/3);number>10&&(number=10),this.stack_bmp.setTexture("card_atlas","back"+number),0==number&&(this.stack_bmp.alpha=0),(number=Math.ceil(this.discarded.length/3))>10&&(number=10),this.discarded_bmp.setTexture("card_atlas","back"+number),0==number&&(this.discarded_bmp.alpha=0)}),_defineProperty(this,"updateStackFake",num=>{this.stack_bmp.alpha=1,this.discarded_bmp.alpha=1;var number=Math.ceil(num/3);number>10&&(number=10),this.stack_bmp.setTexture("card_atlas","back"+number)}),_defineProperty(this,"updateDiscarded",()=>{this.discarded_bmp.alpha=1;var number=Math.ceil(this.discarded.length/3);number>10&&(number=10),this.discarded_bmp.setTexture("card_atlas","back"+number)}),_defineProperty(this,"pullCard",()=>{var result=null;if(0==this.game.town.constructions.length&&this.stack.includes("water_source"))for(var i=0;i<this.stack.length;i++)"water_source"==this.stack[i]&&(this.stack.splice(i,1),result="water_source");else this.stack.length>=1&&(result=this.stack.splice(Math.floor(Math.random()*this.stack.length),1)[0]);return result}),_defineProperty(this,"updateDeckNumber",()=>{0==this.stack.length?this.deck_number_bmp.text="":this.deck_number_bmp.text=this.stack.length}),_defineProperty(this,"shuffle",()=>{this.game.endedTurn+=1,this.updateDiscarded();var total=this.discarded.length,timePass=1e3,timePass2=1e3;for(this.discarded.length<=5?(timePass=1e3,timePass2=500):this.discarded.length>=10&&setTimeout((function(t){t.soundReturn.play()}),250,this),this.updateStack();this.discarded.length>0;){var delay=this.discarded.length;delay*=1e3/total,this.stack.length+this.discarded.length<10&&setTimeout((function(t){t.soundShuffle[0].play({mute:!1,volume:1,rate:1,detune:400*Math.random()-200,seek:0,loop:!1,delay:0}),t.soundShuffle.push(t.soundShuffle.shift())}),delay,this),this.game.hand.flyFakeCard2(this.discarded_bmp.x-CARD_WIDTH/2,this.discarded_bmp.y-CARD_BIG_HEIGHT/2,1,this.stack_bmp.x-STACK_WIDTH/2,GAME_HEIGHT-2-STACK_HEIGHT+CARD_BIG_HEIGHT/2,1,500,500,delay,delay,"Sine.InOut",1),this.stack.push(this.discarded.shift()),setTimeout(this.updateDiscarded,delay),setTimeout(this.updateStackFake,delay+500,this.discarded.length+1)}setTimeout(this.afterShuffle1,timePass+timePass2),this.game.deck.updateDeckNumber()}),_defineProperty(this,"afterShuffle1",()=>{var total=this.stack.length,timePass=1500,timePass2=1e3,maxnum=this.stack.length;maxnum>30&&(maxnum=30),maxnum<=5&&(maxnum=0,timePass=1,timePass2=1),this.updateStack();for(var i=0;i<maxnum;i++){var delay=i;delay*=1e3/maxnum;var shift=CARD_WIDTH/2+Math.random()*CARD_WIDTH*2.5,shift2=20*Math.random()-10,time=200;this.game.hand.flyFakeCard2(this.stack_bmp.x-STACK_WIDTH/2,GAME_HEIGHT-2-STACK_HEIGHT+CARD_BIG_HEIGHT/2,1,this.stack_bmp.x-STACK_WIDTH/2+shift,GAME_HEIGHT-2-STACK_HEIGHT+CARD_BIG_HEIGHT/2+shift2,1.01,200,200,delay,delay,"Linear",1),this.game.hand.flyFakeCard2(this.stack_bmp.x-STACK_WIDTH/2+shift,GAME_HEIGHT-2-STACK_HEIGHT+CARD_BIG_HEIGHT/2+shift2,1.01,this.stack_bmp.x-STACK_WIDTH/2,GAME_HEIGHT-2-STACK_HEIGHT+CARD_BIG_HEIGHT/2,1,200,200,delay+200-5,delay+200-5,"Linear",0),this.soundShuffle.push(this.soundShuffle.splice(Math.floor(Math.random()*this.soundShuffle.length),1)[0]),setTimeout((function(t){t.soundShuffle[0].play(),t.soundShuffle.push(t.soundShuffle.shift())}),delay,this),setTimeout(this.updateDiscarded,delay),setTimeout(this.updateStack,delay+1e3)}setTimeout(this.updateStack,delay+1e3),setTimeout(this.drawCards,timePass),setTimeout(this.afterShuffle2,timePass+timePass2)}),_defineProperty(this,"afterShuffle2",()=>{this.updateStack(),this.game.endTurnButton.hover.alpha=.1}),this.game=g,this.phaser=this.game.phaser;var self=this;this.stack=["water_source","worker","worker","permit","foreman"],this.discarded=[],this.soundDraw=this.phaser.sound.add("deal3"),this.soundShuffle=[this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3"),this.phaser.sound.add("deal1"),this.phaser.sound.add("deal5"),this.phaser.sound.add("deal3")],this.soundReturn=this.phaser.sound.add("return"),this.tweencounter=null,this.stack_bmp=this.phaser.add.image(CARD_WIDTH+2,GAME_HEIGHT-2+DECK_Y_SHIFT,"card_atlas","back1"),this.discarded_bmp=this.phaser.add.image(GAME_WIDTH-2,GAME_HEIGHT-2+DECK_Y_SHIFT,"card_atlas","back10"),this.stack_bmp.setDepth(LAYER_GUI),this.discarded_bmp.setDepth(LAYER_GUI),this.stack_bmp.setOrigin(1),this.discarded_bmp.setOrigin(1),this.stack_bmp.setInteractive({cursor:"pointer"}),this.stack_bmp.input.useHandCursor=!0,this.discarded_bmp.setInteractive({cursor:"pointer"}),this.discarded_bmp.input.useHandCursor=!0,this.deck_number_bmp=this.phaser.add.bitmapText(17,335,"numbers_font_white",""),this.deck_number_bmp.setDepth(LAYER_GUI+1),this.deck_number_bmp.alpha=.75,this.deck_list_bmp=this.phaser.add.bitmapText(300,300,"text_white",""),this.deck_list_bmp.setDepth(LAYER_GUI-1),this.discard_list_bmp=this.phaser.add.bitmapText(300,300,"text_white",""),this.discard_list_bmp.setDepth(LAYER_GUI-1),this.stack_bmp.on("pointerover",this.showDeck),this.stack_bmp.on("pointerout",this.hideDeck),this.discarded_bmp.on("pointerover",this.showDiscard),this.discarded_bmp.on("pointerout",this.hideDiscard),this.deck_list_bmp.alpha=0,this.deck_list_bmp.x=5,this.deck_list_bmp.y=GAME_HEIGHT,this.deck_list_bck=this.phaser.add.image(0,0,"shade"),this.discard_list_bck=this.phaser.add.image(0,0,"shade"),this.deck_list_bck.setDepth(LAYER_GUI-2),this.discard_list_bck.setDepth(LAYER_GUI-2),this.deck_list_bck.alpha=0,this.discard_list_bck.alpha=0,this.discard_list_bmp.alpha=0,this.discard_list_bmp.x=GAME_WIDTH-104,this.discard_list_bmp.y=GAME_HEIGHT,this.updateStack()}}