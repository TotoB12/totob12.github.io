class TownNode{constructor(game,id,buildable){_defineProperty(this,"sellBasic",()=>{var xmlData=this.phaser.cache.xml.get("cards").getElementsByTagName("card"),xmlData=getFirstElementByAttributeValue(xmlData,"id",this.builtId),costMoney=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("money")),costInfluence=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("infl"));this.game.pay(-Math.floor(costMoney/2),-Math.floor(costInfluence/2),this,!0,!1),this.builtId="",this.game.town.refreshPipes(),this.setEnabled(!1),this.game.town.setStreetsEnabled(!0,!0),this.game.town.updateSupply();for(var i=0;i<this.blocks.length;i++)this.game.town.blocks[this.blocks[i]].showSupplyDemand(ZOOM_TWEEN_1);setTimeout(this.game.town.hideSupplyDemandSoft,1e3),setTimeout(this.game.deck.updateDiscarded,550)}),_defineProperty(this,"sellToHand",()=>{this.game.hand.addCard2(this.builtId,this.x,this.y),this.game.hand.positionCards(),this.sellBasic()}),_defineProperty(this,"sellToDiscard",()=>{this.game.hand.flyFakeCard(this.x,this.y,.1,this.game.deck.discarded_bmp.x-CARD_WIDTH/2,this.game.deck.discarded_bmp.y-CARD_BIG_HEIGHT/2,1,500,500,0,50,"Sine.InOut",1,100),this.game.deck.discarded.push(this.builtId),this.sellBasic()}),_defineProperty(this,"nothing",()=>{this.setEnabled(!0)}),_defineProperty(this,"setEnabled",(value,del,select)=>{this.targeterBmp.input.enabled=value,value?""!=this.builtId?(this.nodeBmp.alpha=0,this.targeterBmp.alpha=.05,del?(this.targeterBmp.setTint(16724016),this.targeterBmp.blendMode=Phaser.BlendModes.MULTIPLY):(this.targeterBmp.setTint(65280),this.targeterBmp.blendMode=Phaser.BlendModes.ADD),this.game.isBulldozer?this.targeterBmp.setDepth(LAYER_SUPPLY_DEMAND+20):this.targeterBmp.setDepth(LAYER_SUPPLY_DEMAND)):(this.targeterBmp.setDepth(LAYER_SUPPLY_DEMAND),this.nodeBmp.alpha=1,this.targeterBmp.alpha=.5,this.hasPipeWater||this.game.selectedItem&&"well"==this.game.selectedItem.id?(this.nodeBmp.clearTint(),this.targeterBmp.setTint(7848180)):(this.nodeBmp.setTint(16711680),this.targeterBmp.setTint(7848180)),this.targeterBmp.blendMode=Phaser.BlendModes.ADD):(select&&""!=this.builtId&&(this.targeterBmp.input.enabled=!0),this.targeterBmp.setDepth(this.nodeBmp.y-50),this.targeterBmp.alpha=0,this.well1Bmp.alpha=0,this.nodeBmp.clearTint(),this.targeterBmp.clearTint(),this.noWaterBmp.visible=!1,select&&(this.targeterBmp.alpha=.01),""!=this.builtId&&(this.well1Bmp.alpha=1,"well"==this.builtId?(this.well1Bmp.setTexture("town_nodes_atlas","well2.png"),this.noWaterBmp.visible=!1):this.hasPipeWater?(this.well1Bmp.setTexture("town_nodes_atlas","well1.png"),this.noWaterBmp.visible=!1):(this.well1Bmp.setTexture("town_nodes_atlas","well0.png"),this.noWaterBmp.visible=!0))),"16"==this.id&&(this.nodeBmp.alpha=0)}),_defineProperty(this,"showNodeWellPower",()=>{this.wellPowerTxt.visible=!0,this.wellPowerTxt.text="$ +"+this.game.town.columnWellPower[this.column],this.x>500?this.wellPowerTxt.x=this.x-.75*this.wellPowerTxt.width:this.wellPowerTxt.x=this.x-this.wellPowerTxt.width/2,Number(this.id)<=6?this.wellPowerTxt.y=this.y+this.wellPowerTxt.height:7==Number(this.id)?this.wellPowerTxt.y=this.y+this.wellPowerTxt.height/2:9==Number(this.id)?this.wellPowerTxt.y=this.y+this.wellPowerTxt.height/4:this.wellPowerTxt.y=this.y-this.wellPowerTxt.height/4,this.wellPowerTxt.rotation=.25*-Math.PI,this.phaser.tweens.add({targets:[this.wellPowerTxt],alpha:.4,ease:"Sine.Out",duration:500})}),_defineProperty(this,"hideNodeWellPower",()=>{this.phaser.tweens.add({targets:[this.wellPowerTxt],alpha:0,ease:"Sine.Out",duration:500})});var phaser=game.phaser;this.game=game,this.phaser=game.phaser;var self=this;this.id=id,this.x=0,this.y=0,this.wellBmp,this.targeterBmp,this.buildable=buildable,this.builtId="",this.detail=-1,this.gainWater1=0,this.gainWater2=0,this.hasPipeWater=!1,this.hadPipeWater=!1,this.nodes=[],this.pipes=[],this.blocks=[],this.column=-1,this.nodeBmp=phaser.add.image(0,0,"town_nodes_atlas","node("+id+").png"),this.well1Bmp=phaser.add.image(0,0,"town_nodes_atlas","well1.png"),this.targeterBmp=phaser.add.image(0,0,"town_nodes_atlas","marker("+id+").png"),this.noWaterBmp=phaser.add.image(0,0,"gui","nowater");var tex=phaser.textures.get("town_nodes_atlas");this.targeterBmp.displayOriginX=0,this.targeterBmp.displayOriginY=0,this.targeterBmp.x=tex.frames["marker("+id+").png"].customData.spriteSourceSize.x,this.targeterBmp.y=tex.frames["marker("+id+").png"].customData.spriteSourceSize.y,this.nodeBmp.displayOriginX=0,this.nodeBmp.displayOriginY=0,this.nodeBmp.x=tex.frames["node("+id+").png"].customData.spriteSourceSize.x,this.nodeBmp.y=tex.frames["node("+id+").png"].customData.spriteSourceSize.y,this.well1Bmp.displayOriginX=0,this.well1Bmp.displayOriginY=4,this.well1Bmp.x=tex.frames["node("+id+").png"].customData.spriteSourceSize.x,this.well1Bmp.y=tex.frames["node("+id+").png"].customData.spriteSourceSize.y,this.x=this.nodeBmp.x,this.y=this.nodeBmp.y,this.wellPowerTxt=this.phaser.add.bitmapText(150,260,"numbers_font","$ 1"),this.wellPowerTxt.setDepth(10),this.wellPowerTxt.blendMode="ADD",this.wellPowerTxt.alpha=0,this.noWaterBmp.setOrigin(.5,1),this.noWaterBmp.x=this.nodeBmp.x+this.nodeBmp.width/2,this.noWaterBmp.y=this.nodeBmp.y-1,this.noWaterBmp.setDepth(LAYER_SUPPLY_DEMAND),this.noWaterBmp.visible=!1,this.phaser.tweens.add({targets:[this.noWaterBmp],scale:.75,ease:"Sine.InOut",duration:500,repeat:-1,yoyo:!0}),this.nodeBmp.alpha=1,this.well1Bmp.alpha=0,this.nodeBmp.alpha=0,this.nodeBmp.setDepth(this.nodeBmp.y-20),this.targeterBmp.alpha=.01,this.targeterBmp.setDepth(LAYER_SUPPLY_DEMAND),this.well1Bmp.depth=this.well1Bmp.y-this.well1Bmp.height,this.targeterBmp.setInteractive({cursor:"pointer",pixelPerfect:"true"}),this.targeterBmp.on("pointerover",(function(){if(!self.game.isDraggingCard||""==self.builtId)if(self.targeterBmp.blendMode=Phaser.BlendModes.NORMAL,self.well1Bmp.blendMode=Phaser.BlendModes.NORMAL,self.nodeBmp.alpha=1,self.targeterBmp.alpha=1,self.game.isDraggingCard){if(self.targeterBmp.blendMode=Phaser.BlendModes.ADD,self.hasPipeWater||"well"==self.game.selectedItem.id){if(self.noWaterBmp.visible=!1,self.targeterBmp.setTint(7848180),null!=self.game.selectedItem&&null!=self.game.selectedItem.gainWater1)for(var i=0;i<self.blocks.length;i++)"well"==self.game.selectedItem.id?self.game.town.blocks[self.blocks[i]].showUpdatedSupply(self.game.town.blocks[self.blocks[i]].simulatedGain+self.game.selectedItem.gainWater1,0):self.game.town.blocks[self.blocks[i]].showUpdatedSupply(self.game.town.blocks[self.blocks[i]].simulatedGain+self.game.town.columnWellPower[self.column],0)}else self.noWaterBmp.visible=!0,self.targeterBmp.setTint(7848180);self.game.selectedSpot=self}else if(""!=self.builtId)if(self.game.isBulldozer){var xmlData=self.phaser.cache.xml.get("cards").getElementsByTagName("card"),xmlData=getFirstElementByAttributeValue(xmlData,"id",self.builtId),costMoney=Number(xmlData.getElementsByTagName("cost")[0].getAttribute("money"));costMoney=Math.floor(costMoney/2),self.game.showTooltip2(getString(self.game.language,"tooltip","sell_what","string")+" "+getString(self.game.language,"card",self.builtId,"name")+" "+getString(self.game.language,"tooltip","sell_for","string")+costMoney),self.well1Bmp.setTint(16711680),self.targeterBmp.blendMode=Phaser.BlendModes.ADD,self.targeterBmp.alpha=.01}else{0==self.hasPipeWater&&"sump"==self.builtId?self.game.showTooltip2(getString(self.game.language,"card",self.builtId,"name")+"\n"+getString(self.game.language,"tooltip","no_water","string")):self.game.showTooltip2(getString(self.game.language,"card",self.builtId,"name")),self.well1Bmp.setTint(65280),self.targeterBmp.setTint(65280),self.targeterBmp.alpha=.01;for(var i=0;i<self.blocks.length;i++){var gain=0;gain="well"==self.builtId?self.gainWater1:1==self.hasPipeWater?self.game.town.columnWellPower[self.column]:0,self.game.town.blocks[self.blocks[i]].floatieTxt.text="$ +"+gain,self.game.town.blocks[self.blocks[i]].floatieTxt.visible=!0,self.game.town.blocks[self.blocks[i]].targeterBmp.alpha=.15}}})),this.targeterBmp.on("pointerout",(function(){if(self.game.selectedSpot=null,self.game.hideTooltip(),""==self.builtId&&(self.noWaterBmp.visible=!1),null!=game.selectedItem){for(var i=0;i<self.blocks.length;i++)self.game.town.blocks[self.blocks[i]].showUpdatedSupply(self.game.town.blocks[self.blocks[i]].simulatedGain,0);self.targeterBmp.input.enabled&&""==self.builtId&&(self.targeterBmp.alpha=.5)}1==self.game.isBulldozer&&(self.targeterBmp.alpha=.01),self.well1Bmp.clearTint(),self.well1Bmp.blendMode=Phaser.BlendModes.NORMAL;for(var i=0;i<self.blocks.length;i++){var tb=game.town.blocks[self.blocks[i]].targeterBmp,tb2=game.town.blocks[self.blocks[i]].buildingBmp;tb.alpha=0,tb.clearTint(),tb2.clearTint()}for(var i=0;i<self.blocks.length;i++)self.game.town.blocks[self.blocks[i]].floatieTxt.visible=!1,self.game.town.blocks[self.blocks[i]].targeterBmp.alpha=.01})),this.targeterBmp.on("pointerdown",(function(pointer){1==self.game.isBulldozer&&1==pointer.leftButtonDown()&&(self.game.hand.cards.length>=5?self.game.popup.show(getString(self.game.language,"popup","sell_6th","header"),getString(self.game.language,"popup","sell_6th","string"),self.sellToDiscard,self.nothing):self.sellToHand())}))}}