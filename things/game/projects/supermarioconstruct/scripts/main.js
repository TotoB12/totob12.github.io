'use strict';window.DOMHandler=class{constructor(c,a){this._iRuntime=c;this._componentId=a;this._hasTickCallback=!1;this._tickCallback=()=>this.Tick()}Attach(){}PostToRuntime(c,a,b,d){this._iRuntime.PostToRuntimeComponent(this._componentId,c,a,b,d)}PostToRuntimeAsync(c,a,b,d){return this._iRuntime.PostToRuntimeComponentAsync(this._componentId,c,a,b,d)}_PostToRuntimeMaybeSync(c,a,b){this._iRuntime.UsesWorker()?this.PostToRuntime(c,a,b):this._iRuntime._GetLocalRuntime()._OnMessageFromDOM({type:"event",
component:this._componentId,handler:c,dispatchOpts:b||null,data:a,responseId:null})}AddRuntimeMessageHandler(c,a){this._iRuntime.AddRuntimeComponentMessageHandler(this._componentId,c,a)}AddRuntimeMessageHandlers(c){for(const [a,b]of c)this.AddRuntimeMessageHandler(a,b)}GetRuntimeInterface(){return this._iRuntime}GetComponentID(){return this._componentId}_StartTicking(){this._hasTickCallback||(this._iRuntime._AddRAFCallback(this._tickCallback),this._hasTickCallback=!0)}_StopTicking(){this._hasTickCallback&&
(this._iRuntime._RemoveRAFCallback(this._tickCallback),this._hasTickCallback=!1)}Tick(){}};
window.RateLimiter=class{constructor(c,a){this._callback=c;this._interval=a;this._timerId=-1;this._lastCallTime=-Infinity;this._timerCallFunc=()=>this._OnTimer();this._canRunImmediate=this._ignoreReset=!1}SetCanRunImmediate(c){this._canRunImmediate=!!c}Call(){if(-1===this._timerId){var c=Date.now(),a=c-this._lastCallTime,b=this._interval;a>=b&&this._canRunImmediate?(this._lastCallTime=c,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(b-a,4))}}_RunCallback(){this._ignoreReset=
!0;this._callback();this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._lastCallTime=Date.now())}_OnTimer(){this._timerId=-1;this._lastCallTime=Date.now();this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer();this._timerCallFunc=this._callback=null}};"use strict";
window.DOMElementHandler=class extends self.DOMHandler{constructor(c,a){super(c,a);this._elementMap=new Map;this._autoAttach=!0;this.AddRuntimeMessageHandlers([["create",b=>this._OnCreate(b)],["destroy",b=>this._OnDestroy(b)],["set-visible",b=>this._OnSetVisible(b)],["update-position",b=>this._OnUpdatePosition(b)],["update-state",b=>this._OnUpdateState(b)],["focus",b=>this._OnSetFocus(b)],["set-css-style",b=>this._OnSetCssStyle(b)],["set-attribute",b=>this._OnSetAttribute(b)],["remove-attribute",
b=>this._OnRemoveAttribute(b)]]);this.AddDOMElementMessageHandler("get-element",b=>b)}SetAutoAttach(c){this._autoAttach=!!c}AddDOMElementMessageHandler(c,a){this.AddRuntimeMessageHandler(c,b=>{const d=this._elementMap.get(b.elementId);return a(d,b)})}_OnCreate(c){const a=c.elementId,b=this.CreateElement(a,c);this._elementMap.set(a,b);c.isVisible||(b.style.display="none");c=this._GetFocusElement(b);c.addEventListener("focus",d=>this._OnFocus(a));c.addEventListener("blur",d=>this._OnBlur(a));this._autoAttach&&
document.body.appendChild(b)}CreateElement(c,a){throw Error("required override");}DestroyElement(c){}_OnDestroy(c){c=c.elementId;const a=this._elementMap.get(c);this.DestroyElement(a);this._autoAttach&&a.parentElement.removeChild(a);this._elementMap.delete(c)}PostToRuntimeElement(c,a,b){b||(b={});b.elementId=a;this.PostToRuntime(c,b)}_PostToRuntimeElementMaybeSync(c,a,b){b||(b={});b.elementId=a;this._PostToRuntimeMaybeSync(c,b)}_OnSetVisible(c){this._autoAttach&&(this._elementMap.get(c.elementId).style.display=
c.isVisible?"":"none")}_OnUpdatePosition(c){if(this._autoAttach){var a=this._elementMap.get(c.elementId);a.style.left=c.left+"px";a.style.top=c.top+"px";a.style.width=c.width+"px";a.style.height=c.height+"px";c=c.fontSize;null!==c&&(a.style.fontSize=c+"em")}}_OnUpdateState(c){const a=this._elementMap.get(c.elementId);this.UpdateState(a,c)}UpdateState(c,a){throw Error("required override");}_GetFocusElement(c){return c}_OnFocus(c){this.PostToRuntimeElement("elem-focused",c)}_OnBlur(c){this.PostToRuntimeElement("elem-blurred",
c)}_OnSetFocus(c){const a=this._GetFocusElement(this._elementMap.get(c.elementId));c.focus?a.focus():a.blur()}_OnSetCssStyle(c){this._elementMap.get(c.elementId).style[c.prop]=c.val}_OnSetAttribute(c){this._elementMap.get(c.elementId).setAttribute(c.name,c.val)}_OnRemoveAttribute(c){this._elementMap.get(c.elementId).removeAttribute(c.name)}GetElementById(c){return this._elementMap.get(c)}};"use strict";
{const c=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent);function a(t){if(t.isStringSrc){const h=document.createElement("script");h.async=!1;h.textContent=t.str;document.head.appendChild(h)}else return new Promise((h,k)=>{const e=document.createElement("script");e.onload=h;e.onerror=k;e.async=!1;e.src=t;document.head.appendChild(e)})}let b=new Audio;const d={"audio/webm; codecs=opus":!!b.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!b.canPlayType("audio/ogg; codecs=opus"),
"audio/webm; codecs=vorbis":!!b.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!b.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!b.canPlayType("audio/mp4"),"audio/mpeg":!!b.canPlayType("audio/mpeg")};b=null;async function f(t){t=await m(t);return(new TextDecoder("utf-8")).decode(t)}function m(t){return new Promise((h,k)=>{const e=new FileReader;e.onload=g=>h(g.target.result);e.onerror=g=>k(g);e.readAsArrayBuffer(t)})}const n=[];let r=0;window.RealFile=window.File;const u=
[],z=new Map,w=new Map;let x=0;const A=[];self.runOnStartup=function(t){if("function"!==typeof t)throw Error("runOnStartup called without a function");A.push(t)};const y=new Set(["cordova","playable-ad","instant-games"]);function B(t){return y.has(t)}window.RuntimeInterface=class t{constructor(h){this._useWorker=h.useWorker;this._messageChannelPort=null;this._baseUrl="";this._scriptFolder=h.scriptFolder;this._workerScriptBlobURLs={};this._loadingElem=this._localRuntime=this._worker=null;this._domHandlers=
[];this._jobScheduler=this._canvas=this._runtimeDomHandler=null;this._rafId=-1;this._rafFunc=()=>this._OnRAFCallback();this._rafCallbacks=[];this._exportType=h.exportType;!this._useWorker||"undefined"!==typeof OffscreenCanvas&&navigator.userActivation||(this._useWorker=!1);B(this._exportType)&&this._useWorker&&(console.warn("[C3 runtime] Worker mode is enabled and supported, but is disabled in WebViews due to crbug.com/923007. Reverting to DOM mode."),this._useWorker=!1);this._localFileStrings=this._localFileBlobs=
null;"html5"!==this._exportType&&"playable-ad"!==this._exportType||"file"!==location.protocol.substr(0,4)||alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");this.AddRuntimeComponentMessageHandler("runtime","cordova-fetch-local-file",k=>this._OnCordovaFetchLocalFile(k));this.AddRuntimeComponentMessageHandler("runtime","create-job-worker",k=>this._OnCreateJobWorker(k));"cordova"===this._exportType?
document.addEventListener("deviceready",()=>this._Init(h)):this._Init(h)}Release(){this._CancelAnimationFrame();this._messageChannelPort&&(this._messageChannelPort=this._messageChannelPort.onmessage=null);this._worker&&(this._worker.terminate(),this._worker=null);this._localRuntime&&(this._localRuntime.Release(),this._localRuntime=null);this._canvas&&(this._canvas.parentElement.removeChild(this._canvas),this._canvas=null)}GetCanvas(){return this._canvas}GetBaseURL(){return this._baseUrl}UsesWorker(){return this._useWorker}GetExportType(){return this._exportType}GetScriptFolder(){return this._scriptFolder}IsiOSCordova(){return c&&
"cordova"===this._exportType}IsiOSWebView(){return c&&B(this._exportType)||navigator.standalone}async _Init(h){"preview"===this._exportType&&(this._loadingElem=document.createElement("div"),this._loadingElem.className="previewLoadingMessage",this._loadingElem.textContent=h.previewLoadingMessage,document.body.appendChild(this._loadingElem));if("playable-ad"===this._exportType){this._localFileBlobs=self.c3_base64files;this._localFileStrings={};await this._ConvertDataUrisToBlobs();for(let e=0,g=h.engineScripts.length;e<
g;++e){var k=h.engineScripts[e].toLowerCase();this._localFileStrings.hasOwnProperty(k)?h.engineScripts[e]={isStringSrc:!0,str:this._localFileStrings[k]}:this._localFileBlobs.hasOwnProperty(k)&&(h.engineScripts[e]=URL.createObjectURL(this._localFileBlobs[k]))}}h.baseUrl?this._baseUrl=h.baseUrl:(k=location.origin,this._baseUrl=("null"===k?"file:///":k)+location.pathname,k=this._baseUrl.lastIndexOf("/"),-1!==k&&(this._baseUrl=this._baseUrl.substr(0,k+1)));if(h.workerScripts)for(const [e,g]of Object.entries(h.workerScripts))this._workerScriptBlobURLs[e]=
URL.createObjectURL(g);k=new MessageChannel;this._messageChannelPort=k.port1;this._messageChannelPort.onmessage=e=>this._OnMessageFromRuntime(e.data);window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(e=>this._OnMessageFromDebugger(e));this._jobScheduler=new self.JobSchedulerDOM(this);await this._jobScheduler.Init();this.MaybeForceBodySize();"object"===typeof window.StatusBar&&window.StatusBar.hide();"object"===typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode();
this._useWorker?await this._InitWorker(h,k.port2):await this._InitDOM(h,k.port2)}_GetWorkerURL(h){return this._workerScriptBlobURLs.hasOwnProperty(h)?this._workerScriptBlobURLs[h]:h.endsWith("/workermain.js")&&this._workerScriptBlobURLs.hasOwnProperty("workermain.js")?this._workerScriptBlobURLs["workermain.js"]:"playable-ad"===this._exportType&&this._localFileBlobs.hasOwnProperty(h.toLowerCase())?URL.createObjectURL(this._localFileBlobs[h.toLowerCase()]):h}async CreateWorker(h,k,e){if(h.startsWith("blob:"))return new Worker(h,
e);if(this.IsiOSCordova()&&"file:"===location.protocol)return h=await this.CordovaFetchLocalFileAsArrayBuffer(this._scriptFolder+h),h=new Blob([h],{type:"application/javascript"}),new Worker(URL.createObjectURL(h),e);h=new URL(h,k);if(location.origin!==h.origin){h=await fetch(h);if(!h.ok)throw Error("failed to fetch worker script");h=await h.blob();return new Worker(URL.createObjectURL(h),e)}return new Worker(h,e)}_GetWindowInnerWidth(){return Math.max(window.innerWidth,1)}_GetWindowInnerHeight(){return Math.max(window.innerHeight,
1)}MaybeForceBodySize(){if(this.IsiOSWebView()){const h=document.documentElement.style,k=document.body.style,e=window.innerWidth<window.innerHeight,g=e?window.screen.width:window.screen.height;k.height=h.height=(e?window.screen.height:window.screen.width)+"px";k.width=h.width=g+"px"}}_GetCommonRuntimeOptions(h){return{baseUrl:this._baseUrl,windowInnerWidth:this._GetWindowInnerWidth(),windowInnerHeight:this._GetWindowInnerHeight(),devicePixelRatio:window.devicePixelRatio,isFullscreen:t.IsDocumentFullscreen(),
projectData:h.projectData,previewImageBlobs:window.cr_previewImageBlobs||this._localFileBlobs,previewProjectFileBlobs:window.cr_previewProjectFileBlobs,exportType:h.exportType,isDebug:-1<self.location.search.indexOf("debug"),ife:!!self.ife,jobScheduler:this._jobScheduler.GetPortData(),supportedAudioFormats:d,opusWasmScriptUrl:window.cr_opusWasmScriptUrl||this._scriptFolder+"opus.wasm.js",opusWasmBinaryUrl:window.cr_opusWasmBinaryUrl||this._scriptFolder+"opus.wasm.wasm",isiOSCordova:this.IsiOSCordova(),
isiOSWebView:this.IsiOSWebView(),isFBInstantAvailable:"undefined"!==typeof self.FBInstant}}async _InitWorker(h,k){var e=this._GetWorkerURL(h.workerMainUrl);this._worker=await this.CreateWorker(e,this._baseUrl,{name:"Runtime"});this._canvas=document.createElement("canvas");this._canvas.style.display="none";e=this._canvas.transferControlToOffscreen();document.body.appendChild(this._canvas);window.c3canvas=this._canvas;this._worker.postMessage(Object.assign(this._GetCommonRuntimeOptions(h),{type:"init-runtime",
isInWorker:!0,messagePort:k,canvas:e,workerDependencyScripts:h.workerDependencyScripts||[],engineScripts:h.engineScripts,projectScripts:window.cr_allProjectScripts,projectScriptsStatus:self.C3_ProjectScriptsStatus}),[k,e,...this._jobScheduler.GetPortTransferables()]);this._domHandlers=u.map(g=>new g(this));this._FindRuntimeDOMHandler();self.c3_callFunction=(g,l)=>this._runtimeDomHandler._InvokeFunctionFromJS(g,l);"preview"===this._exportType&&(self.goToLastErrorScript=()=>this.PostToRuntimeComponent("runtime",
"go-to-last-error-script"))}async _InitDOM(h,k){this._canvas=document.createElement("canvas");this._canvas.style.display="none";document.body.appendChild(this._canvas);window.c3canvas=this._canvas;this._domHandlers=u.map(g=>new g(this));this._FindRuntimeDOMHandler();const e=h.engineScripts.map(g=>"string"===typeof g?(new URL(g,this._baseUrl)).toString():g);Array.isArray(h.workerDependencyScripts)&&e.unshift(...h.workerDependencyScripts);await Promise.all(e.map(g=>a(g)));if(h.projectScripts&&0<h.projectScripts.length){const g=
self.C3_ProjectScriptsStatus;try{if(await Promise.all(h.projectScripts.map(l=>a(l[1]))),Object.values(g).some(l=>!l)){self.setTimeout(()=>this._ReportProjectScriptError(g),100);return}}catch(l){console.error("[Preview] Error loading project scripts: ",l);self.setTimeout(()=>this._ReportProjectScriptError(g),100);return}}"preview"===this._exportType&&"object"!==typeof self.C3.ScriptsInEvents?(this._RemoveLoadingMessage(),console.error("[C3 runtime] Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax."),
alert("Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax.")):(h=Object.assign(this._GetCommonRuntimeOptions(h),{isInWorker:!1,messagePort:k,canvas:this._canvas,runOnStartupFunctions:A}),this._OnBeforeCreateRuntime(),this._localRuntime=self.C3_CreateRuntime(h),await self.C3_InitRuntime(this._localRuntime,h))}_ReportProjectScriptError(h){this._RemoveLoadingMessage();h=`Failed to load project script '${Object.entries(h).filter(k=>!k[1]).map(k=>k[0])[0]}'. Check all your JavaScript code has valid syntax.`;
console.error("[Preview] "+h);alert(h)}_OnBeforeCreateRuntime(){this._RemoveLoadingMessage()}_RemoveLoadingMessage(){this._loadingElem&&(this._loadingElem.parentElement.removeChild(this._loadingElem),this._loadingElem=null)}async _OnCreateJobWorker(h){h=await this._jobScheduler._CreateJobWorker();return{outputPort:h,transferables:[h]}}_GetLocalRuntime(){if(this._useWorker)throw Error("not available in worker mode");return this._localRuntime}PostToRuntimeComponent(h,k,e,g,l){this._messageChannelPort.postMessage({type:"event",
component:h,handler:k,dispatchOpts:g||null,data:e,responseId:null},l)}PostToRuntimeComponentAsync(h,k,e,g,l){const p=x++,q=new Promise((v,C)=>{w.set(p,{resolve:v,reject:C})});this._messageChannelPort.postMessage({type:"event",component:h,handler:k,dispatchOpts:g||null,data:e,responseId:p},l);return q}["_OnMessageFromRuntime"](h){const k=h.type;if("event"===k)return this._OnEventFromRuntime(h);if("result"===k)this._OnResultFromRuntime(h);else if("runtime-ready"===k)this._OnRuntimeReady();else if("alert-error"===
k)this._RemoveLoadingMessage(),alert(h.message);else if("creating-runtime"===k)this._OnBeforeCreateRuntime();else throw Error(`unknown message '${k}'`);}_OnEventFromRuntime(h){const k=h.component,e=h.handler,g=h.data,l=h.responseId;if(h=z.get(k))if(h=h.get(e)){var p=null;try{p=h(g)}catch(q){console.error(`Exception in '${k}' handler '${e}':`,q);null!==l&&this._PostResultToRuntime(l,!1,""+q);return}if(null===l)return p;p&&p.then?p.then(q=>this._PostResultToRuntime(l,!0,q)).catch(q=>{console.error(`Rejection from '${k}' handler '${e}':`,
q);this._PostResultToRuntime(l,!1,""+q)}):this._PostResultToRuntime(l,!0,p)}else console.warn(`[DOM] No handler '${e}' for component '${k}'`);else console.warn(`[DOM] No event handlers for component '${k}'`)}_PostResultToRuntime(h,k,e){let g;e&&e.transferables&&(g=e.transferables);this._messageChannelPort.postMessage({type:"result",responseId:h,isOk:k,result:e},g)}_OnResultFromRuntime(h){const k=h.responseId,e=h.isOk;h=h.result;const g=w.get(k);e?g.resolve(h):g.reject(h);w.delete(k)}AddRuntimeComponentMessageHandler(h,
k,e){let g=z.get(h);g||(g=new Map,z.set(h,g));if(g.has(k))throw Error(`[DOM] Component '${h}' already has handler '${k}'`);g.set(k,e)}static AddDOMHandlerClass(h){if(u.includes(h))throw Error("DOM handler already added");u.push(h)}_FindRuntimeDOMHandler(){for(const h of this._domHandlers)if("runtime"===h.GetComponentID()){this._runtimeDomHandler=h;return}throw Error("cannot find runtime DOM handler");}_OnMessageFromDebugger(h){this.PostToRuntimeComponent("debugger","message",h)}_OnRuntimeReady(){for(const h of this._domHandlers)h.Attach()}static IsDocumentFullscreen(){return!!(document.fullscreenElement||
document.webkitFullscreenElement||document.mozFullScreenElement)}async GetRemotePreviewStatusInfo(){return await this.PostToRuntimeComponentAsync("runtime","get-remote-preview-status-info")}_AddRAFCallback(h){this._rafCallbacks.push(h);this._RequestAnimationFrame()}_RemoveRAFCallback(h){h=this._rafCallbacks.indexOf(h);if(-1===h)throw Error("invalid callback");this._rafCallbacks.splice(h,1);this._rafCallbacks.length||this._CancelAnimationFrame()}_RequestAnimationFrame(){-1===this._rafId&&this._rafCallbacks.length&&
(this._rafId=requestAnimationFrame(this._rafFunc))}_CancelAnimationFrame(){-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1)}_OnRAFCallback(){this._rafId=-1;for(const h of this._rafCallbacks)h();this._RequestAnimationFrame()}TryPlayMedia(h){this._runtimeDomHandler.TryPlayMedia(h)}RemovePendingPlay(h){this._runtimeDomHandler.RemovePendingPlay(h)}_PlayPendingMedia(){this._runtimeDomHandler._PlayPendingMedia()}SetSilent(h){this._runtimeDomHandler.SetSilent(h)}IsAudioFormatSupported(h){return!!d[h]}async _WasmDecodeWebMOpus(h){h=
await this.PostToRuntimeComponentAsync("runtime","opus-decode",{arrayBuffer:h},null,[h]);return new Float32Array(h)}IsAbsoluteURL(h){return/^(?:[a-z]+:)?\/\//.test(h)||"data:"===h.substr(0,5)||"blob:"===h.substr(0,5)}IsRelativeURL(h){return!this.IsAbsoluteURL(h)}async _OnCordovaFetchLocalFile(h){const k=h.filename;switch(h.as){case "text":return await this.CordovaFetchLocalFileAsText(k);case "buffer":return await this.CordovaFetchLocalFileAsArrayBuffer(k);default:throw Error("unsupported type");}}_GetPermissionAPI(){const h=
window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;if("object"!==typeof h)throw Error("Permission API is not loaded");return h}_MapPermissionID(h,k){h=h[k];if("string"!==typeof h)throw Error("Invalid permission name");return h}_HasPermission(h){const k=this._GetPermissionAPI();return new Promise((e,g)=>k.checkPermission(this._MapPermissionID(k,h),l=>e(!!l.hasPermission),g))}_RequestPermission(h){const k=this._GetPermissionAPI();return new Promise((e,g)=>k.requestPermission(this._MapPermissionID(k,
h),l=>e(!!l.hasPermission),g))}async RequestPermissions(h){if("cordova"!==this.GetExportType()||this.IsiOSCordova())return!0;for(const k of h)if(!await this._HasPermission(k)&&!1===await this._RequestPermission(k))return!1;return!0}async RequirePermissions(...h){if(!1===await this.RequestPermissions(h))throw Error("Permission not granted");}CordovaFetchLocalFile(h){const k=window.cordova.file.applicationDirectory+"www/"+h.toLowerCase();return new Promise((e,g)=>{window.resolveLocalFileSystemURL(k,
l=>{l.file(e,g)},g)})}async CordovaFetchLocalFileAsText(h){h=await this.CordovaFetchLocalFile(h);return await f(h)}_CordovaMaybeStartNextArrayBufferRead(){if(n.length&&!(8<=r)){r++;var h=n.shift();this._CordovaDoFetchLocalFileAsAsArrayBuffer(h.filename,h.successCallback,h.errorCallback)}}CordovaFetchLocalFileAsArrayBuffer(h){return new Promise((k,e)=>{n.push({filename:h,successCallback:g=>{r--;this._CordovaMaybeStartNextArrayBufferRead();k(g)},errorCallback:g=>{r--;this._CordovaMaybeStartNextArrayBufferRead();
e(g)}});this._CordovaMaybeStartNextArrayBufferRead()})}async _CordovaDoFetchLocalFileAsAsArrayBuffer(h,k,e){try{const g=await this.CordovaFetchLocalFile(h),l=await m(g);k(l)}catch(g){e(g)}}async _ConvertDataUrisToBlobs(){const h=[];for(const [k,e]of Object.entries(this._localFileBlobs))h.push(this._ConvertDataUriToBlobs(k,e));await Promise.all(h)}async _ConvertDataUriToBlobs(h,k){if("object"===typeof k)this._localFileBlobs[h]=new Blob([k.str],{type:k.type}),this._localFileStrings[h]=k.str;else{let e=
await this._FetchDataUri(k);e||(e=this._DataURIToBinaryBlobSync(k));this._localFileBlobs[h]=e}}async _FetchDataUri(h){try{return await (await fetch(h)).blob()}catch(k){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",k),null}}_DataURIToBinaryBlobSync(h){h=this._ParseDataURI(h);return this._BinaryStringToBlob(h.data,h.mime_type)}_ParseDataURI(h){var k=
h.indexOf(",");if(0>k)throw new URIError("expected comma in data: uri");var e=h.substring(5,k);h=h.substring(k+1);k=e.split(";");e=k[0]||"";const g=k[2];h="base64"===k[1]||"base64"===g?atob(h):decodeURIComponent(h);return{mime_type:e,data:h}}_BinaryStringToBlob(h,k){var e=h.length;let g=e>>2,l=new Uint8Array(e),p=new Uint32Array(l.buffer,0,g),q,v;for(v=q=0;q<g;++q)p[q]=h.charCodeAt(v++)|h.charCodeAt(v++)<<8|h.charCodeAt(v++)<<16|h.charCodeAt(v++)<<24;for(e&=3;e--;)l[v]=h.charCodeAt(v),++v;return new Blob([l],
{type:k})}}}"use strict";
{const c=self.RuntimeInterface;function a(e){return e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents||e.originalEvent&&e.originalEvent.sourceCapabilities&&e.originalEvent.sourceCapabilities.firesTouchEvents}const b=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),d={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},f={dispatchUserScriptEvent:!0},m={dispatchRuntimeEvent:!0};function n(e){return new Promise((g,l)=>{const p=document.createElement("link");p.onload=()=>g(p);p.onerror=
q=>l(q);p.rel="stylesheet";p.href=e;document.head.appendChild(p)})}function r(e){return new Promise((g,l)=>{const p=new Image;p.onload=()=>g(p);p.onerror=q=>l(q);p.src=e})}async function u(e){e=URL.createObjectURL(e);try{return await r(e)}finally{URL.revokeObjectURL(e)}}function z(e){return new Promise((g,l)=>{let p=new FileReader;p.onload=q=>g(q.target.result);p.onerror=q=>l(q);p.readAsText(e)})}async function w(e,g,l){if(!/firefox/i.test(navigator.userAgent))return await u(e);var p=await z(e);p=
(new DOMParser).parseFromString(p,"image/svg+xml");const q=p.documentElement;if(q.hasAttribute("width")&&q.hasAttribute("height")){const v=q.getAttribute("width"),C=q.getAttribute("height");if(!v.includes("%")&&!C.includes("%"))return await u(e)}q.setAttribute("width",g+"px");q.setAttribute("height",l+"px");p=(new XMLSerializer).serializeToString(p);e=new Blob([p],{type:"image/svg+xml"});return await u(e)}function x(e){do{if(e.parentNode&&e.hasAttribute("contenteditable"))return!0;e=e.parentNode}while(e);
return!1}const A=new Set(["canvas","body","html"]);function y(e){const g=e.target.tagName.toLowerCase();A.has(g)&&e.preventDefault()}function B(e){(e.metaKey||e.ctrlKey)&&e.preventDefault()}self.C3_GetSvgImageSize=async function(e){e=await u(e);if(0<e.width&&0<e.height)return[e.width,e.height];{e.style.position="absolute";e.style.left="0px";e.style.top="0px";e.style.visibility="hidden";document.body.appendChild(e);const g=e.getBoundingClientRect();document.body.removeChild(e);return[g.width,g.height]}};
self.C3_RasterSvgImageBlob=async function(e,g,l,p,q){e=await w(e,g,l);const v=document.createElement("canvas");v.width=p;v.height=q;v.getContext("2d").drawImage(e,0,0,g,l);return v};let t=!1;document.addEventListener("pause",()=>t=!0);document.addEventListener("resume",()=>t=!1);function h(){try{return window.parent&&window.parent.document.hasFocus()}catch(e){return!1}}function k(){const e=document.activeElement;if(!e)return!1;const g=e.tagName.toLowerCase(),l=new Set("email number password search tel text url".split(" "));
return"textarea"===g?!0:"input"===g?l.has(e.type.toLowerCase()||"text"):x(e)}c.AddDOMHandlerClass(class extends self.DOMHandler{constructor(e){super(e,"runtime");this._isFirstSizeUpdate=!0;this._simulatedResizeTimerId=-1;this._targetOrientation="any";this._attachedDeviceMotionEvent=this._attachedDeviceOrientationEvent=!1;this._lastPointerRawUpdateEvent=this._pointerRawUpdateRateLimiter=this._debugHighlightElem=null;e.AddRuntimeComponentMessageHandler("canvas","update-size",p=>this._OnUpdateCanvasSize(p));
e.AddRuntimeComponentMessageHandler("runtime","invoke-download",p=>this._OnInvokeDownload(p));e.AddRuntimeComponentMessageHandler("runtime","raster-svg-image",p=>this._OnRasterSvgImage(p));e.AddRuntimeComponentMessageHandler("runtime","get-svg-image-size",p=>this._OnGetSvgImageSize(p));e.AddRuntimeComponentMessageHandler("runtime","set-target-orientation",p=>this._OnSetTargetOrientation(p));e.AddRuntimeComponentMessageHandler("runtime","register-sw",()=>this._OnRegisterSW());e.AddRuntimeComponentMessageHandler("runtime",
"post-to-debugger",p=>this._OnPostToDebugger(p));e.AddRuntimeComponentMessageHandler("runtime","go-to-script",p=>this._OnPostToDebugger(p));e.AddRuntimeComponentMessageHandler("runtime","before-start-ticking",()=>this._OnBeforeStartTicking());e.AddRuntimeComponentMessageHandler("runtime","debug-highlight",p=>this._OnDebugHighlight(p));e.AddRuntimeComponentMessageHandler("runtime","enable-device-orientation",()=>this._AttachDeviceOrientationEvent());e.AddRuntimeComponentMessageHandler("runtime","enable-device-motion",
()=>this._AttachDeviceMotionEvent());e.AddRuntimeComponentMessageHandler("runtime","add-stylesheet",p=>this._OnAddStylesheet(p));e.AddRuntimeComponentMessageHandler("runtime","alert",p=>this._OnAlert(p));e.AddRuntimeComponentMessageHandler("runtime","hide-cordova-splash",()=>this._OnHideCordovaSplash());const g=new Set(["input","textarea","datalist"]);window.addEventListener("contextmenu",p=>{const q=p.target,v=q.tagName.toLowerCase();g.has(v)||x(q)||p.preventDefault()});const l=e.GetCanvas();window.addEventListener("selectstart",
y);window.addEventListener("gesturehold",y);l.addEventListener("selectstart",y);l.addEventListener("gesturehold",y);window.addEventListener("touchstart",y,{passive:!1});"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",y,{passive:!1}),l.addEventListener("pointerdown",y)):l.addEventListener("touchstart",y);this._mousePointerLastButtons=0;window.addEventListener("mousedown",p=>{1===p.button&&p.preventDefault()});window.addEventListener("mousewheel",B,{passive:!1});window.addEventListener("wheel",
B,{passive:!1});window.addEventListener("resize",()=>this._OnWindowResize());e.IsiOSWebView()&&window.addEventListener("focusout",()=>{k()||(document.scrollingElement.scrollTop=0)});this._mediaPendingPlay=new Set;this._mediaRemovedPendingPlay=new WeakSet;this._isSilent=!1}_OnBeforeStartTicking(){"cordova"===this._iRuntime.GetExportType()?(document.addEventListener("pause",()=>this._OnVisibilityChange(!0)),document.addEventListener("resume",()=>this._OnVisibilityChange(!1))):document.addEventListener("visibilitychange",
()=>this._OnVisibilityChange(document.hidden));return{isSuspended:!(!document.hidden&&!t)}}Attach(){window.addEventListener("focus",()=>this._PostRuntimeEvent("window-focus"));window.addEventListener("blur",()=>{this._PostRuntimeEvent("window-blur",{parentHasFocus:h()});this._mousePointerLastButtons=0});window.addEventListener("fullscreenchange",()=>this._OnFullscreenChange());window.addEventListener("webkitfullscreenchange",()=>this._OnFullscreenChange());window.addEventListener("mozfullscreenchange",
()=>this._OnFullscreenChange());window.addEventListener("fullscreenerror",g=>this._OnFullscreenError(g));window.addEventListener("webkitfullscreenerror",g=>this._OnFullscreenError(g));window.addEventListener("mozfullscreenerror",g=>this._OnFullscreenError(g));window.addEventListener("keydown",g=>this._OnKeyEvent("keydown",g));window.addEventListener("keyup",g=>this._OnKeyEvent("keyup",g));window.addEventListener("dblclick",g=>this._OnMouseEvent("dblclick",g,d));window.addEventListener("wheel",g=>
this._OnMouseWheelEvent("wheel",g));"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",g=>{this._HandlePointerDownFocus(g);this._OnPointerEvent("pointerdown",g)}),this._iRuntime.UsesWorker()&&"undefined"!==typeof window.onpointerrawupdate&&self===self.top?(this._pointerRawUpdateRateLimiter=new self.RateLimiter(()=>this._DoSendPointerRawUpdate(),5),this._pointerRawUpdateRateLimiter.SetCanRunImmediate(!0),window.addEventListener("pointerrawupdate",g=>this._OnPointerRawUpdate(g))):
window.addEventListener("pointermove",g=>this._OnPointerEvent("pointermove",g)),window.addEventListener("pointerup",g=>this._OnPointerEvent("pointerup",g)),window.addEventListener("pointercancel",g=>this._OnPointerEvent("pointercancel",g))):(window.addEventListener("mousedown",g=>{this._HandlePointerDownFocus(g);this._OnMouseEventAsPointer("pointerdown",g)}),window.addEventListener("mousemove",g=>this._OnMouseEventAsPointer("pointermove",g)),window.addEventListener("mouseup",g=>this._OnMouseEventAsPointer("pointerup",
g)),window.addEventListener("touchstart",g=>{this._HandlePointerDownFocus(g);this._OnTouchEvent("pointerdown",g)}),window.addEventListener("touchmove",g=>this._OnTouchEvent("pointermove",g)),window.addEventListener("touchend",g=>this._OnTouchEvent("pointerup",g)),window.addEventListener("touchcancel",g=>this._OnTouchEvent("pointercancel",g)));const e=()=>this._PlayPendingMedia();window.addEventListener("pointerup",e,!0);window.addEventListener("touchend",e,!0);window.addEventListener("click",e,!0);
window.addEventListener("keydown",e,!0);window.addEventListener("gamepadconnected",e,!0)}_PostRuntimeEvent(e,g){this.PostToRuntime(e,g||null,m)}_GetWindowInnerWidth(){return this._iRuntime._GetWindowInnerWidth()}_GetWindowInnerHeight(){return this._iRuntime._GetWindowInnerHeight()}_OnWindowResize(){const e=this._GetWindowInnerWidth(),g=this._GetWindowInnerHeight();this._PostRuntimeEvent("window-resize",{innerWidth:e,innerHeight:g,devicePixelRatio:window.devicePixelRatio});this._iRuntime.IsiOSWebView()&&
(-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId),this._OnSimulatedResize(e,g,0))}_ScheduleSimulatedResize(e,g,l){-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId);this._simulatedResizeTimerId=setTimeout(()=>this._OnSimulatedResize(e,g,l),48)}_OnSimulatedResize(e,g,l){const p=this._GetWindowInnerWidth(),q=this._GetWindowInnerHeight();this._simulatedResizeTimerId=-1;p!=e||q!=g?this._PostRuntimeEvent("window-resize",{innerWidth:p,innerHeight:q,
devicePixelRatio:window.devicePixelRatio}):10>l&&this._ScheduleSimulatedResize(p,q,l+1)}_OnSetTargetOrientation(e){this._targetOrientation=e.targetOrientation}_TrySetTargetOrientation(){const e=this._targetOrientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(e).catch(g=>console.warn("[Construct 3] Failed to lock orientation: ",g));else try{let g=!1;screen.lockOrientation?g=screen.lockOrientation(e):screen.webkitLockOrientation?g=screen.webkitLockOrientation(e):screen.mozLockOrientation?
g=screen.mozLockOrientation(e):screen.msLockOrientation&&(g=screen.msLockOrientation(e));g||console.warn("[Construct 3] Failed to lock orientation")}catch(g){console.warn("[Construct 3] Failed to lock orientation: ",g)}}_OnFullscreenChange(){const e=c.IsDocumentFullscreen();e&&"any"!==this._targetOrientation&&this._TrySetTargetOrientation();this.PostToRuntime("fullscreenchange",{isFullscreen:e,innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnFullscreenError(e){console.warn("[Construct 3] Fullscreen request failed: ",
e);this.PostToRuntime("fullscreenerror",{isFullscreen:c.IsDocumentFullscreen(),innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnVisibilityChange(e){e?this._iRuntime._CancelAnimationFrame():this._iRuntime._RequestAnimationFrame();this.PostToRuntime("visibilitychange",{hidden:e})}_OnKeyEvent(e,g){"Backspace"===g.key&&y(g);const l=b.get(g.code)||g.code;this._PostToRuntimeMaybeSync(e,{code:l,key:g.key,which:g.which,repeat:g.repeat,altKey:g.altKey,ctrlKey:g.ctrlKey,
metaKey:g.metaKey,shiftKey:g.shiftKey,timeStamp:g.timeStamp},d)}_OnMouseWheelEvent(e,g){this.PostToRuntime(e,{clientX:g.clientX,clientY:g.clientY,pageX:g.pageX,pageY:g.pageY,deltaX:g.deltaX,deltaY:g.deltaY,deltaZ:g.deltaZ,deltaMode:g.deltaMode,timeStamp:g.timeStamp},d)}_OnMouseEvent(e,g,l){a(g)||this._PostToRuntimeMaybeSync(e,{button:g.button,buttons:g.buttons,clientX:g.clientX,clientY:g.clientY,pageX:g.pageX,pageY:g.pageY,timeStamp:g.timeStamp},l)}_OnMouseEventAsPointer(e,g){if(!a(g)){var l=this._mousePointerLastButtons;
"pointerdown"===e&&0!==l?e="pointermove":"pointerup"===e&&0!==g.buttons&&(e="pointermove");this._PostToRuntimeMaybeSync(e,{pointerId:1,pointerType:"mouse",button:g.button,buttons:g.buttons,lastButtons:l,clientX:g.clientX,clientY:g.clientY,pageX:g.pageX,pageY:g.pageY,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,timeStamp:g.timeStamp},d);this._mousePointerLastButtons=g.buttons;this._OnMouseEvent(g.type,g,f)}}_OnPointerEvent(e,g){this._pointerRawUpdateRateLimiter&&"pointermove"!==
e&&this._pointerRawUpdateRateLimiter.Reset();var l=0;"mouse"===g.pointerType&&(l=this._mousePointerLastButtons);this._PostToRuntimeMaybeSync(e,{pointerId:g.pointerId,pointerType:g.pointerType,button:g.button,buttons:g.buttons,lastButtons:l,clientX:g.clientX,clientY:g.clientY,pageX:g.pageX,pageY:g.pageY,width:g.width||0,height:g.height||0,pressure:g.pressure||0,tangentialPressure:g.tangentialPressure||0,tiltX:g.tiltX||0,tiltY:g.tiltY||0,twist:g.twist||0,timeStamp:g.timeStamp},d);"mouse"===g.pointerType&&
(l="mousemove","pointerdown"===e?l="mousedown":"pointerup"===e&&(l="pointerup"),this._OnMouseEvent(l,g,f),this._mousePointerLastButtons=g.buttons)}_OnPointerRawUpdate(e){this._lastPointerRawUpdateEvent=e;this._pointerRawUpdateRateLimiter.Call()}_DoSendPointerRawUpdate(){this._OnPointerEvent("pointermove",this._lastPointerRawUpdateEvent);this._lastPointerRawUpdateEvent=null}_OnTouchEvent(e,g){for(let l=0,p=g.changedTouches.length;l<p;++l){const q=g.changedTouches[l];this._PostToRuntimeMaybeSync(e,
{pointerId:q.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:q.clientX,clientY:q.clientY,pageX:q.pageX,pageY:q.pageY,width:2*(q.radiusX||q.webkitRadiusX||0),height:2*(q.radiusY||q.webkitRadiusY||0),pressure:q.force||q.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:q.rotationAngle||0,timeStamp:g.timeStamp},d)}}_HandlePointerDownFocus(e){window!==window.top&&window.focus();this._IsElementCanvasOrDocument(e.target)&&document.activeElement&&!this._IsElementCanvasOrDocument(document.activeElement)&&
document.activeElement.blur()}_IsElementCanvasOrDocument(e){return!e||e===document||e===window||e===document.body||"canvas"===e.tagName.toLowerCase()}_AttachDeviceOrientationEvent(){this._attachedDeviceOrientationEvent||(this._attachedDeviceOrientationEvent=!0,window.addEventListener("deviceorientation",e=>this._OnDeviceOrientation(e)),window.addEventListener("deviceorientationabsolute",e=>this._OnDeviceOrientationAbsolute(e)))}_AttachDeviceMotionEvent(){this._attachedDeviceMotionEvent||(this._attachedDeviceMotionEvent=
!0,window.addEventListener("devicemotion",e=>this._OnDeviceMotion(e)))}_OnDeviceOrientation(e){this.PostToRuntime("deviceorientation",{absolute:!!e.absolute,alpha:e.alpha||0,beta:e.beta||0,gamma:e.gamma||0,timeStamp:e.timeStamp,webkitCompassHeading:e.webkitCompassHeading,webkitCompassAccuracy:e.webkitCompassAccuracy},d)}_OnDeviceOrientationAbsolute(e){this.PostToRuntime("deviceorientationabsolute",{absolute:!!e.absolute,alpha:e.alpha||0,beta:e.beta||0,gamma:e.gamma||0,timeStamp:e.timeStamp},d)}_OnDeviceMotion(e){let g=
null;var l=e.acceleration;l&&(g={x:l.x||0,y:l.y||0,z:l.z||0});l=null;var p=e.accelerationIncludingGravity;p&&(l={x:p.x||0,y:p.y||0,z:p.z||0});p=null;const q=e.rotationRate;q&&(p={alpha:q.alpha||0,beta:q.beta||0,gamma:q.gamma||0});this.PostToRuntime("devicemotion",{acceleration:g,accelerationIncludingGravity:l,rotationRate:p,interval:e.interval,timeStamp:e.timeStamp},d)}_OnUpdateCanvasSize(e){const g=this.GetRuntimeInterface(),l=g.GetCanvas();l.style.width=e.styleWidth+"px";l.style.height=e.styleHeight+
"px";l.style.marginLeft=e.marginLeft+"px";l.style.marginTop=e.marginTop+"px";g.MaybeForceBodySize();this._isFirstSizeUpdate&&(l.style.display="",this._isFirstSizeUpdate=!1)}_OnInvokeDownload(e){const g=e.url;e=e.filename;const l=document.createElement("a"),p=document.body;l.textContent=e;l.href=g;l.download=e;p.appendChild(l);l.click();p.removeChild(l)}async _OnRasterSvgImage(e){var g=e.imageBitmapOpts;e=await self.C3_RasterSvgImageBlob(e.blob,e.imageWidth,e.imageHeight,e.surfaceWidth,e.surfaceHeight);
g=g?await createImageBitmap(e,g):await createImageBitmap(e);return{imageBitmap:g,transferables:[g]}}async _OnGetSvgImageSize(e){return await self.C3_GetSvgImageSize(e.blob)}async _OnAddStylesheet(e){await n(e.url)}_PlayPendingMedia(){var e=[...this._mediaPendingPlay];this._mediaPendingPlay.clear();if(!this._isSilent)for(const g of e)(e=g.play())&&e.catch(l=>{this._mediaRemovedPendingPlay.has(g)||this._mediaPendingPlay.add(g)})}TryPlayMedia(e){if("function"!==typeof e.play)throw Error("missing play function");
this._mediaRemovedPendingPlay.delete(e);let g;try{g=e.play()}catch(l){this._mediaPendingPlay.add(e);return}g&&g.catch(l=>{this._mediaRemovedPendingPlay.has(e)||this._mediaPendingPlay.add(e)})}RemovePendingPlay(e){this._mediaPendingPlay.delete(e);this._mediaRemovedPendingPlay.add(e)}SetSilent(e){this._isSilent=!!e}_OnHideCordovaSplash(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}_OnDebugHighlight(e){if(e.show){this._debugHighlightElem||(this._debugHighlightElem=
document.createElement("div"),this._debugHighlightElem.id="inspectOutline",document.body.appendChild(this._debugHighlightElem));var g=this._debugHighlightElem;g.style.display="";g.style.left=e.left-1+"px";g.style.top=e.top-1+"px";g.style.width=e.width+2+"px";g.style.height=e.height+2+"px";g.textContent=e.name}else this._debugHighlightElem&&(this._debugHighlightElem.style.display="none")}_OnRegisterSW(){window.C3_RegisterSW&&window.C3_RegisterSW()}_OnPostToDebugger(e){window.c3_postToMessagePort&&
(e.from="runtime",window.c3_postToMessagePort(e))}_InvokeFunctionFromJS(e,g){return this.PostToRuntimeAsync("js-invoke-function",{name:e,params:g})}_OnAlert(e){alert(e.message)}})}"use strict";
self.JobSchedulerDOM=class{constructor(c){this._runtimeInterface=c;this._baseUrl=c.GetBaseURL();"preview"===c.GetExportType()?this._baseUrl+="c3/workers/":this._baseUrl+=c.GetScriptFolder();this._maxNumWorkers=Math.min(navigator.hardwareConcurrency||2,16);this._dispatchWorker=null;this._jobWorkers=[];this._outputPort=this._inputPort=null}async Init(){if(this._hasInitialised)throw Error("already initialised");this._hasInitialised=!0;var c=this._runtimeInterface._GetWorkerURL("dispatchworker.js");this._dispatchWorker=
await this._runtimeInterface.CreateWorker(c,this._baseUrl,{name:"DispatchWorker"});c=new MessageChannel;this._inputPort=c.port1;this._dispatchWorker.postMessage({type:"_init","in-port":c.port2},[c.port2]);this._outputPort=await this._CreateJobWorker()}async _CreateJobWorker(){const c=this._jobWorkers.length;var a=this._runtimeInterface._GetWorkerURL("jobworker.js");a=await this._runtimeInterface.CreateWorker(a,this._baseUrl,{name:"JobWorker"+c});const b=new MessageChannel,d=new MessageChannel;this._dispatchWorker.postMessage({type:"_addJobWorker",
port:b.port1},[b.port1]);a.postMessage({type:"init",number:c,"dispatch-port":b.port2,"output-port":d.port2},[b.port2,d.port2]);this._jobWorkers.push(a);return d.port1}GetPortData(){return{inputPort:this._inputPort,outputPort:this._outputPort,maxNumWorkers:this._maxNumWorkers}}GetPortTransferables(){return[this._inputPort,this._outputPort]}};"use strict";
window.C3_IsSupported&&(window.c3_runtimeInterface=new self.RuntimeInterface({useWorker:!0,workerMainUrl:"workermain.js",engineScripts:["scripts/c3runtime.js"],scriptFolder:"scripts/",workerDependencyScripts:[],exportType:"html5"}));"use strict";self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(c){super(c,"mouse");this.AddRuntimeMessageHandler("cursor",a=>this._OnChangeCursorStyle(a))}_OnChangeCursorStyle(c){document.documentElement.style.cursor=c}});"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(c){super(c,"browser");this._exportType="";this.AddRuntimeMessageHandlers([["get-initial-state",a=>this._OnGetInitialState(a)],["ready-for-sw-messages",()=>this._OnReadyForSWMessages()],["alert",a=>this._OnAlert(a)],["close",()=>this._OnClose()],["set-focus",a=>this._OnSetFocus(a)],["vibrate",a=>this._OnVibrate(a)],["lock-orientation",a=>this._OnLockOrientation(a)],["unlock-orientation",()=>this._OnUnlockOrientation()],
["navigate",a=>this._OnNavigate(a)],["request-fullscreen",a=>this._OnRequestFullscreen(a)],["exit-fullscreen",()=>this._OnExitFullscreen()],["set-hash",a=>this._OnSetHash(a)]]);window.addEventListener("online",()=>this._OnOnlineStateChanged(!0));window.addEventListener("offline",()=>this._OnOnlineStateChanged(!1));window.addEventListener("hashchange",()=>this._OnHashChange());document.addEventListener("backbutton",()=>this._OnCordovaBackButton());"undefined"!==typeof Windows&&Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",
a=>this._OnWin10BackRequested(a))}_OnGetInitialState(c){this._exportType=c.exportType;return{location:location.toString(),isOnline:!!navigator.onLine,referrer:document.referrer,title:document.title,isCookieEnabled:!!navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,isScirraArcade:"undefined"!==typeof window.is_scirra_arcade}}_OnReadyForSWMessages(){window.C3_RegisterSW&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(c=>
this.PostToRuntime("sw-message",c.data))}_OnOnlineStateChanged(c){this.PostToRuntime("online-state",{isOnline:c})}_OnCordovaBackButton(){this.PostToRuntime("backbutton")}_OnWin10BackRequested(c){c.handled=!0;this.PostToRuntime("backbutton")}GetNWjsWindow(){return"nwjs"===this._exportType?nw.Window.get():null}_OnAlert(c){alert(c.message)}_OnClose(){navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():window.close()}_OnSetFocus(c){c=
c.isFocus;if("nwjs"===this._exportType){const a=this.GetNWjsWindow();c?a.focus():a.blur()}else c?window.focus():window.blur()}_OnVibrate(c){navigator.vibrate&&navigator.vibrate(c.pattern)}_OnLockOrientation(c){c=c.orientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(c).catch(a=>console.warn("[Construct 3] Failed to lock orientation: ",a));else try{let a=!1;screen.lockOrientation?a=screen.lockOrientation(c):screen.webkitLockOrientation?a=screen.webkitLockOrientation(c):
screen.mozLockOrientation?a=screen.mozLockOrientation(c):screen.msLockOrientation&&(a=screen.msLockOrientation(c));a||console.warn("[Construct 3] Failed to lock orientation")}catch(a){console.warn("[Construct 3] Failed to lock orientation: ",a)}}_OnUnlockOrientation(){try{screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():
screen.msUnlockOrientation&&screen.msUnlockOrientation()}catch(c){}}_OnNavigate(c){var a=c.type;if("back"===a)navigator.app&&navigator.app.backHistory?navigator.app.backHistory():window.back();else if("forward"===a)window.forward();else if("home"===a)window.home();else if("reload"===a)location.reload();else if("url"===a){a=c.url;var b=c.target;c=c.exportType;"windows-uwp"===c&&"undefined"!==typeof Windows?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(a)):self.cordova&&self.cordova.InAppBrowser?
self.cordova.InAppBrowser.open(a,"_system"):"preview"===c?window.open(a,"_blank"):this._isScirraArcade||(2===b?window.top.location=a:1===b?window.parent.location=a:window.location=a)}else"new-window"===a&&(a=c.url,b=c.tag,"windows-uwp"===c.exportType&&"undefined"!==typeof Windows?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(a)):self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(a,"_system"):window.open(a,b))}_OnRequestFullscreen(c){const a={navigationUI:"auto"};
c=c.navUI;1===c?a.navigationUI="hide":2===c&&(a.navigationUI="show");c=document.documentElement;c.requestFullscreen?c.requestFullscreen(a):c.mozRequestFullScreen?c.mozRequestFullScreen(a):c.msRequestFullscreen?c.msRequestFullscreen(a):c.webkitRequestFullScreen&&("undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?c.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):c.webkitRequestFullScreen())}_OnExitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():
document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}_OnSetHash(c){location.hash=c.hash}_OnHashChange(){this.PostToRuntime("hashchange",{location:location.toString()})}});"use strict";
{const c=180/Math.PI;self.AudioDOMHandler=class extends self.DOMHandler{constructor(a){super(a,"audio");this._destinationNode=this._audioContext=null;this._hasAttachedUnblockEvents=this._hasUnblocked=!1;this._unblockFunc=()=>this._UnblockAudioContext();this._audioBuffers=[];this._audioInstances=[];this._lastAudioInstance=null;this._lastPlayedTag="";this._lastTickCount=-1;this._pendingTags=new Map;this._masterVolume=1;this._isSilent=!1;this._timeScaleMode=0;this._timeScale=1;this._gameTime=0;this._panningModel=
"HRTF";this._distanceModel="inverse";this._refDistance=600;this._maxDistance=1E4;this._rolloffFactor=1;this._hasAnySoftwareDecodedMusic=this._playMusicAsSound=!1;this._supportsWebMOpus=this._iRuntime.IsAudioFormatSupported("audio/webm; codecs=opus");this._effects=new Map;this._analysers=new Set;this._isPendingPostFxState=!1;this._microphoneTag="";this._microphoneSource=null;self.C3Audio_OnMicrophoneStream=(b,d)=>this._OnMicrophoneStream(b,d);this._destMediaStreamNode=null;self.C3Audio_GetOutputStream=
()=>this._OnGetOutputStream();self.C3Audio_DOMInterface=this;this.AddRuntimeMessageHandlers([["create-audio-context",b=>this._CreateAudioContext(b)],["play",b=>this._Play(b)],["stop",b=>this._Stop(b)],["stop-all",()=>this._StopAll()],["set-paused",b=>this._SetPaused(b)],["set-volume",b=>this._SetVolume(b)],["fade-volume",b=>this._FadeVolume(b)],["set-master-volume",b=>this._SetMasterVolume(b)],["set-muted",b=>this._SetMuted(b)],["set-silent",b=>this._SetSilent(b)],["set-looping",b=>this._SetLooping(b)],
["set-playback-rate",b=>this._SetPlaybackRate(b)],["seek",b=>this._Seek(b)],["preload",b=>this._Preload(b)],["unload",b=>this._Unload(b)],["unload-all",()=>this._UnloadAll()],["set-suspended",b=>this._SetSuspended(b)],["add-effect",b=>this._AddEffect(b)],["set-effect-param",b=>this._SetEffectParam(b)],["remove-effects",b=>this._RemoveEffects(b)],["tick",b=>this._OnTick(b)],["load-state",b=>this._OnLoadState(b)]])}async _CreateAudioContext(a){a.isiOSCordova&&(this._playMusicAsSound=!0);this._timeScaleMode=
a.timeScaleMode;this._panningModel=["equalpower","HRTF","soundfield"][a.panningModel];this._distanceModel=["linear","inverse","exponential"][a.distanceModel];this._refDistance=a.refDistance;this._maxDistance=a.maxDistance;this._rolloffFactor=a.rolloffFactor;var b={latencyHint:a.latencyHint};if("undefined"!==typeof AudioContext)this._audioContext=new AudioContext(b);else if("undefined"!==typeof webkitAudioContext)this._audioContext=new webkitAudioContext(b);else throw Error("Web Audio API not supported");
this._AttachUnblockEvents();this._audioContext.onstatechange=()=>{"running"!==this._audioContext.state&&this._AttachUnblockEvents()};this._destinationNode=this._audioContext.createGain();this._destinationNode.connect(this._audioContext.destination);b=a.listenerPos;this._audioContext.listener.setPosition(b[0],b[1],b[2]);this._audioContext.listener.setOrientation(0,0,1,0,-1,0);self.C3_GetAudioContextCurrentTime=()=>this.GetAudioCurrentTime();try{await Promise.all(a.preloadList.map(d=>this._GetAudioBuffer(d.originalUrl,
d.url,d.type,!1)))}catch(d){console.error("[Construct 3] Preloading sounds failed: ",d)}return{sampleRate:this._audioContext.sampleRate}}_AttachUnblockEvents(){this._hasAttachedUnblockEvents||(this._hasUnblocked=!1,window.addEventListener("pointerup",this._unblockFunc,!0),window.addEventListener("touchend",this._unblockFunc,!0),window.addEventListener("click",this._unblockFunc,!0),window.addEventListener("keydown",this._unblockFunc,!0),this._hasAttachedUnblockEvents=!0)}_DetachUnblockEvents(){this._hasAttachedUnblockEvents&&
(this._hasUnblocked=!0,window.removeEventListener("pointerup",this._unblockFunc,!0),window.removeEventListener("touchend",this._unblockFunc,!0),window.removeEventListener("click",this._unblockFunc,!0),window.removeEventListener("keydown",this._unblockFunc,!0),this._hasAttachedUnblockEvents=!1)}_UnblockAudioContext(){if(!this._hasUnblocked){var a=this._audioContext;"suspended"===a.state&&a.resume&&a.resume();var b=a.createBuffer(1,220,22050),d=a.createBufferSource();d.buffer=b;d.connect(a.destination);
d.start(0);"running"===a.state&&this._DetachUnblockEvents()}}GetAudioContext(){return this._audioContext}GetAudioCurrentTime(){return this._audioContext.currentTime}GetDestinationNode(){return this._destinationNode}GetDestinationForTag(a){return(a=this._effects.get(a.toLowerCase()))?a[0].GetInputNode():this.GetDestinationNode()}AddEffectForTag(a,b){a=a.toLowerCase();let d=this._effects.get(a);d||(d=[],this._effects.set(a,d));b._SetIndex(d.length);b._SetTag(a);d.push(b);this._ReconnectEffects(a)}_ReconnectEffects(a){let b=
this.GetDestinationNode();const d=this._effects.get(a);if(d&&d.length){b=d[0].GetInputNode();for(let f=0,m=d.length;f<m;++f){const n=d[f];f+1===m?n.ConnectTo(this.GetDestinationNode()):n.ConnectTo(d[f+1].GetInputNode())}}for(const f of this.audioInstancesByTag(a))f.Reconnect(b);this._microphoneSource&&this._microphoneTag===a&&(this._microphoneSource.disconnect(),this._microphoneSource.connect(b))}GetMasterVolume(){return this._masterVolume}IsSilent(){return this._isSilent}GetTimeScaleMode(){return this._timeScaleMode}GetTimeScale(){return this._timeScale}GetGameTime(){return this._gameTime}IsPlayMusicAsSound(){return this._playMusicAsSound}SupportsWebMOpus(){return this._supportsWebMOpus}_SetHasAnySoftwareDecodedMusic(){this._hasAnySoftwareDecodedMusic=
!0}GetPanningModel(){return this._panningModel}GetDistanceModel(){return this._distanceModel}GetReferenceDistance(){return this._refDistance}GetMaxDistance(){return this._maxDistance}GetRolloffFactor(){return this._rolloffFactor}DecodeAudioData(a,b){return b?this._iRuntime._WasmDecodeWebMOpus(a).then(d=>{const f=this._audioContext.createBuffer(1,d.length,48E3);f.getChannelData(0).set(d);return f}):new Promise((d,f)=>{this._audioContext.decodeAudioData(a,d,f)})}TryPlayMedia(a){this._iRuntime.TryPlayMedia(a)}RemovePendingPlay(a){this._iRuntime.RemovePendingPlay(a)}ReleaseInstancesForBuffer(a){let b=
0;for(let d=0,f=this._audioInstances.length;d<f;++d){const m=this._audioInstances[d];this._audioInstances[b]=m;m.GetBuffer()===a?m.Release():++b}this._audioInstances.length=b}ReleaseAllMusicBuffers(){let a=0;for(let b=0,d=this._audioBuffers.length;b<d;++b){const f=this._audioBuffers[b];this._audioBuffers[a]=f;f.IsMusic()?f.Release():++a}this._audioBuffers.length=a}*audioInstancesByTag(a){if(a)for(const b of this._audioInstances)self.AudioDOMHandler.EqualsNoCase(b.GetTag(),a)&&(yield b);else this._lastAudioInstance&&
!this._lastAudioInstance.HasEnded()&&(yield this._lastAudioInstance)}async _GetAudioBuffer(a,b,d,f,m){for(const n of this._audioBuffers)if(n.GetUrl()===b)return await n.Load(),n;if(m)return null;f&&(this._playMusicAsSound||this._hasAnySoftwareDecodedMusic)&&this.ReleaseAllMusicBuffers();a=self.C3AudioBuffer.Create(this,a,b,d,f);this._audioBuffers.push(a);await a.Load();return a}async _GetAudioInstance(a,b,d,f,m){for(const n of this._audioInstances)if(n.GetUrl()===b&&(n.CanBeRecycled()||m))return n.SetTag(f),
n;a=(await this._GetAudioBuffer(a,b,d,m)).CreateInstance(f);this._audioInstances.push(a);return a}_AddPendingTag(a){let b=this._pendingTags.get(a);if(!b){let d=null;b={pendingCount:0,promise:new Promise(f=>d=f),resolve:d};this._pendingTags.set(a,b)}b.pendingCount++}_RemovePendingTag(a){const b=this._pendingTags.get(a);if(!b)throw Error("expected pending tag");b.pendingCount--;0===b.pendingCount&&(b.resolve(),this._pendingTags.delete(a))}TagReady(a){a||(a=this._lastPlayedTag);return(a=this._pendingTags.get(a))?
a.promise:Promise.resolve()}_MaybeStartTicking(){if(0<this._analysers.size)this._StartTicking();else for(const a of this._audioInstances)if(a.IsActive()){this._StartTicking();break}}Tick(){for(var a of this._analysers)a.Tick();a=this.GetAudioCurrentTime();for(var b of this._audioInstances)b.Tick(a);b=this._audioInstances.filter(d=>d.IsActive()).map(d=>d.GetState());this.PostToRuntime("state",{tickCount:this._lastTickCount,audioInstances:b,analysers:[...this._analysers].map(d=>d.GetData())});0===b.length&&
0===this._analysers.size&&this._StopTicking()}PostTrigger(a,b,d){this.PostToRuntime("trigger",{type:a,tag:b,aiid:d})}async _Play(a){const b=a.originalUrl,d=a.url,f=a.type,m=a.isMusic,n=a.tag,r=a.isLooping,u=a.vol,z=a.pos,w=a.panning;let x=a.off;0<x&&!a.trueClock&&(this._audioContext.getOutputTimestamp?(a=this._audioContext.getOutputTimestamp(),x=x-a.performanceTime/1E3+a.contextTime):x=x-performance.now()/1E3+this._audioContext.currentTime);this._lastPlayedTag=n;this._AddPendingTag(n);try{this._lastAudioInstance=
await this._GetAudioInstance(b,d,f,n,m),w?(this._lastAudioInstance.SetPannerEnabled(!0),this._lastAudioInstance.SetPan(w.x,w.y,w.angle,w.innerAngle,w.outerAngle,w.outerGain),w.hasOwnProperty("uid")&&this._lastAudioInstance.SetUID(w.uid)):this._lastAudioInstance.SetPannerEnabled(!1),this._lastAudioInstance.Play(r,u,z,x)}catch(A){console.error("[Construct 3] Audio: error starting playback: ",A);return}finally{this._RemovePendingTag(n)}this._StartTicking()}_Stop(a){a=a.tag;for(const b of this.audioInstancesByTag(a))b.Stop()}_StopAll(){for(const a of this._audioInstances)a.Stop()}_SetPaused(a){const b=
a.tag;a=a.paused;for(const d of this.audioInstancesByTag(b))a?d.Pause():d.Resume();this._MaybeStartTicking()}_SetVolume(a){const b=a.tag;a=a.vol;for(const d of this.audioInstancesByTag(b))d.SetVolume(a)}async _FadeVolume(a){const b=a.tag,d=a.vol,f=a.duration;a=a.stopOnEnd;await this.TagReady(b);for(const m of this.audioInstancesByTag(b))m.FadeVolume(d,f,a);this._MaybeStartTicking()}_SetMasterVolume(a){this._masterVolume=a.vol;for(const b of this._audioInstances)b._UpdateVolume()}_SetMuted(a){const b=
a.tag;a=a.isMuted;for(const d of this.audioInstancesByTag(b))d.SetMuted(a)}_SetSilent(a){this._isSilent=a.isSilent;this._iRuntime.SetSilent(this._isSilent);for(const b of this._audioInstances)b._UpdateMuted()}_SetLooping(a){const b=a.tag;a=a.isLooping;for(const d of this.audioInstancesByTag(b))d.SetLooping(a)}async _SetPlaybackRate(a){const b=a.tag;a=a.rate;await this.TagReady(b);for(const d of this.audioInstancesByTag(b))d.SetPlaybackRate(a)}async _Seek(a){const b=a.tag;a=a.pos;await this.TagReady(b);
for(const d of this.audioInstancesByTag(b))d.Seek(a)}async _Preload(a){const b=a.originalUrl,d=a.url,f=a.type;a=a.isMusic;try{await this._GetAudioInstance(b,d,f,"",a)}catch(m){console.error("[Construct 3] Audio: error preloading: ",m)}}async _Unload(a){if(a=await this._GetAudioBuffer("",a.url,a.type,a.isMusic,!0))a.Release(),a=this._audioBuffers.indexOf(a),-1!==a&&this._audioBuffers.splice(a,1)}_UnloadAll(){for(const a of this._audioBuffers)a.Release();this._audioBuffers.length=0}_SetSuspended(a){a=
a.isSuspended;!a&&this._audioContext.resume&&this._audioContext.resume();for(const b of this._audioInstances)b.SetSuspended(a);a&&this._audioContext.suspend&&this._audioContext.suspend()}_OnTick(a){this._timeScale=a.timeScale;this._gameTime=a.gameTime;this._lastTickCount=a.tickCount;if(0!==this._timeScaleMode)for(var b of this._audioInstances)b._UpdatePlaybackRate();(b=a.listenerPos)&&this._audioContext.listener.setPosition(b[0],b[1],b[2]);for(const d of a.instPans){a=d.uid;for(const f of this._audioInstances)f.GetUID()===
a&&f.SetPanXYA(d.x,d.y,d.angle)}}async _AddEffect(a){var b=a.type;const d=a.tag;var f=a.params;if("filter"===b)f=new self.C3AudioFilterFX(this,...f);else if("delay"===b)f=new self.C3AudioDelayFX(this,...f);else if("convolution"===b){b=null;try{b=await this._GetAudioBuffer(a.bufferOriginalUrl,a.bufferUrl,a.bufferType,!1)}catch(m){console.log("[Construct 3] Audio: error loading convolution: ",m);return}f=new self.C3AudioConvolveFX(this,b.GetAudioBuffer(),...f);f._SetBufferInfo(a.bufferOriginalUrl,a.bufferUrl,
a.bufferType)}else if("flanger"===b)f=new self.C3AudioFlangerFX(this,...f);else if("phaser"===b)f=new self.C3AudioPhaserFX(this,...f);else if("gain"===b)f=new self.C3AudioGainFX(this,...f);else if("tremolo"===b)f=new self.C3AudioTremoloFX(this,...f);else if("ringmod"===b)f=new self.C3AudioRingModFX(this,...f);else if("distortion"===b)f=new self.C3AudioDistortionFX(this,...f);else if("compressor"===b)f=new self.C3AudioCompressorFX(this,...f);else if("analyser"===b)f=new self.C3AudioAnalyserFX(this,
...f);else throw Error("invalid effect type");this.AddEffectForTag(d,f);this._PostUpdatedFxState()}_SetEffectParam(a){const b=a.index,d=a.param,f=a.value,m=a.ramp,n=a.time;a=this._effects.get(a.tag);!a||0>b||b>=a.length||(a[b].SetParam(d,f,m,n),this._PostUpdatedFxState())}_RemoveEffects(a){a=a.tag.toLowerCase();const b=this._effects.get(a);if(b&&b.length){for(const d of b)d.Release();this._effects.delete(a);this._ReconnectEffects(a)}}_AddAnalyser(a){this._analysers.add(a);this._MaybeStartTicking()}_RemoveAnalyser(a){this._analysers.delete(a)}_PostUpdatedFxState(){this._isPendingPostFxState||
(this._isPendingPostFxState=!0,Promise.resolve().then(()=>this._DoPostUpdatedFxState()))}_DoPostUpdatedFxState(){const a={};for(const [b,d]of this._effects)a[b]=d.map(f=>f.GetState());this.PostToRuntime("fxstate",{fxstate:a});this._isPendingPostFxState=!1}async _OnLoadState(a){const b=a.saveLoadMode;if(3!==b)for(var d of this._audioInstances)d.IsMusic()&&1===b||(d.IsMusic()||2!==b)&&d.Stop();for(const f of this._effects.values())for(const m of f)m.Release();this._effects.clear();this._timeScale=a.timeScale;
this._gameTime=a.gameTime;d=a.listenerPos;this._audioContext.listener.setPosition(d[0],d[1],d[2]);this._isSilent=a.isSilent;this._iRuntime.SetSilent(this._isSilent);this._masterVolume=a.masterVolume;d=[];for(const f of Object.values(a.effects))d.push(Promise.all(f.map(m=>this._AddEffect(m))));await Promise.all(d);await Promise.all(a.playing.map(f=>this._LoadAudioInstance(f,b)));this._MaybeStartTicking()}async _LoadAudioInstance(a,b){if(3!==b){var d=a.bufferOriginalUrl,f=a.bufferUrl,m=a.bufferType,
n=a.isMusic,r=a.tag,u=a.isLooping,z=a.volume,w=a.playbackTime;if(!n||1!==b)if(n||2!==b){b=null;try{b=await this._GetAudioInstance(d,f,m,r,n)}catch(x){console.error("[Construct 3] Audio: error loading audio state: ",x);return}b.LoadPanState(a.pan);b.Play(u,z,w,0);a.isPlaying||b.Pause();b._LoadAdditionalState(a)}}}_OnMicrophoneStream(a,b){this._microphoneSource&&this._microphoneSource.disconnect();this._microphoneTag=b.toLowerCase();this._microphoneSource=this._audioContext.createMediaStreamSource(a);
this._microphoneSource.connect(this.GetDestinationForTag(this._microphoneTag))}_OnGetOutputStream(){this._destMediaStreamNode||(this._destMediaStreamNode=this._audioContext.createMediaStreamDestination(),this._destinationNode.connect(this._destMediaStreamNode));return this._destMediaStreamNode.stream}static EqualsNoCase(a,b){return a.length!==b.length?!1:a===b?!0:a.toLowerCase()===b.toLowerCase()}static ToDegrees(a){return a*c}static DbToLinearNoCap(a){return Math.pow(10,a/20)}static DbToLinear(a){return Math.max(Math.min(self.AudioDOMHandler.DbToLinearNoCap(a),
1),0)}static LinearToDbNoCap(a){return Math.log(a)/Math.log(10)*20}static LinearToDb(a){return self.AudioDOMHandler.LinearToDbNoCap(Math.max(Math.min(a,1),0))}static e4(a,b){return 1-Math.exp(-b*a)}};self.RuntimeInterface.AddDOMHandlerClass(self.AudioDOMHandler)}"use strict";
self.C3AudioBuffer=class{constructor(c,a,b,d,f){this._audioDomHandler=c;this._originalUrl=a;this._url=b;this._type=d;this._isMusic=f;this._api="";this._loadState="not-loaded";this._loadPromise=null}Release(){this._loadState="not-loaded";this._loadPromise=this._audioDomHandler=null}static Create(c,a,b,d,f){const m="audio/webm; codecs=opus"===d&&!c.SupportsWebMOpus();f&&m&&c._SetHasAnySoftwareDecodedMusic();return!f||c.IsPlayMusicAsSound()||m?new self.C3WebAudioBuffer(c,a,b,d,f,m):new self.C3Html5AudioBuffer(c,
a,b,d,f)}CreateInstance(c){return"html5"===this._api?new self.C3Html5AudioInstance(this._audioDomHandler,this,c):new self.C3WebAudioInstance(this._audioDomHandler,this,c)}_Load(){}Load(){this._loadPromise||(this._loadPromise=this._Load());return this._loadPromise}IsLoaded(){}IsLoadedAndDecoded(){}HasFailedToLoad(){return"failed"===this._loadState}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}GetApi(){return this._api}GetOriginalUrl(){return this._originalUrl}GetUrl(){return this._url}GetContentType(){return this._type}IsMusic(){return this._isMusic}GetDuration(){}};
"use strict";
self.C3Html5AudioBuffer=class extends self.C3AudioBuffer{constructor(c,a,b,d,f){super(c,a,b,d,f);this._api="html5";this._audioElem=new Audio;this._audioElem.crossOrigin="anonymous";this._audioElem.autoplay=!1;this._audioElem.preload="auto";this._loadReject=this._loadResolve=null;this._reachedCanPlayThrough=!1;this._audioElem.addEventListener("canplaythrough",()=>this._reachedCanPlayThrough=!0);this._outNode=this.GetAudioContext().createGain();this._mediaSourceNode=null;this._audioElem.addEventListener("canplay",()=>
{this._loadResolve&&(this._loadState="loaded",this._loadResolve(),this._loadReject=this._loadResolve=null);!this._mediaSourceNode&&this._audioElem&&(this._mediaSourceNode=this.GetAudioContext().createMediaElementSource(this._audioElem),this._mediaSourceNode.connect(this._outNode))});this.onended=null;this._audioElem.addEventListener("ended",()=>{if(this.onended)this.onended()});this._audioElem.addEventListener("error",m=>this._OnError(m))}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this);
this._outNode.disconnect();this._outNode=null;this._mediaSourceNode.disconnect();this._mediaSourceNode=null;this._audioElem&&!this._audioElem.paused&&this._audioElem.pause();this._audioElem=this.onended=null;super.Release()}_Load(){this._loadState="loading";return new Promise((c,a)=>{this._loadResolve=c;this._loadReject=a;this._audioElem.src=this._url})}_OnError(c){console.error(`[Construct 3] Audio '${this._url}' error: `,c);this._loadReject&&(this._loadState="failed",this._loadReject(c),this._loadReject=
this._loadResolve=null)}IsLoaded(){const c=4<=this._audioElem.readyState;c&&(this._reachedCanPlayThrough=!0);return c||this._reachedCanPlayThrough}IsLoadedAndDecoded(){return this.IsLoaded()}GetAudioElement(){return this._audioElem}GetOutputNode(){return this._outNode}GetDuration(){return this._audioElem.duration}};"use strict";
self.C3WebAudioBuffer=class extends self.C3AudioBuffer{constructor(c,a,b,d,f,m){super(c,a,b,d,f);this._api="webaudio";this._audioBuffer=this._audioData=null;this._needsSoftwareDecode=!!m}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this);this._audioBuffer=this._audioData=null;super.Release()}async _Fetch(){if(this._audioData)return this._audioData;var c=this._audioDomHandler.GetRuntimeInterface();if("cordova"===c.GetExportType()&&c.IsRelativeURL(this._url)&&"file:"===location.protocol)this._audioData=
await c.CordovaFetchLocalFileAsArrayBuffer(this._url);else{c=await fetch(this._url);if(!c.ok)throw Error(`error fetching audio data: ${c.status} ${c.statusText}`);this._audioData=await c.arrayBuffer()}}async _Decode(){if(this._audioBuffer)return this._audioBuffer;this._audioBuffer=await this._audioDomHandler.DecodeAudioData(this._audioData,this._needsSoftwareDecode);this._audioData=null}async _Load(){try{this._loadState="loading",await this._Fetch(),await this._Decode(),this._loadState="loaded"}catch(c){this._loadState=
"failed",console.error(`[Construct 3] Failed to load audio '${this._url}': `,c)}}IsLoaded(){return!(!this._audioData&&!this._audioBuffer)}IsLoadedAndDecoded(){return!!this._audioBuffer}GetAudioBuffer(){return this._audioBuffer}GetDuration(){return this._audioBuffer?this._audioBuffer.duration:0}};"use strict";
{let c=0;self.C3AudioInstance=class{constructor(a,b,d){this._audioDomHandler=a;this._buffer=b;this._tag=d;this._aiId=c++;this._gainNode=this.GetAudioContext().createGain();this._gainNode.connect(this.GetDestinationNode());this._pannerNode=null;this._isPannerEnabled=!1;this._isStopped=!0;this._isLooping=this._resumeMe=this._isPaused=!1;this._volume=1;this._isMuted=!1;this._playbackRate=1;a=this._audioDomHandler.GetTimeScaleMode();this._isTimescaled=1===a&&!this.IsMusic()||2===a;this._fadeEndTime=this._instUid=
-1;this._stopOnFadeEnd=!1}Release(){this._buffer=this._audioDomHandler=null;this._pannerNode&&(this._pannerNode.disconnect(),this._pannerNode=null);this._gainNode.disconnect();this._gainNode=null}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}GetDestinationNode(){return this._audioDomHandler.GetDestinationForTag(this._tag)}GetMasterVolume(){return this._audioDomHandler.GetMasterVolume()}GetCurrentTime(){return this._isTimescaled?this._audioDomHandler.GetGameTime():performance.now()/
1E3}GetOriginalUrl(){return this._buffer.GetOriginalUrl()}GetUrl(){return this._buffer.GetUrl()}GetContentType(){return this._buffer.GetContentType()}GetBuffer(){return this._buffer}IsMusic(){return this._buffer.IsMusic()}SetTag(a){this._tag=a}GetTag(){return this._tag}GetAiId(){return this._aiId}HasEnded(){}CanBeRecycled(){}IsPlaying(){return!this._isStopped&&!this._isPaused&&!this.HasEnded()}IsActive(){return!this._isStopped&&!this.HasEnded()}GetPlaybackTime(a){}GetDuration(a){let b=this._buffer.GetDuration();
a&&(b/=this._playbackRate||.001);return b}Play(a,b,d,f){}Stop(){}Pause(){}IsPaused(){return this._isPaused}Resume(){}SetVolume(a){this._volume=a;this._gainNode.gain.cancelScheduledValues(0);this._fadeEndTime=-1;this._gainNode.gain.value=this.GetOverallVolume()}FadeVolume(a,b,d){if(!this.IsMuted()){a*=this.GetMasterVolume();var f=this._gainNode.gain;f.cancelScheduledValues(0);var m=this._audioDomHandler.GetAudioCurrentTime();b=m+b;f.setValueAtTime(f.value,m);f.linearRampToValueAtTime(a,b);this._volume=
a;this._fadeEndTime=b;this._stopOnFadeEnd=d}}_UpdateVolume(){this.SetVolume(this._volume)}Tick(a){-1!==this._fadeEndTime&&a>=this._fadeEndTime&&(this._fadeEndTime=-1,this._stopOnFadeEnd&&this.Stop(),this._audioDomHandler.PostTrigger("fade-ended",this._tag,this._aiId))}GetOverallVolume(){const a=this._volume*this.GetMasterVolume();return isFinite(a)?a:0}SetMuted(a){a=!!a;this._isMuted!==a&&(this._isMuted=a,this._UpdateMuted())}IsMuted(){return this._isMuted}IsSilent(){return this._audioDomHandler.IsSilent()}_UpdateMuted(){}SetLooping(a){}IsLooping(){return this._isLooping}SetPlaybackRate(a){this._playbackRate!==
a&&(this._playbackRate=a,this._UpdatePlaybackRate())}_UpdatePlaybackRate(){}GetPlaybackRate(){return this._playbackRate}Seek(a){}SetSuspended(a){}SetPannerEnabled(a){a=!!a;this._isPannerEnabled!==a&&((this._isPannerEnabled=a)?(this._pannerNode||(this._pannerNode=this.GetAudioContext().createPanner(),this._pannerNode.panningModel=this._audioDomHandler.GetPanningModel(),this._pannerNode.distanceModel=this._audioDomHandler.GetDistanceModel(),this._pannerNode.refDistance=this._audioDomHandler.GetReferenceDistance(),
this._pannerNode.maxDistance=this._audioDomHandler.GetMaxDistance(),this._pannerNode.rolloffFactor=this._audioDomHandler.GetRolloffFactor()),this._gainNode.disconnect(),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(this.GetDestinationNode())):(this._pannerNode.disconnect(),this._gainNode.disconnect(),this._gainNode.connect(this.GetDestinationNode())))}SetPan(a,b,d,f,m,n){this._isPannerEnabled&&(this.SetPanXYA(a,b,d),a=self.AudioDOMHandler.ToDegrees,this._pannerNode.coneInnerAngle=
a(f),this._pannerNode.coneOuterAngle=a(m),this._pannerNode.coneOuterGain=n)}SetPanXYA(a,b,d){this._isPannerEnabled&&(this._pannerNode.setPosition(a,b,0),this._pannerNode.setOrientation(Math.cos(d),Math.sin(d),0))}SetUID(a){this._instUid=a}GetUID(){return this._instUid}GetResumePosition(){}Reconnect(a){const b=this._pannerNode||this._gainNode;b.disconnect();b.connect(a)}GetState(){return{aiid:this.GetAiId(),tag:this._tag,duration:this.GetDuration(),volume:this._volume,isPlaying:this.IsPlaying(),playbackTime:this.GetPlaybackTime(),
playbackRate:this.GetPlaybackRate(),uid:this._instUid,bufferOriginalUrl:this.GetOriginalUrl(),bufferUrl:"",bufferType:this.GetContentType(),isMusic:this.IsMusic(),isLooping:this.IsLooping(),isMuted:this.IsMuted(),resumePosition:this.GetResumePosition(),pan:this.GetPanState()}}_LoadAdditionalState(a){this.SetPlaybackRate(a.playbackRate);this.SetMuted(a.isMuted)}GetPanState(){if(!this._pannerNode)return null;const a=this._pannerNode;return{pos:[a.positionX.value,a.positionY.value,a.positionZ.value],
orient:[a.orientationX.value,a.orientationY.value,a.orientationZ.value],cia:a.coneInnerAngle,coa:a.coneOuterAngle,cog:a.coneOuterGain,uid:this._instUid}}LoadPanState(a){a?(this.SetPannerEnabled(!0),a=this._pannerNode,a.setPosition(...a.pos),a.setOrientation(...a.orient),a.coneInnerAngle=a.cia,a.coneOuterAngle=a.coa,a.coneOuterGain=a.cog,this._instUid=a.uid):this.SetPannerEnabled(!1)}}}"use strict";
self.C3Html5AudioInstance=class extends self.C3AudioInstance{constructor(c,a,b){super(c,a,b);this._buffer.GetOutputNode().connect(this._gainNode);this._buffer.onended=()=>this._OnEnded()}Release(){this.Stop();this._buffer.GetOutputNode().disconnect();super.Release()}GetAudioElement(){return this._buffer.GetAudioElement()}_OnEnded(){this._isStopped=!0;this._instUid=-1;this._audioDomHandler.PostTrigger("ended",this._tag,this._aiId)}HasEnded(){return this.GetAudioElement().ended}CanBeRecycled(){return this._isStopped?
!0:this.HasEnded()}GetPlaybackTime(c){let a=this.GetAudioElement().currentTime;c&&(a*=this._playbackRate);this._isLooping||(a=Math.min(a,this.GetDuration()));return a}Play(c,a,b,d){d=this.GetAudioElement();1!==d.playbackRate&&(d.playbackRate=1);d.loop!==c&&(d.loop=c);this.SetVolume(a);d.muted&&(d.muted=!1);if(d.currentTime!==b)try{d.currentTime=b}catch(f){console.warn(`[Construct 3] Exception seeking audio '${this._buffer.GetUrl()}' to position '${b}': `,f)}this._audioDomHandler.TryPlayMedia(d);this._isPaused=
this._isStopped=!1;this._isLooping=c;this._playbackRate=1}Stop(){const c=this.GetAudioElement();c.paused||c.pause();this._audioDomHandler.RemovePendingPlay(c);this._isStopped=!0;this._isPaused=!1;this._instUid=-1}Pause(){if(!(this._isPaused||this._isStopped||this.HasEnded())){var c=this.GetAudioElement();c.paused||c.pause();this._audioDomHandler.RemovePendingPlay(c);this._isPaused=!0}}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),
this._isPaused=!1)}_UpdateMuted(){this.GetAudioElement().muted=this._isMuted||this.IsSilent()}SetLooping(c){c=!!c;this._isLooping!==c&&(this._isLooping=c,this.GetAudioElement().loop=c)}_UpdatePlaybackRate(){let c=this._playbackRate;this._isTimescaled&&(c*=this._audioDomHandler.GetTimeScale());try{this.GetAudioElement().playbackRate=c}catch(a){console.warn(`[Construct 3] Unable to set playback rate '${c}':`,a)}}Seek(c){if(!this._isStopped&&!this.HasEnded())try{this.GetAudioElement().currentTime=c}catch(a){console.warn(`[Construct 3] Error seeking audio to '${c}': `,
a)}}GetResumePosition(){return this.GetPlaybackTime()}SetSuspended(c){c?this.IsPlaying()?(this.GetAudioElement().pause(),this._resumeMe=!0):this._resumeMe=!1:this._resumeMe&&(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._resumeMe=!1)}};"use strict";
self.C3WebAudioInstance=class extends self.C3AudioInstance{constructor(c,a,b){super(c,a,b);this._bufferSource=null;this._onended_handler=d=>this._OnEnded(d);this._hasPlaybackEnded=!0;this._activeSource=null;this._resumePosition=this._startTime=0;this._muteVol=1}Release(){this.Stop();this._ReleaseBufferSource();this._onended_handler=null;super.Release()}_ReleaseBufferSource(){this._bufferSource&&this._bufferSource.disconnect();this._activeSource=this._bufferSource=null}_OnEnded(c){this._isPaused||
this._resumeMe||c.target!==this._activeSource||(this._isStopped=this._hasPlaybackEnded=!0,this._instUid=-1,this._ReleaseBufferSource(),this._audioDomHandler.PostTrigger("ended",this._tag,this._aiId))}HasEnded(){return!this._isStopped&&this._bufferSource&&this._bufferSource.loop||this._isPaused?!1:this._hasPlaybackEnded}CanBeRecycled(){return!this._bufferSource||this._isStopped?!0:this.HasEnded()}GetPlaybackTime(c){let a;a=this._isPaused?this._resumePosition:this.GetCurrentTime()-this._startTime;c&&
(a*=this._playbackRate);this._isLooping||(a=Math.min(a,this.GetDuration()));return a}Play(c,a,b,d){this._muteVol=1;this.SetVolume(a);this._ReleaseBufferSource();this._bufferSource=this.GetAudioContext().createBufferSource();this._bufferSource.buffer=this._buffer.GetAudioBuffer();this._bufferSource.connect(this._gainNode);this._activeSource=this._bufferSource;this._bufferSource.onended=this._onended_handler;this._bufferSource.loop=c;this._bufferSource.start(d,b);this._isPaused=this._isStopped=this._hasPlaybackEnded=
!1;this._isLooping=c;this._playbackRate=1;this._startTime=this.GetCurrentTime()-b}Stop(){if(this._bufferSource)try{this._bufferSource.stop(0)}catch(c){}this._isStopped=!0;this._isPaused=!1;this._instUid=-1}Pause(){this._isPaused||this._isStopped||this.HasEnded()||(this._resumePosition=this.GetPlaybackTime(!0),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._isPaused=!0,this._bufferSource.stop(0))}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._ReleaseBufferSource(),
this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._startTime=this.GetCurrentTime()-this._resumePosition/(this._playbackRate||.001),this._bufferSource.start(0,this._resumePosition),this._isPaused=!1)}GetOverallVolume(){return super.GetOverallVolume()*
this._muteVol}_UpdateMuted(){this._muteVol=this._isMuted||this.IsSilent()?0:1;this._UpdateVolume()}SetLooping(c){c=!!c;this._isLooping!==c&&(this._isLooping=c,this._bufferSource&&(this._bufferSource.loop=c))}_UpdatePlaybackRate(){let c=this._playbackRate;this._isTimescaled&&(c*=this._audioDomHandler.GetTimeScale());this._bufferSource&&(this._bufferSource.playbackRate.value=c)}Seek(c){this._isStopped||this.HasEnded()||(this._isPaused?this._resumePosition=c:(this.Pause(),this._resumePosition=c,this.Resume()))}GetResumePosition(){return this._resumePosition}SetSuspended(c){c?
this.IsPlaying()?(this._resumeMe=!0,this._resumePosition=this.GetPlaybackTime(!0),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._bufferSource.stop(0)):this._resumeMe=!1:this._resumeMe&&(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=
this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._startTime=this.GetCurrentTime()-this._resumePosition/(this._playbackRate||.001),this._bufferSource.start(0,this._resumePosition),this._resumeMe=!1)}_LoadAdditionalState(c){super._LoadAdditionalState(c);this._resumePosition=c.resumePosition}};"use strict";
{class c{constructor(a){this._audioDomHandler=a;this._audioContext=a.GetAudioContext();this._index=-1;this._type=this._tag="";this._params=null}Release(){this._audioContext=null}_SetIndex(a){this._index=a}GetIndex(){return this._index}_SetTag(a){this._tag=a}GetTag(){return this._tag}CreateGain(){return this._audioContext.createGain()}GetInputNode(){}ConnectTo(a){}SetAudioParam(a,b,d,f){a.cancelScheduledValues(0);if(0===f)a.value=b;else{var m=this._audioContext.currentTime;f+=m;switch(d){case 0:a.setValueAtTime(b,
f);break;case 1:a.setValueAtTime(a.value,m);a.linearRampToValueAtTime(b,f);break;case 2:a.setValueAtTime(a.value,m),a.exponentialRampToValueAtTime(b,f)}}}GetState(){return{type:this._type,tag:this._tag,params:this._params}}}self.C3AudioFilterFX=class extends c{constructor(a,b,d,f,m,n,r){super(a);this._type="filter";this._params=[b,d,f,m,n,r];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=r;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-r;this._filterNode=
this._audioContext.createBiquadFilter();this._filterNode.type=b;this._filterNode.frequency.value=d;this._filterNode.detune.value=f;this._filterNode.Q.value=m;this._filterNode.gain.vlaue=n;this._inputNode.connect(this._filterNode);this._inputNode.connect(this._dryNode);this._filterNode.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._filterNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);
this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,d,f){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[5]=b;this.SetAudioParam(this._wetNode.gain,b,d,f);this.SetAudioParam(this._dryNode.gain,1-b,d,f);break;case 1:this._params[1]=b;this.SetAudioParam(this._filterNode.frequency,b,d,f);break;case 2:this._params[2]=b;this.SetAudioParam(this._filterNode.detune,b,d,f);break;case 3:this._params[3]=b;this.SetAudioParam(this._filterNode.Q,
b,d,f);break;case 4:this._params[4]=b,this.SetAudioParam(this._filterNode.gain,b,d,f)}}};self.C3AudioDelayFX=class extends c{constructor(a,b,d,f){super(a);this._type="delay";this._params=[b,d,f];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=f;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-f;this._mainNode=this.CreateGain();this._delayNode=this._audioContext.createDelay(b);this._delayNode.delayTime.value=b;this._delayGainNode=this.CreateGain();
this._delayGainNode.gain.value=d;this._inputNode.connect(this._mainNode);this._inputNode.connect(this._dryNode);this._mainNode.connect(this._wetNode);this._mainNode.connect(this._delayNode);this._delayNode.connect(this._delayGainNode);this._delayGainNode.connect(this._mainNode)}Release(){this._inputNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();this._mainNode.disconnect();this._delayNode.disconnect();this._delayGainNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();
this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,d,f){const m=self.AudioDOMHandler.DbToLinear;switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[2]=b;this.SetAudioParam(this._wetNode.gain,b,d,f);this.SetAudioParam(this._dryNode.gain,1-b,d,f);break;case 4:this._params[1]=m(b);this.SetAudioParam(this._delayGainNode.gain,m(b),d,f);break;case 5:this._params[0]=b,this.SetAudioParam(this._delayNode.delayTime,b,d,f)}}};
self.C3AudioConvolveFX=class extends c{constructor(a,b,d,f){super(a);this._type="convolution";this._params=[d,f];this._bufferType=this._bufferUrl=this._bufferOriginalUrl="";this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=f;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-f;this._convolveNode=this._audioContext.createConvolver();this._convolveNode.normalize=d;this._convolveNode.buffer=b;this._inputNode.connect(this._convolveNode);this._inputNode.connect(this._dryNode);
this._convolveNode.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._convolveNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,d,f){switch(a){case 0:b=Math.max(Math.min(b/100,1),0),this._params[1]=b,this.SetAudioParam(this._wetNode.gain,b,d,f),this.SetAudioParam(this._dryNode.gain,
1-b,d,f)}}_SetBufferInfo(a,b,d){this._bufferOriginalUrl=a;this._bufferUrl=b;this._bufferType=d}GetState(){const a=super.GetState();a.bufferOriginalUrl=this._bufferOriginalUrl;a.bufferUrl="";a.bufferType=this._bufferType;return a}};self.C3AudioFlangerFX=class extends c{constructor(a,b,d,f,m,n){super(a);this._type="flanger";this._params=[b,d,f,m,n];this._inputNode=this.CreateGain();this._dryNode=this.CreateGain();this._dryNode.gain.value=1-n/2;this._wetNode=this.CreateGain();this._wetNode.gain.value=
n/2;this._feedbackNode=this.CreateGain();this._feedbackNode.gain.value=m;this._delayNode=this._audioContext.createDelay(b+d);this._delayNode.delayTime.value=b;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=f;this._oscGainNode=this.CreateGain();this._oscGainNode.gain.value=d;this._inputNode.connect(this._delayNode);this._inputNode.connect(this._dryNode);this._delayNode.connect(this._wetNode);this._delayNode.connect(this._feedbackNode);this._feedbackNode.connect(this._delayNode);
this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._delayNode.delayTime);this._oscNode.start(0)}Release(){this._oscNode.stop(0);this._inputNode.disconnect();this._delayNode.disconnect();this._oscNode.disconnect();this._oscGainNode.disconnect();this._dryNode.disconnect();this._wetNode.disconnect();this._feedbackNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,
b,d,f){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[4]=b;this.SetAudioParam(this._wetNode.gain,b/2,d,f);this.SetAudioParam(this._dryNode.gain,1-b/2,d,f);break;case 6:this._params[1]=b/1E3;this.SetAudioParam(this._oscGainNode.gain,b/1E3,d,f);break;case 7:this._params[2]=b;this.SetAudioParam(this._oscNode.frequency,b,d,f);break;case 8:this._params[3]=b/100,this.SetAudioParam(this._feedbackNode.gain,b/100,d,f)}}};self.C3AudioPhaserFX=class extends c{constructor(a,b,d,f,m,n,r){super(a);
this._type="phaser";this._params=[b,d,f,m,n,r];this._inputNode=this.CreateGain();this._dryNode=this.CreateGain();this._dryNode.gain.value=1-r/2;this._wetNode=this.CreateGain();this._wetNode.gain.value=r/2;this._filterNode=this._audioContext.createBiquadFilter();this._filterNode.type="allpass";this._filterNode.frequency.value=b;this._filterNode.detune.value=d;this._filterNode.Q.value=f;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=n;this._oscGainNode=this.CreateGain();
this._oscGainNode.gain.value=m;this._inputNode.connect(this._filterNode);this._inputNode.connect(this._dryNode);this._filterNode.connect(this._wetNode);this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._filterNode.frequency);this._oscNode.start(0)}Release(){this._oscNode.stop(0);this._inputNode.disconnect();this._filterNode.disconnect();this._oscNode.disconnect();this._oscGainNode.disconnect();this._dryNode.disconnect();this._wetNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();
this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,d,f){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[5]=b;this.SetAudioParam(this._wetNode.gain,b/2,d,f);this.SetAudioParam(this._dryNode.gain,1-b/2,d,f);break;case 1:this._params[0]=b;this.SetAudioParam(this._filterNode.frequency,b,d,f);break;case 2:this._params[1]=b;this.SetAudioParam(this._filterNode.detune,b,d,f);break;case 3:this._params[2]=b;this.SetAudioParam(this._filterNode.Q,
b,d,f);break;case 6:this._params[3]=b;this.SetAudioParam(this._oscGainNode.gain,b,d,f);break;case 7:this._params[4]=b,this.SetAudioParam(this._oscNode.frequency,b,d,f)}}};self.C3AudioGainFX=class extends c{constructor(a,b){super(a);this._type="gain";this._params=[b];this._node=this.CreateGain();this._node.gain.value=b}Release(){this._node.disconnect();super.Release()}ConnectTo(a){this._node.disconnect();this._node.connect(a)}GetInputNode(){return this._node}SetParam(a,b,d,f){const m=self.AudioDOMHandler.DbToLinear;
switch(a){case 4:this._params[0]=m(b),this.SetAudioParam(this._node.gain,m(b),d,f)}}};self.C3AudioTremoloFX=class extends c{constructor(a,b,d){super(a);this._type="tremolo";this._params=[b,d];this._node=this.CreateGain();this._node.gain.value=1-d/2;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=b;this._oscGainNode=this.CreateGain();this._oscGainNode.gain.value=d/2;this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._node.gain);this._oscNode.start(0)}Release(){this._oscNode.stop(0);
this._oscNode.disconnect();this._oscGainNode.disconnect();this._node.disconnect();super.Release()}ConnectTo(a){this._node.disconnect();this._node.connect(a)}GetInputNode(){return this._node}SetParam(a,b,d,f){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[1]=b;this.SetAudioParam(this._node.gain.value,1-b/2,d,f);this.SetAudioParam(this._oscGainNode.gain.value,b/2,d,f);break;case 7:this._params[0]=b,this.SetAudioParam(this._oscNode.frequency,b,d,f)}}};self.C3AudioRingModFX=class extends c{constructor(a,
b,d){super(a);this._type="ringmod";this._params=[b,d];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=d;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-d;this._ringNode=this.CreateGain();this._ringNode.gain.value=0;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=b;this._oscNode.connect(this._ringNode.gain);this._oscNode.start(0);this._inputNode.connect(this._ringNode);this._inputNode.connect(this._dryNode);this._ringNode.connect(this._wetNode)}Release(){this._oscNode.stop(0);
this._oscNode.disconnect();this._ringNode.disconnect();this._inputNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,d,f){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[1]=b;this.SetAudioParam(this._wetNode.gain,b,d,f);this.SetAudioParam(this._dryNode.gain,1-b,d,f);break;case 7:this._params[0]=
b,this.SetAudioParam(this._oscNode.frequency,b,d,f)}}};self.C3AudioDistortionFX=class extends c{constructor(a,b,d,f,m,n){super(a);this._type="distortion";this._params=[b,d,f,m,n];this._inputNode=this.CreateGain();this._preGain=this.CreateGain();this._postGain=this.CreateGain();this._SetDrive(f,m);this._wetNode=this.CreateGain();this._wetNode.gain.value=n;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-n;this._waveShaper=this._audioContext.createWaveShaper();this._curve=new Float32Array(65536);
this._GenerateColortouchCurve(b,d);this._waveShaper.curve=this._curve;this._inputNode.connect(this._preGain);this._inputNode.connect(this._dryNode);this._preGain.connect(this._waveShaper);this._waveShaper.connect(this._postGain);this._postGain.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._preGain.disconnect();this._waveShaper.disconnect();this._postGain.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}_SetDrive(a,b){.01>a&&(a=.01);this._preGain.gain.value=
a;this._postGain.gain.value=Math.pow(1/a,.6)*b}_GenerateColortouchCurve(a,b){for(let d=0;32768>d;++d){let f=d/32768;f=this._Shape(f,a,b);this._curve[32768+d]=f;this._curve[32768-d-1]=-f}}_Shape(a,b,d){d=1.05*d*b-b;const f=0>a?-1:1;a=0>a?-a:a;return(a<b?a:b+d*self.AudioDOMHandler.e4(a-b,1/d))*f}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,d,f){switch(a){case 0:b=Math.max(Math.min(b/
100,1),0),this._params[4]=b,this.SetAudioParam(this._wetNode.gain,b,d,f),this.SetAudioParam(this._dryNode.gain,1-b,d,f)}}};self.C3AudioCompressorFX=class extends c{constructor(a,b,d,f,m,n){super(a);this._type="compressor";this._params=[b,d,f,m,n];this._node=this._audioContext.createDynamicsCompressor();this._node.threshold.value=b;this._node.knee.value=d;this._node.ratio.value=f;this._node.attack.value=m;this._node.release.value=n}Release(){this._node.disconnect();super.Release()}ConnectTo(a){this._node.disconnect();
this._node.connect(a)}GetInputNode(){return this._node}SetParam(a,b,d,f){}};self.C3AudioAnalyserFX=class extends c{constructor(a,b,d){super(a);this._type="analyser";this._params=[b,d];this._node=this._audioContext.createAnalyser();this._node.fftSize=b;this._node.smoothingTimeConstant=d;this._freqBins=new Float32Array(this._node.frequencyBinCount);this._signal=new Uint8Array(b);this._rms=this._peak=0;this._audioDomHandler._AddAnalyser(this)}Release(){this._audioDomHandler._RemoveAnalyser(this);this._node.disconnect();
super.Release()}Tick(){this._node.getFloatFrequencyData(this._freqBins);this._node.getByteTimeDomainData(this._signal);const a=this._node.fftSize;let b=this._peak=0;for(var d=0;d<a;++d){let f=(this._signal[d]-128)/128;0>f&&(f=-f);this._peak<f&&(this._peak=f);b+=f*f}d=self.AudioDOMHandler.LinearToDb;this._peak=d(this._peak);this._rms=d(Math.sqrt(b/a))}ConnectTo(a){this._node.disconnect();this._node.connect(a)}GetInputNode(){return this._node}SetParam(a,b,d,f){}GetData(){return{tag:this.GetTag(),index:this.GetIndex(),
peak:this._peak,rms:this._rms,binCount:this._node.frequencyBinCount,freqBins:this._freqBins}}}}"use strict";
{function c(a){return a&&!a.paused&&!a.ended&&0<a.currentTime}self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(a){super(a,"video");this.SetAutoAttach(!1);this._supportsRvfc=this._isRuntimeInWorker=!1;this._numVideos=this._sequenceNumber=0;this._destroyedVideos=new WeakSet;this.AddRuntimeMessageHandler("init",b=>this._OnInit(b));this.AddDOMElementMessageHandler("play",b=>this._OnPlay(b));this.AddDOMElementMessageHandler("pause",b=>this._OnPause(b));this.AddDOMElementMessageHandler("set-source",
(b,d)=>this._OnSetSource(b,d));this.AddDOMElementMessageHandler("set-playback-time",(b,d)=>this._OnSetPlaybackTime(b,d));this.AddDOMElementMessageHandler("set-looping",(b,d)=>this._OnSetLooping(b,d));this.AddDOMElementMessageHandler("set-muted",(b,d)=>this._OnSetMuted(b,d));this.AddDOMElementMessageHandler("set-volume",(b,d)=>this._OnSetVolume(b,d));self.C3Video_GetElement=b=>this.GetElementById(b)}async _OnInit(a){this._isRuntimeInWorker=a.isInWorker;a=document.createElement("video");this._supportsRvfc=
!!a.requestVideoFrameCallback;return{"video/webm":!!a.canPlayType("video/webm"),"video/ogg":!!a.canPlayType("video/ogg"),"video/mp4":!!a.canPlayType("video/mp4")}}TryPlayMedia(a){this._iRuntime.TryPlayMedia(a);this._isRuntimeInWorker&&this._supportsRvfc&&-1===a.c3_rvfcId&&(a.c3_rvfcId=a.requestVideoFrameCallback(()=>this._OnVideoFrameCallback(a)))}RemovePendingPlay(a){this._iRuntime.RemovePendingPlay(a);this._isRuntimeInWorker&&this._supportsRvfc&&-1!==a.c3_rvfcId&&(a.cancelVideoFrameCallback(a.c3_rvfcId),
a.c3_rvfcId=-1)}async _OnVideoFrameCallback(a){if(!this._destroyedVideos.has(a)){a.c3_rvfcId=a.requestVideoFrameCallback(()=>this._OnVideoFrameCallback(a));try{const b=a.c3_sequenceNumber++,d=await createImageBitmap(a);b>a.c3_lastFrameSequence&&(a.c3_imageBitmap=d,a.c3_lastFrameSequence=b)}catch(b){}}}CreateElement(a,b){const d=document.createElement("video");d.crossOrigin="anonymous";d.playsInline=!0;d.c3_imageBitmap=null;d.c3_rvfcId=-1;d.c3_sequenceNumber=0;d.c3_lastFrameSequence=-1;d.addEventListener("canplay",
()=>this._SendPlaybackEvent(d,a,0));d.addEventListener("canplaythrough",()=>this._SendPlaybackEvent(d,a,1));d.addEventListener("ended",()=>this._SendPlaybackEvent(d,a,2));d.addEventListener("error",()=>this._SendPlaybackEvent(d,a,3));d.addEventListener("loadstart",()=>this._SendPlaybackEvent(d,a,4));d.addEventListener("playing",()=>this._SendPlaybackEvent(d,a,5));d.addEventListener("pause",()=>this._SendPlaybackEvent(d,a,6));d.addEventListener("stalled",()=>this._SendPlaybackEvent(d,a,7));const f=
b.autoplay;0===f?(d.autoplay=!1,d.preload="none"):1===f?(d.autoplay=!1,d.preload="auto"):d.autoplay=!0;b.src&&(d.src=b.src);2===f&&this.TryPlayMedia(d);this._numVideos++;this._StartTicking();return d}_SendPlaybackEvent(a,b,d){this._destroyedVideos.has(a)||this.PostToRuntimeElement("playback-event",b,{type:d})}UpdateState(a,b){}DestroyElement(a){this.RemovePendingPlay(a);c(a)&&a.pause();a.src="";this._numVideos=Math.max(this._numVideos-1,0);0===this._numVideos&&this._StopTicking();this._destroyedVideos.add(a)}_OnPlay(a){this.TryPlayMedia(a)}_OnPause(a){this.RemovePendingPlay(a);
a.pause()}_OnSetSource(a,b){a.src=b.src;a.load()}_OnSetPlaybackTime(a,b){try{a.currentTime=b.time}catch(d){console.error("[Video] Exception setting playback time: ",d)}}_OnSetLooping(a,b){a.loop=b.isLooping}_OnSetMuted(a,b){a.muted=b.isMuted}_OnSetVolume(a,b){a.volume=b.volume}Tick(){const a={},b={sequenceNumber:this._sequenceNumber++,videoData:a},d=[],f=[];for(const [m,n]of this._elementMap.entries()){const r={currentTime:n.currentTime,duration:n.duration,videoWidth:n.videoWidth,videoHeight:n.videoHeight};
if(this._isRuntimeInWorker)if(this._supportsRvfc){const u=n.c3_imageBitmap;n.c3_imageBitmap=null;(r.imageBitmap=u)&&d.push(u)}else f.push(createImageBitmap(n).then(u=>{r.imageBitmap=u;d.push(u)}).catch(u=>{r.imageBitmap=null}));a[m.toString()]=r}Promise.all(f).then(()=>this.PostToRuntime("state",b,!1,d))}})}"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(c){super(c,"user-media");this.SetAutoAttach(!1);this._isRuntimeInWorker=this._iRuntime.UsesWorker();this._sequenceNumber=0;this._lastActiveStream=null;this.AddRuntimeMessageHandler("get-media-sources",()=>this._OnGetMediaSources());this.AddDOMElementMessageHandler("request-camera",(a,b)=>this._OnRequestCamera(a,b));this.AddDOMElementMessageHandler("request-microphone",(a,b)=>this._OnRequestMicrophone(a,b));this.AddDOMElementMessageHandler("snapshot",
(a,b)=>this._Snapshot(a,b));this.AddDOMElementMessageHandler("stop",a=>this._Stop(a));self.C3UserMedia_GetVideoElement=a=>this.GetElementById(a);self.C3UserMedia_GetLastMediaStream=()=>this._lastActiveStream}CreateElement(c,a){const b=document.createElement("video");b.crossOrigin="anonymous";b.autoplay=!0;b.muted=!0;b.playsInline=!0;b.addEventListener("canplaythrough",()=>{this.PostToRuntimeElement("video-ready",c,{width:b.videoWidth,height:b.videoHeight})});return b}UpdateState(c,a){}DestroyElement(c){c.srcObject&&
(this._StopStream(c.srcObject),c.srcObject=null)}_StopStream(c){this._lastActiveStream===c&&(this._lastActiveStream=null);c=c.getTracks();for(let a=0,b=c.length;a<b;++a)c[a].stop()}async _OnGetMediaSources(){const c=[],a=[];if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var b=await navigator.mediaDevices.enumerateDevices();for(const d of b){b=d.kind;const f={deviceId:d.deviceId,label:d.label,facing:d.facing||d.facingMode||""};"video"===b||"videoinput"===b?c.push(f):("audio"===
b||"audioinput"===b)&&a.push(f)}}return{videoSources:c,audioSources:a}}async _OnRequestCamera(c,a){try{const b="object"===typeof a.constraints.audio,d=this.GetRuntimeInterface();b?await d.RequirePermissions("CAMERA","RECORD_AUDIO","MODIFY_AUDIO_SETTINGS"):await d.RequirePermissions("CAMERA");this._lastActiveStream=await navigator.mediaDevices.getUserMedia(a.constraints);c.srcObject=this._lastActiveStream;c.play();this._isRuntimeInWorker&&this._StartTicking();return{ok:!0}}catch(b){return console.warn("Error requesting camera: ",
b),{ok:!1}}}async _OnRequestMicrophone(c,a){try{return await this.GetRuntimeInterface().RequirePermissions("RECORD_AUDIO","MODIFY_AUDIO_SETTINGS"),this._lastActiveStream=await navigator.mediaDevices.getUserMedia(a.constraints),self.C3Audio_OnMicrophoneStream&&self.C3Audio_OnMicrophoneStream(this._lastActiveStream,a.tag),{ok:!0}}catch(b){return console.warn("Error requesting microphone: ",b),{ok:!1}}}_CanvasToURL(c,a,b){return new Promise((d,f)=>{c.toBlob?c.toBlob(m=>d(URL.createObjectURL(m)),a,b):
d(c.toDataURL(a,b))})}async _Snapshot(c,a){const b=document.createElement("canvas");b.width=c.videoWidth;b.height=c.videoHeight;b.getContext("2d").drawImage(c,0,0,c.videoWidth,c.videoHeight);return{snapshotUrl:await this._CanvasToURL(b,a.format,a.quality)}}_Stop(c){c.srcObject&&(this._StopStream(c.srcObject),c.srcObject=null)}Tick(){if(this._isRuntimeInWorker){var c={},a={sequenceNumber:this._sequenceNumber++,videoData:c},b=[],d=[];for(const [f,m]of this._elementMap.entries()){if(!m.srcObject)continue;
const n={};d.push(createImageBitmap(m).then(r=>{n.imageBitmap=r;b.push(r)}).catch(r=>{n.imageBitmap=null}));c[f.toString()]=n}Promise.all(d).then(()=>this.PostToRuntime("state",a,!1,b))}}});"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(c){super(c,"game-recorder");this._mediaStream=this._mediaRecorder=null;this._stopStreamOnEnd=!0;this._recordedChunks=[];this._lastRecordingUrl="";this.AddRuntimeMessageHandler("get-supported-formats",()=>this._OnGetSupportedFormats());this.AddRuntimeMessageHandler("start-recording",a=>this._OnStartRecording(a));this.AddRuntimeMessageHandler("start-screen-recording",a=>this._OnStartScreenRecording(a));this.AddRuntimeMessageHandler("start-user-media-recording",
a=>this._OnStartUserMediaRecording(a));this.AddRuntimeMessageHandler("stop-recording",()=>this._OnStopRecording());this._MaybePolyfillGetDisplayMedia()}_MaybePolyfillGetDisplayMedia(){navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getSupportedConstraints().mediaSource&&(navigator.mediaDevices.getDisplayMedia=function(){return navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}})})}_OnGetSupportedFormats(){var c=
this._iRuntime.GetCanvas();const a="undefined"!==typeof MediaRecorder;c=!(!c.captureStream||!a);const b=[],d=[];c&&(MediaRecorder.isTypeSupported("video/mp4")&&b.push("video/mp4"),MediaRecorder.isTypeSupported("video/webm;codecs=vp8")&&b.push("video/webm;codecs=vp8"),MediaRecorder.isTypeSupported("video/webm;codecs=vp9")&&b.push("video/webm;codecs=vp9"),MediaRecorder.isTypeSupported("audio/mp4")&&d.push("audio/mp4"),MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")&&d.push("audio/ogg;codecs=opus"),
MediaRecorder.isTypeSupported("audio/webm;codecs=opus")&&d.push("audio/webm;codecs=opus"));return{isSupported:c,isMediaRecorderSupported:a,isScreenRecordingSupported:!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia||"undefined"===typeof MediaRecorder),supportedVideoFormats:b,supportedAudioFormats:d}}_StopStreamVideoTracks(c){c=c.getTracks();for(let a=0,b=c.length;a<b;++a){const d=c[a];"video"===d.kind&&d.stop()}}_StopAnyPriorRecording(){this._OnStopRecording();this._recordedChunks.length=
0;this._lastRecordingUrl&&(URL.revokeObjectURL(this._lastRecordingUrl),this._lastRecordingUrl="")}_OnStartRecording(c){const a=c.videoType,b=c.audioType,d=c.bitsPerSecond;c=c.framerate;this._StopAnyPriorRecording();let f=[],m=[];try{if(a){const n=this._iRuntime.GetCanvas();f=(0<c?n.captureStream(c):n.captureStream()).getVideoTracks()}b&&self.C3Audio_GetOutputStream&&(m=self.C3Audio_GetOutputStream().getAudioTracks());this._mediaStream=new MediaStream([...f,...m]);this._stopStreamOnEnd=!0;this._mediaRecorder=
new MediaRecorder(this._mediaStream,{mimeType:a||b,bitsPerSecond:d})}catch(n){console.error("[Game Recorder] Failed to start recording: ",n),this.PostToRuntime("error")}this._StartMediaRecorder(a,b)}async _OnStartScreenRecording(c){const a=c.videoType,b=c.audioType;c=c.bitsPerSecond;this._StopAnyPriorRecording();let d=[],f=[];try{a&&(d=(await navigator.mediaDevices.getDisplayMedia({video:!0})).getVideoTracks()),b&&self.C3Audio_GetOutputStream&&(f=self.C3Audio_GetOutputStream().getAudioTracks()),this._mediaStream=
new MediaStream([...d,...f]),this._stopStreamOnEnd=!0,this._mediaStream.addEventListener("inactive",()=>this._OnMediaStreamInactive()),this._mediaRecorder=new MediaRecorder(this._mediaStream,{mimeType:a||b,bitsPerSecond:c})}catch(m){console.error("[Game Recorder] Failed to start recording: ",m),this.PostToRuntime("error")}this._StartMediaRecorder(a,b)}async _OnStartUserMediaRecording(c){const a=c.videoType,b=c.audioType;c=c.bitsPerSecond;this._StopAnyPriorRecording();if(self.C3UserMedia_GetLastMediaStream){var d=
self.C3UserMedia_GetLastMediaStream();if(d){try{this._mediaStream=d,this._stopStreamOnEnd=!1,this._mediaRecorder=new MediaRecorder(this._mediaStream,{mimeType:a||b,bitsPerSecond:c})}catch(f){console.error("[Game Recorder] Failed to start recording: ",f),this.PostToRuntime("error")}this._StartMediaRecorder(a,b)}}}_StartMediaRecorder(c,a){this._mediaRecorder.ondataavailable=b=>{this._recordedChunks.push(b.data)};this._mediaRecorder.onerror=b=>{console.error("[Game Recorder] Error recording: ",b);this.PostToRuntime("error")};
this._mediaRecorder.onwarning=b=>{console.warn("[Game Recorder] Recording warning: ",b)};this._mediaRecorder.onstop=b=>{b=new Blob(this._recordedChunks,{type:c||a});this._lastRecordingUrl=URL.createObjectURL(b);this.PostToRuntime("recording-ready",{url:this._lastRecordingUrl})};this._mediaRecorder.start()}_OnMediaStreamInactive(){this.PostToRuntime("screen-recording-stopped");this._OnStopRecording()}_OnStopRecording(){this._mediaRecorder&&(this._mediaRecorder.stop(),this._mediaRecorder=null);this._mediaStream&&
(this._stopStreamOnEnd&&this._StopStreamVideoTracks(this._mediaStream),this._mediaStream=null)}});"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(c){super(c,"touch");this.AddRuntimeMessageHandler("request-permission",a=>this._OnRequestPermission(a))}async _OnRequestPermission(c){c=c.type;let a=!0;0===c?a=await this._RequestOrientationPermission():1===c&&(a=await this._RequestMotionPermission());this.PostToRuntime("permission-result",{type:c,result:a})}async _RequestOrientationPermission(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;
try{return"granted"===await self.DeviceOrientationEvent.requestPermission()}catch(c){return console.warn("[Touch] Failed to request orientation permission: ",c),!1}}async _RequestMotionPermission(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return"granted"===await self.DeviceMotionEvent.requestPermission()}catch(c){return console.warn("[Touch] Failed to request motion permission: ",c),!1}}});"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(c){super(c,"gamepad");this._isSupported=!!navigator.getGamepads;this._isReady=!1;this.AddRuntimeMessageHandler("is-supported",()=>this._OnTestIsSupported());this.AddRuntimeMessageHandler("ready",()=>this._OnReady());this.AddRuntimeMessageHandler("vibrate",a=>this._OnGamepadVibrate(a));this.AddRuntimeMessageHandler("reset-vibrate",a=>this._OnGamepadResetVibrate(a));window.addEventListener("gamepadconnected",a=>this._OnGamepadConnected(a));
window.addEventListener("gamepaddisconnected",a=>this._OnGamepadDisconnected(a));window.addEventListener("unload",()=>this._OnWindowUnload())}_GetActiveGamepads(){return Array.from(navigator.getGamepads()).filter(c=>c&&c.connected)}_OnTestIsSupported(c){return this._isSupported}_OnReady(){this._isReady=!0;for(const c of this._GetActiveGamepads())this.PostToRuntime("gamepad-connected",{index:c.index,id:c.id});this._isSupported&&this._StartTicking()}_OnGamepadConnected(c){this._isReady&&(c=c.gamepad,
this.PostToRuntime("gamepad-connected",{index:c.index,id:c.id}))}_OnGamepadDisconnected(c){this._isReady&&this.PostToRuntime("gamepad-disconnected",{index:c.gamepad.index})}Tick(){var c=this._GetActiveGamepads();c.length&&(c=c.map(a=>({index:a.index,id:a.id,buttons:a.buttons.map(b=>({pressed:b.pressed,value:b.value})),axes:a.axes})),this.PostToRuntime("input-update",c))}_GetGamepadByIndex(c){for(const a of this._GetActiveGamepads())if(a.index===c)return a;return null}async _OnGamepadVibrate(c){var a=
this._GetGamepadByIndex(c.index);if(a&&(a=a.vibrationActuator)&&a.playEffect)try{await a.playEffect("dual-rumble",{duration:c.duration,startDelay:0,weakMagnitude:c.weakMag,strongMagnitude:c.strongMag})}catch(b){console.warn("[Gamepad] Failed to vibrate gamepad: ",b)}}_OnGamepadResetVibrate(c){(c=this._GetGamepadByIndex(c.index))&&(c=c.vibrationActuator)&&c.reset&&c.reset()}_OnWindowUnload(){for(const c of this._GetActiveGamepads()){const a=c.vibrationActuator;a&&a.reset&&a.reset()}}});"use strict";
{function c(b){b.stopPropagation()}function a(b){13!==b.which&&27!==b.which&&b.stopPropagation()}self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(b){super(b,"text-input");this.AddDOMElementMessageHandler("scroll-to-bottom",d=>this._OnScrollToBottom(d))}CreateElement(b,d){let f;const m=d.type;"textarea"===m?(f=document.createElement("textarea"),f.style.resize="none"):(f=document.createElement("input"),f.type=m);f.style.position="absolute";f.autocomplete="off";
f.addEventListener("touchstart",c);f.addEventListener("touchmove",c);f.addEventListener("touchend",c);f.addEventListener("mousedown",c);f.addEventListener("mouseup",c);f.addEventListener("keydown",a);f.addEventListener("keyup",a);f.addEventListener("click",n=>{n.stopPropagation();this._PostToRuntimeElementMaybeSync("click",b)});f.addEventListener("dblclick",n=>{n.stopPropagation();this._PostToRuntimeElementMaybeSync("dblclick",b)});f.addEventListener("input",()=>this.PostToRuntimeElement("change",
b,{text:f.value}));d.id&&(f.id=d.id);this.UpdateState(f,d);return f}UpdateState(b,d){b.value=d.text;b.placeholder=d.placeholder;b.title=d.title;b.disabled=!d.isEnabled;b.readOnly=d.isReadOnly;b.spellcheck=d.spellCheck;d=d.maxLength;0>d?b.removeAttribute("maxlength"):b.setAttribute("maxlength",d)}_OnScrollToBottom(b){b.scrollTop=b.scrollHeight}})}"use strict";
{function c(a){a.stopPropagation()}self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(a){super(a,"list");this.AddDOMElementMessageHandler("set-selected-index",(b,d)=>this._OnSetSelectedIndex(b,d.selectedIndex));this.AddDOMElementMessageHandler("add-item",(b,d)=>this._OnAddItem(b,d));this.AddDOMElementMessageHandler("remove-item",(b,d)=>this._OnRemoveItem(b,d));this.AddDOMElementMessageHandler("set-item",(b,d)=>this._OnSetItem(b,d));this.AddDOMElementMessageHandler("clear",
b=>this._OnClear(b));this.AddDOMElementMessageHandler("load-state",(b,d)=>this._OnLoadState(b,d))}CreateElement(a,b){const d=b.isDropdown,f=b.isMultiSelect,m=b.items,n=document.createElement("select");n.style.position="absolute";n.style.userSelect="none";n.style.webkitUserSelect="none";n.multiple=f;d||(n.size=2);for(const r of m)n.add(this._CreateOption(r));n.addEventListener("touchstart",c);n.addEventListener("touchmove",c);n.addEventListener("touchend",c);n.addEventListener("mousedown",c);n.addEventListener("mouseup",
c);n.addEventListener("click",r=>{r.stopPropagation();this._PostToRuntimeElementMaybeSync("click",a,this._GetSelectionState(n))});n.addEventListener("dblclick",r=>{r.stopPropagation();this._PostToRuntimeElementMaybeSync("dblclick",a,this._GetSelectionState(n))});n.addEventListener("change",()=>this.PostToRuntimeElement("change",a,this._GetSelectionState(n)));b.id&&(n.id=b.id);this.UpdateState(n,b);return n}_CreateOption(a){const b=document.createElement("option");b.text=a;return b}_GetSelectionState(a){const b=
a.selectedIndex,d=[];for(let f=0,m=a.length;f<m;++f)a.options[f].selected&&d.push(f);return{selectedIndex:b,selectedIndices:d}}UpdateState(a,b){a.title=b.title;a.disabled=!b.isEnabled;a.multiple=!!b.isMultiSelect}_OnSetSelectedIndex(a,b){a.selectedIndex=b}_OnAddItem(a,b){const d=b.index;b=this._CreateOption(b.text);0>d?a.add(b):a.add(b,d)}_OnRemoveItem(a,b){a.remove(b.index)}_OnSetItem(a,b){a.options[b.index].text=b.text}_OnClear(a){a.innerHTML=""}_OnLoadState(a,b){a.innerHTML="";for(const d of b.items)a.add(this._CreateOption(d));
a.selectedIndex=b.selectedIndex;for(const d of b.selectedIndices)if(b=a.options[d])b.selected=!0}})}"use strict";
{function c(a){a.stopPropagation()}self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(a){super(a,"button")}CreateElement(a,b){const d=document.createElement("input");var f=d;b.isCheckbox?(d.type="checkbox",f=document.createElement("label"),f.appendChild(d),f.appendChild(document.createTextNode("")),f.style.fontFamily="sans-serif",f.style.userSelect="none",f.style.webkitUserSelect="none",f.style.display="inline-block",f.style.color="black"):d.type="button";f.style.position=
"absolute";f.addEventListener("touchstart",c);f.addEventListener("touchmove",c);f.addEventListener("touchend",c);f.addEventListener("mousedown",c);f.addEventListener("mouseup",c);f.addEventListener("keydown",c);f.addEventListener("keyup",c);d.addEventListener("click",()=>this._PostToRuntimeElementMaybeSync("click",a,{isChecked:d.checked}));b.id&&(d.id=b.id);this.UpdateState(f,b);return f}_GetInputElem(a){return"input"===a.tagName.toLowerCase()?a:a.firstChild}_GetFocusElement(a){return this._GetInputElem(a)}UpdateState(a,
b){const d=this._GetInputElem(a);d.checked=b.isChecked;d.disabled=!b.isEnabled;a.title=b.title;a===d?d.value=b.text:a.lastChild.textContent=b.text}})}"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(c){super(c,"iframe");this._isDisplayingHtmlStr=!1;this.AddDOMElementMessageHandler("navigate-url",(a,b)=>this._OnNavigateURL(a,b));this.AddDOMElementMessageHandler("display-html",(a,b)=>this._OnDisplayHTML(a,b))}CreateElement(c,a){c=document.createElement("iframe");c.style.position="absolute";c.style.border="none";var b=navigator.userAgent;/iphone|ipad|ipod/i.test(b)&&(b=/(iphone\s+os|ipad[^)]*os)\s+([0-9_]+)/i.exec(b),
b=parseInt(b[b.length-1]),12>=b||isNaN(b))&&(c.setAttribute("noresize","noresize"),c.setAttribute("scrolling","no"));a.isVisible||(c.style.display="none");a.id&&(c.id=a.id);a.allow&&(c.setAttribute("allow",a.allow),a.allow.includes("fullscreen")&&c.setAttribute("allowfullscreen",""));a.enableSandbox&&c.setAttribute("sandbox",a.sandbox);a.url?c.src=a.url:a.html&&this._OnDisplayHTML(c,a);return c}UpdateState(c,a){}_SetSrc(c,a){c.src.startsWith("blob:")&&this._isDisplayingHtmlStr&&URL.revokeObjectURL(c.src);
c.src=a}DestroyElement(c){this._SetSrc(c,"");this._isDisplayingHtmlStr=!1}_OnNavigateURL(c,a){this._SetSrc(c,a.url);this._isDisplayingHtmlStr=!1}_OnDisplayHTML(c,a){a=new Blob([a.html],{type:"text/html"});this._SetSrc(c,URL.createObjectURL(a));this._isDisplayingHtmlStr=!0}});